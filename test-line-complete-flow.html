<!DOCTYPE html>
<html lang="ja">
<head>
    <title>LINEãƒ•ãƒ­ãƒ¼å®Œå…¨ãƒ†ã‚¹ãƒˆ</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        h1 { color: #333; border-bottom: 2px solid #4CAF50; padding-bottom: 10px; }
        h2 { color: #666; margin-top: 30px; }
        .step { margin: 20px 0; padding: 15px; background: #f9f9f9; border-left: 4px solid #4CAF50; }
        .step-title { font-weight: bold; color: #4CAF50; margin-bottom: 10px; }
        button { background: #4CAF50; color: white; padding: 12px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 10px 5px; }
        button:hover { background: #45a049; }
        .result { margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .info { background: #e3f2fd; color: #1976d2; padding: 10px; border-radius: 5px; margin: 10px 0; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
        .link-button { display: inline-block; padding: 10px 20px; background: #00B900; color: white; text-decoration: none; border-radius: 5px; margin: 5px; }
        .link-button:hover { background: #009900; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŸ¢ LINEã‹ã‚‰ã®å®Œå…¨è¨ºæ–­ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="info">
            <strong>ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ID:</strong> U69bf66f589f5303a9615e94d7a7dc693<br>
            <strong>èª¬æ˜:</strong> LINEã‚¢ãƒ—ãƒªã‹ã‚‰è¨ºæ–­ã«å…¥ã‚‹å®Œå…¨ãªæµã‚Œã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã™
        </div>
        
        <h2>ğŸ“ ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«4è»¸ãƒ‡ãƒ¼ã‚¿è¨­å®š</h2>
        <div class="step">
            <div class="step-title">LINEç™»éŒ²å¾Œã®Q3ã€œQ6å›ç­”ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</div>
            <p>LINEã§Q3ã€œQ6ã«å›ç­”ã—ãŸçŠ¶æ…‹ã‚’å†ç¾ã—ã¾ã™</p>
            <button onclick="setupProfile()">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®š</button>
            <div id="profileResult"></div>
        </div>
        
        <h2>ğŸŒ™ ã‚¹ãƒ†ãƒƒãƒ—2: è¨ºæ–­å…¥åŠ›ãƒšãƒ¼ã‚¸ã¸</h2>
        <div class="step">
            <div class="step-title">LINEãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰è¨ºæ–­é–‹å§‹</div>
            <p>å®Ÿéš›ã®LINEã‚¢ãƒ—ãƒªã§ã¯ã€ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã€ŒãŠã¤ãã•ã¾è¨ºæ–­ã€ã‚’ã‚¿ãƒƒãƒ—ã—ã¾ã™</p>
            <a href="/lp-otsukisama-input.html?userId=U69bf66f589f5303a9615e94d7a7dc693" class="link-button" target="_blank">
                è¨ºæ–­å…¥åŠ›ãƒšãƒ¼ã‚¸ã‚’é–‹ã
            </a>
        </div>
        
        <h2>ğŸ” ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ‡ãƒ¼ã‚¿ç¢ºèª</h2>
        <div class="step">
            <div class="step-title">ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿çŠ¶æ…‹ã‚’ç¢ºèª</div>
            <button onclick="checkCurrentData()">ãƒ‡ãƒ¼ã‚¿ç¢ºèª</button>
            <div id="dataResult"></div>
        </div>
        
        <h2>ğŸ“Š ã‚¹ãƒ†ãƒƒãƒ—4: è¨ºæ–­å±¥æ­´ç¢ºèª</h2>
        <div class="step">
            <div class="step-title">ä½œæˆã•ã‚ŒãŸè¨ºæ–­ã‚’ç¢ºèª</div>
            <button onclick="checkDiagnoses()">è¨ºæ–­å±¥æ­´å–å¾—</button>
            <div id="diagnosesResult"></div>
        </div>
    </div>
    
    <script>
        const userId = 'U69bf66f589f5303a9615e94d7a7dc693';
        
        async function setupProfile() {
            const resultDiv = document.getElementById('profileResult');
            resultDiv.innerHTML = '<p>å‡¦ç†ä¸­...</p>';
            
            try {
                // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®4è»¸ãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š
                const profileData = {
                    userId: userId,
                    emotionalExpression: 'straight',  // Q3: ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆå‘Šç™½å‹
                    distanceStyle: 'close',           // Q4: ãƒ™ãƒƒã‚¿ãƒªä¾å­˜å‹
                    loveValues: 'romantic',            // Q5: ãƒ­ãƒãƒ³ãƒã‚¹ãƒˆå‹
                    loveEnergy: 'fluctuating'          // Q6: æ³¢ã‚ã‚Šå‹
                };
                
                const response = await fetch('/api/update-profile-axes', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(profileData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    resultDiv.innerHTML = `
                        <div class="result">
                            <h3>âœ… ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šå®Œäº†</h3>
                            <p>Q3ã€œQ6ã®å›ç­”ãŒãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã«ä¿å­˜ã•ã‚Œã¾ã—ãŸï¼š</p>
                            <ul>
                                <li>Q3 æ„Ÿæƒ…è¡¨ç¾: ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆå‘Šç™½å‹</li>
                                <li>Q4 è·é›¢æ„Ÿ: ãƒ™ãƒƒã‚¿ãƒªä¾å­˜å‹</li>
                                <li>Q5 ä¾¡å€¤è¦³: ãƒ­ãƒãƒ³ãƒã‚¹ãƒˆå‹</li>
                                <li>Q6 ã‚¨ãƒãƒ«ã‚®ãƒ¼: æ³¢ã‚ã‚Šå‹</li>
                            </ul>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="result error">ã‚¨ãƒ©ãƒ¼: ${JSON.stringify(result)}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }
        
        async function checkCurrentData() {
            const resultDiv = document.getElementById('dataResult');
            resultDiv.innerHTML = '<p>ç¢ºèªä¸­...</p>';
            
            try {
                // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª
                const response = await fetch(`/api/get-love-profile?userId=${userId}`);
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="result">
                            <h3>ğŸ“Š ç¾åœ¨ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿</h3>
                            <pre>${JSON.stringify(data.profile, null, 2)}</pre>
                            <p><strong>4è»¸ãƒ‡ãƒ¼ã‚¿ç¢ºèª:</strong></p>
                            <ul>
                                <li>æ„Ÿæƒ…è¡¨ç¾: ${data.profile.emotionalExpression || 'æœªè¨­å®š'}</li>
                                <li>è·é›¢æ„Ÿ: ${data.profile.distanceStyle || 'æœªè¨­å®š'}</li>
                                <li>ä¾¡å€¤è¦³: ${data.profile.loveValues || 'æœªè¨­å®š'}</li>
                                <li>ã‚¨ãƒãƒ«ã‚®ãƒ¼: ${data.profile.loveEnergy || 'æœªè¨­å®š'}</li>
                            </ul>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="result error">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }
        
        async function checkDiagnoses() {
            const resultDiv = document.getElementById('diagnosesResult');
            resultDiv.innerHTML = '<p>å–å¾—ä¸­...</p>';
            
            try {
                const response = await fetch(`/api/profile-form-v2?action=get-user-diagnoses&userId=${userId}`);
                const data = await response.json();
                
                if (data.success && data.diagnoses) {
                    let html = `
                        <div class="result">
                            <h3>ğŸ“ è¨ºæ–­å±¥æ­´ (${data.diagnoses.length}ä»¶)</h3>
                    `;
                    
                    for (const diag of data.diagnoses) {
                        const detailResponse = await fetch(`/api/profile-form-v2?action=get-diagnosis&id=${diag.id}&userId=${userId}`);
                        const detail = await detailResponse.json();
                        
                        html += `
                            <div style="margin: 15px 0; padding: 10px; background: #f9f9f9; border-radius: 5px;">
                                <p><strong>è¨ºæ–­ID:</strong> ${diag.id}</p>
                                <p><strong>ä½œæˆæ—¥æ™‚:</strong> ${new Date(diag.created_at).toLocaleString('ja-JP')}</p>
                                <p><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼å:</strong> ${detail.diagnosis?.user_name || 'æœªè¨­å®š'}</p>
                                <p><strong>4è»¸ãƒ‡ãƒ¼ã‚¿:</strong></p>
                                <ul>
                                    <li>æ„Ÿæƒ…è¡¨ç¾: ${detail.diagnosis?.emotional_expression || 'æœªè¨­å®š'}</li>
                                    <li>è·é›¢æ„Ÿ: ${detail.diagnosis?.distance_style || 'æœªè¨­å®š'}</li>
                                    <li>ä¾¡å€¤è¦³: ${detail.diagnosis?.love_values || 'æœªè¨­å®š'}</li>
                                    <li>ã‚¨ãƒãƒ«ã‚®ãƒ¼: ${detail.diagnosis?.love_energy || 'æœªè¨­å®š'}</li>
                                </ul>
                                <p><strong>ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«:</strong> ${detail.accessLevel}</p>
                                <a href="/lp-otsukisama-unified.html?id=${diag.id}&userId=${userId}" class="link-button" target="_blank">
                                    ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’é–‹ã
                                </a>
                            </div>
                        `;
                    }
                    
                    html += '</div>';
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = `<div class="result">è¨ºæ–­å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•ã§ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª
        window.onload = async function() {
            await checkCurrentData();
        };
    </script>
</body>
</html>