<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>おつきさま診断 - 月が導くあなたの運命</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            overflow-x: hidden;
            width: 100%;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans JP', sans-serif;
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #ffffff;
            line-height: 1.8;
            overflow-x: hidden;
            font-size: 16px;
        }
        
        /* フォントヒエラルキー */
        h1, h2.banner-title {
            font-family: 'Noto Sans JP', sans-serif;
            font-weight: 900;
            letter-spacing: 0.05em;
        }
        
        .section-title {
            font-family: 'Noto Sans JP', sans-serif;
            font-weight: 700;
        }
        
        .special-message {
            font-family: 'Hiragino Mincho ProN', serif;
            font-style: italic;
        }
        
        /* スクロール進捗バー */
        .scroll-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 4px;
            background: linear-gradient(90deg, #ffd700, #ff6b6b, #9370db);
            z-index: 9999;
            transition: width 0.2s ease;
            box-shadow: 0 2px 10px rgba(255, 215, 0, 0.5);
        }
        
        /* スマホでスクロール案内を表示 */
        @media (min-width: 769px) {
            .scroll-hint {
                display: none !important;
            }
        }
        
        @media (max-width: 768px) {
            body {
                font-size: 16px;
                line-height: 1.8;
            }
            
            h1 {
                font-size: 28px;
            }
            
            h2 {
                font-size: 22px;
            }
            
            h3 {
                font-size: 18px;
            }
        }
        
        /* 星空アニメーション */
        .stars-container {
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        
        .shooting-star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: linear-gradient(90deg, white, transparent);
            animation: shoot 3s linear infinite;
        }
        
        @keyframes shoot {
            0% { transform: translateX(-100px) translateY(0); opacity: 1; }
            100% { transform: translateX(2000px) translateY(200px); opacity: 0; }
        }
        
        /* メインコンテナ */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
            z-index: 1;
            width: 100%;
            overflow-x: hidden;
        }
        
        @media (max-width: 768px) {
            .container {
                max-width: 100%;
                padding: 0 5px;
            }
        }
        
        /* ヘッダー */
        .header {
            text-align: center;
            padding: 60px 20px;
            background: radial-gradient(circle at center, rgba(100,100,255,0.1) 0%, transparent 60%);
        }
        
        .main-moon {
            width: 150px;
            height: 150px;
            margin: 0 auto 30px;
            background: radial-gradient(circle at 30% 30%, #ffffff 0%, #f0f0ff 50%, #d0d0ff 100%);
            border-radius: 50%;
            box-shadow: 
                0 0 80px rgba(255,255,255,0.8),
                0 0 120px rgba(200,200,255,0.6),
                inset -20px -20px 30px rgba(150,150,200,0.3);
            animation: moonGlow 4s ease-in-out infinite;
        }
        
        @keyframes moonGlow {
            0%, 100% { box-shadow: 0 0 80px rgba(255,255,255,0.8), 0 0 120px rgba(200,200,255,0.6); }
            50% { box-shadow: 0 0 100px rgba(255,255,255,1), 0 0 150px rgba(200,200,255,0.8); }
        }
        
        h1 {
            font-size: 32px;
            font-weight: normal;
            letter-spacing: 4px;
            margin-bottom: 15px;
            text-shadow: 0 0 30px rgba(255,255,255,0.5);
            background: linear-gradient(135deg, #ffffff 0%, #e0e0ff 50%, #ffffff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            font-size: 16px;
            color: #c0c0ff;
            letter-spacing: 2px;
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .sub-description {
            font-size: 14px;
            color: #a0a0e0;
            margin-top: 20px;
            line-height: 1.6;
            font-weight: 500;
        }
        
        /* フォームセクション */
        .form-section {
            padding: 40px 20px;
            margin-bottom: 40px;
        }
        
        .form-title {
            text-align: center;
            font-size: 20px;
            color: #ffffff;
            margin-bottom: 30px;
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        .form-group {
            margin-bottom: 30px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-size: 15px;
            color: #d0d0ff;
            letter-spacing: 1px;
            font-weight: 500;
        }
        
        .required {
            color: #ff9999;
            font-size: 12px;
            margin-left: 5px;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            color: white;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #9090ff;
            background: rgba(255,255,255,0.1);
            box-shadow: 0 0 20px rgba(144,144,255,0.3);
        }
        
        .date-selects {
            display: flex;
            gap: 12px;
        }
        
        select {
            flex: 1;
            padding: 15px;
            border: 2px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        select:focus {
            outline: none;
            border-color: #9090ff;
            background: rgba(255,255,255,0.1);
        }
        
        select option {
            background: #2a2a4e;
            color: white;
        }
        
        button {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #917FB3 0%, #E8A0BF 100%);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.4s;
            box-shadow: 0 10px 30px rgba(145,127,179,0.4);
            position: relative;
            overflow: hidden;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(145,127,179,0.6);
        }
        
        button:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .button-subtitle {
            font-size: 12px;
            opacity: 0.9;
            margin-top: 5px;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* 結果セクション（初期は非表示） */
        .result-section {
            display: none;
        }
        
        /* タイトルスタイル */
        .section-title {
            text-align: center;
            font-size: 22px;
            color: #ffd700;
            margin: 50px 0 30px;
            letter-spacing: 2px;
            text-shadow: 0 0 20px rgba(255,215,0,0.5);
        }
        
        .section-description {
            text-align: center;
            font-size: 17px;
            color: #d0d0ff;
            letter-spacing: 0.5px;
            line-height: 2;
            font-weight: 600;
        }
        
        /* 3段階バナースタイル */
        
        /* 最重要バナー（運勢・恋愛） */
        .banner-supreme {
            position: relative;
            text-align: center;
            font-size: 42px;
            margin: 100px 0 80px;
            padding: 45px 30px;
            color: #ffffff;
            letter-spacing: 6px;
            background: linear-gradient(135deg,
                rgba(255, 215, 0, 0.2) 0%,
                rgba(255, 107, 107, 0.15) 25%,
                rgba(147, 112, 219, 0.2) 50%,
                rgba(100, 200, 255, 0.15) 75%,
                rgba(255, 215, 0, 0.2) 100%);
            border: 3px solid #ffd700;
            border-radius: 20px;
            text-shadow: 0 3px 15px rgba(255, 215, 0, 0.5);
            overflow: hidden;
            animation: bannerGlow 4s ease-in-out infinite;
            box-shadow: 0 10px 50px rgba(255, 215, 0, 0.3);
        }
        
        @keyframes bannerGlow {
            0%, 100% { 
                box-shadow: 0 10px 50px rgba(255, 215, 0, 0.3);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 15px 60px rgba(255, 215, 0, 0.5);
                transform: scale(1.02);
            }
        }
        
        /* 中重要バナー（仕事・人間関係） */
        .banner-secondary {
            position: relative;
            text-align: center;
            font-size: 36px;
            margin: 70px 0 50px;
            padding: 30px 20px;
            color: #ffffff;
            letter-spacing: 4px;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(147, 112, 219, 0.2) 20%,
                rgba(147, 112, 219, 0.3) 50%,
                rgba(147, 112, 219, 0.2) 80%,
                transparent 100%);
            border-left: 5px solid #ffd700;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            font-style: italic;
        }
        
        /* 装飾的バナー（月相説明） */
        .banner-decorative {
            position: relative;
            text-align: center;
            font-size: 32px;
            margin: 60px 0 40px;
            padding: 25px 15px;
            color: #ffffff;
            letter-spacing: 3px;
            background: rgba(100, 100, 255, 0.1);
            border-radius: 15px;
            text-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .banner-decorative::before {
            content: "🌙";
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 40px;
            animation: moonFloat 3s ease-in-out infinite;
        }
        
        .banner-decorative::after {
            content: "🌙";
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%) scaleX(-1);
            font-size: 40px;
            animation: moonFloat 3s ease-in-out infinite;
        }
        
        @keyframes moonFloat {
            0%, 100% { transform: translateY(-50%) rotate(0deg); }
            50% { transform: translateY(-60%) rotate(10deg); }
        }
        
        /* 旧バナースタイル（互換性のため） */
        .banner-title {
            position: relative;
            text-align: center;
            font-size: 38px;
            margin: 80px 0 60px;
            padding: 35px 20px;
            color: #ffffff;
            letter-spacing: 5px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(147, 112, 219, 0.3) 15%,
                rgba(147, 112, 219, 0.5) 50%,
                rgba(147, 112, 219, 0.3) 85%,
                transparent 100%);
            border-top: 2px solid rgba(255, 215, 0, 0.6);
            border-bottom: 2px solid rgba(255, 215, 0, 0.6);
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            overflow: hidden;
        }
        
        .banner-title::before,
        .banner-title::after {
            content: "";
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 100px;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.6));
        }
        
        .banner-title::before {
            left: -110px;
        }
        
        .banner-title::after {
            right: -110px;
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.6), transparent);
        }
        
        @media (max-width: 768px) {
            .banner-title {
                font-size: 26px;
                margin: 60px 0 40px;
                padding: 25px 10px;
                letter-spacing: 3px;
            }
            
            .banner-title::before,
            .banner-title::after {
                display: none;
            }
        }
        
        /* 6つのタイプを円形に配置 - 新デザイン */
        .moon-types-circle {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 80px auto;
        }
        
        /* 軌道線 */
        .orbit-path {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 320px;
            height: 320px;
            border: 1px dashed rgba(255,215,0,0.2);
            border-radius: 50%;
        }
        
        /* 中心の月 */
        .center-moon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            background: radial-gradient(circle at 30% 30%, #fff8dc 0%, #ffd700 30%, #ffa500 60%, rgba(255,215,0,0.3) 100%);
            border-radius: 50%;
            box-shadow: 
                0 0 100px rgba(255,215,0,0.9),
                0 0 150px rgba(255,215,0,0.6),
                inset -20px -20px 40px rgba(255,165,0,0.3),
                inset 10px 10px 30px rgba(255,255,255,0.8);
            z-index: 10;
            animation: moonPulse 4s ease-in-out infinite;
        }
        
        @keyframes moonPulse {
            0%, 100% { 
                box-shadow: 
                    0 0 100px rgba(255,215,0,0.9),
                    0 0 150px rgba(255,215,0,0.6),
                    inset -20px -20px 40px rgba(255,165,0,0.3),
                    inset 10px 10px 30px rgba(255,255,255,0.8);
            }
            50% { 
                box-shadow: 
                    0 0 120px rgba(255,215,0,1),
                    0 0 180px rgba(255,215,0,0.8),
                    inset -20px -20px 40px rgba(255,165,0,0.4),
                    inset 10px 10px 30px rgba(255,255,255,0.9);
            }
        }
        
        /* 要素コンテナ（軌道上を回転） */
        .elements-container {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 320px;
            height: 320px;
            transform: translate(-50%, -50%);
            animation: orbitRotation 40s linear infinite;
        }
        
        @keyframes orbitRotation {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .type-item {
            position: absolute;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.05) 100%);
            border: 2px solid rgba(255,215,0,0.6);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: all 0.3s;
            cursor: pointer;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 20px rgba(255,215,0,0.2);
            overflow: hidden; /* 円形マスクのため */
            transform: translate(-50%, -50%);
            animation: counterRotate 40s linear infinite;
        }
        
        /* 月相画像専用のスタイル */
        .moon-phase-item {
            background: transparent !important;
            backdrop-filter: none !important;
            overflow: visible !important; /* ラベル表示のためvisibleに */
        }
        
        .moon-phase-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
            border-radius: 50%; /* 画像自体を円形に */
        }
        
        @keyframes counterRotate {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(-360deg); }
        }
        
        .type-item:hover {
            transform: translate(-50%, -50%) scale(1.3);
            z-index: 20;
        }
        
        /* 月相 - ゴールド */
        .type-item:nth-child(1) {
            border: 3px solid rgba(255,215,0,0.9);
            box-shadow: 0 0 35px rgba(255,215,0,0.5);
        }
        .type-item:nth-child(1):hover {
            box-shadow: 0 0 50px rgba(255,215,0,0.8);
        }
        
        /* 裏月相 - パープル */
        .type-item:nth-child(2) {
            border: 3px solid rgba(180,100,255,0.9);
            box-shadow: 0 0 35px rgba(180,100,255,0.5);
        }
        .type-item:nth-child(2):hover {
            box-shadow: 0 0 50px rgba(180,100,255,0.8);
        }
        
        /* 恋愛タイプアイコン専用スタイル */
        .love-type-item {
            background: rgba(255,255,255,0.1) !important;
            backdrop-filter: blur(5px) !important;
        }
        
        .love-type-item img {
            padding: 2px;
            filter: brightness(1.1) contrast(1.1);
            width: 95% !important;
            height: 95% !important;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            object-fit: contain !important;
        }
        
        /* 感情表現 - ピンク */
        .type-item:nth-child(3) {
            border: 3px solid rgba(255,100,180,0.9);
            box-shadow: 0 0 35px rgba(255,100,180,0.5);
        }
        .type-item:nth-child(3):hover {
            box-shadow: 0 0 50px rgba(255,100,180,0.8);
        }
        
        /* 距離感 - エメラルドグリーン */
        .type-item:nth-child(4) {
            border: 3px solid rgba(50,255,180,0.9);
            box-shadow: 0 0 35px rgba(50,255,180,0.5);
        }
        .type-item:nth-child(4):hover {
            box-shadow: 0 0 50px rgba(50,255,180,0.8);
        }
        
        /* 価値観 - スカイブルー */
        .type-item:nth-child(5) {
            border: 3px solid rgba(100,200,255,0.9);
            box-shadow: 0 0 35px rgba(100,200,255,0.5);
        }
        .type-item:nth-child(5):hover {
            box-shadow: 0 0 50px rgba(100,200,255,0.8);
        }
        
        /* エネルギー - オレンジレッド */
        .type-item:nth-child(6) {
            border: 3px solid rgba(255,120,50,0.9);
            box-shadow: 0 0 35px rgba(255,120,50,0.5);
        }
        .type-item:nth-child(6):hover {
            box-shadow: 0 0 50px rgba(255,120,50,0.8);
        }
        
        /* モバイル用レスポンシブ */
        @media (max-width: 768px) {
            .moon-types-circle {
                width: calc(100vw - 40px);
                max-width: 400px;
                height: calc(100vw - 40px);
                max-height: 400px;
                margin: 60px auto;
            }
            
            .orbit-path {
                width: 240px;
                height: 240px;
            }
            
            .center-moon {
                width: 100px;
                height: 100px;
            }
            
            
            .type-item {
                width: 65px;
                height: 65px;
            }
            
            .type-label {
                font-size: 10px;
            }
            
            .type-result {
                font-size: 12px;
            }
        }
        
        .type-label {
            font-size: 12px;
            margin-bottom: 5px;
            font-weight: 600;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
            letter-spacing: 1px;
            text-transform: uppercase;
            white-space: nowrap;
        }
        
        .type-result {
            font-size: 16px;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
            white-space: nowrap;
            padding: 0 5px;
        }
        
        /* 各要素の文字色を対応する色に */
        .type-item:nth-child(1) .type-label,
        .type-item:nth-child(1) .type-result {
            color: #ffd700;
        }
        
        .type-item:nth-child(2) .type-label,
        .type-item:nth-child(2) .type-result {
            color: #b464ff;
        }
        
        .type-item:nth-child(3) .type-label,
        .type-item:nth-child(3) .type-result {
            color: #ff64b4;
        }
        
        .type-item:nth-child(4) .type-label,
        .type-item:nth-child(4) .type-result {
            color: #32ffb4;
        }
        
        .type-item:nth-child(5) .type-label,
        .type-item:nth-child(5) .type-result {
            color: #64c8ff;
        }
        
        .type-item:nth-child(6) .type-label,
        .type-item:nth-child(6) .type-result {
            color: #ff7832;
        }
        
        /* エネルギータイプの説明 */
        .energy-types {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 40px 0;
        }
        
        .energy-item {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, rgba(30,50,70,0.95) 0%, rgba(50,60,80,0.9) 100%);
            border-radius: 15px;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
            position: relative;
            overflow: hidden;
        }
        
        .energy-item::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }
        
        .energy-item:hover::before {
            opacity: 1;
        }
        
        /* エネルギータイプごとの色分け */
        .energy-item:nth-child(1) {
            background: linear-gradient(135deg, rgba(255,100,150,0.2) 0%, rgba(255,150,200,0.1) 100%);
            border: 2px solid rgba(255,100,150,0.6);
            box-shadow: 0 10px 30px rgba(255,100,150,0.3);
        }
        
        .energy-item:nth-child(2) {
            background: linear-gradient(135deg, rgba(150,100,255,0.2) 0%, rgba(200,150,255,0.1) 100%);
            border: 2px solid rgba(150,100,255,0.6);
            box-shadow: 0 10px 30px rgba(150,100,255,0.3);
        }
        
        .energy-item:nth-child(3) {
            background: linear-gradient(135deg, rgba(100,200,255,0.2) 0%, rgba(150,220,255,0.1) 100%);
            border: 2px solid rgba(100,200,255,0.6);
            box-shadow: 0 10px 30px rgba(100,200,255,0.3);
        }
        
        .energy-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(100,100,200,0.3);
        }
        
        .energy-title {
            font-size: 22px;
            color: #ffffff;
            margin-bottom: 10px;
            letter-spacing: 2px;
            text-shadow: 0 0 15px rgba(255,255,255,0.8);
            font-weight: bold;
        }
        
        .energy-description {
            font-size: 15px;
            color: #ffffff;
            line-height: 1.6;
            font-weight: 600;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        
        /* 月相カード */
        .moon-phase-card {
            padding: 30px 25px;
            margin-bottom: 40px;
            border: 3px solid rgba(255,215,0,0.7);
            border-left: 6px solid rgba(255,215,0,0.9);
            border-radius: 20px;
            background: linear-gradient(90deg, rgba(20,30,50,0.95) 0%, rgba(40,50,70,0.9) 100%);
            backdrop-filter: blur(8px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.4), 
                        0 0 50px rgba(255,215,0,0.15),
                        inset 0 2px 0 rgba(255,255,255,0.15);
            position: relative;
        }
        
        /* 新月用の色 */
        .moon-phase-card.new-moon {
            background: linear-gradient(90deg, rgba(15,20,40,0.95) 0%, rgba(30,40,60,0.9) 100%);
            border: 3px solid rgba(255,215,0,0.6);
            border-left: 6px solid rgba(255,215,0,0.9);
            box-shadow: 0 8px 30px rgba(0,0,0,0.4),
                        0 0 40px rgba(255,215,0,0.2),
                        inset 0 2px 0 rgba(255,215,0,0.2);
        }
        
        /* 三日月用の色 */
        .moon-phase-card.crescent {
            background: linear-gradient(90deg, rgba(60,50,70,0.95) 0%, rgba(80,70,90,0.9) 100%);
            border: 3px solid rgba(180,100,255,0.6);
            border-left: 6px solid rgba(180,100,255,0.9);
            box-shadow: 0 8px 30px rgba(0,0,0,0.4),
                        0 0 40px rgba(180,100,255,0.2),
                        inset 0 2px 0 rgba(180,100,255,0.2);
        }
        
        .moon-phase-header {
            display: flex;
            align-items: center;
            gap: 30px;
            margin-bottom: 25px;
        }
        
        .moon-phase-visual {
            width: 120px;
            height: 120px;
            background: radial-gradient(circle at 30% 30%, #ffffff 0%, #e0e0ff 100%);
            border-radius: 50%;
            flex-shrink: 0;
            box-shadow: 0 0 40px rgba(255,255,255,0.6);
        }
        
        .moon-phase-info h2 {
            font-size: 42px;
            color: #ffd700;
            margin-bottom: 12px;
            letter-spacing: 2px;
            font-weight: bold;
            text-shadow: 
                2px 2px 4px rgba(0,0,0,0.8),
                0 0 30px rgba(255,215,0,0.4);
        }
        
        .moon-phase-subtitle {
            font-size: 20px;
            color: #ffffff;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            letter-spacing: 0.5px;
            line-height: 1.4;
            position: relative;
            padding-bottom: 2px;
            border-bottom: 2px solid rgba(255,215,0,0.3);
        }
        
        .moon-phase-description {
            font-size: 18px;
            line-height: 1.9;
            color: #ffffff;
            font-weight: 500;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        
        /* 恋愛タイプ分析 */
        .love-type-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin: 40px 0;
        }
        
        /* 総合診断カード */
        .combined-personality-card {
            background: linear-gradient(135deg, rgba(255,215,0,0.1) 0%, rgba(255,182,193,0.1) 100%);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            animation: glow 3s ease-in-out infinite;
        }
        
        .combined-title {
            color: #ffd700;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }
        
        .combined-description {
            color: #fff;
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: 20px;
        }
        
        .combined-advice {
            background: rgba(255,255,255,0.05);
            border-left: 3px solid #ff6b6b;
            padding: 15px 20px;
            margin-top: 20px;
        }
        
        .combined-advice h4 {
            color: #ff6b6b;
            margin-bottom: 10px;
        }
        
        .compatible-types-card {
            background: rgba(100,150,200,0.1);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .compatible-types-card h4 {
            color: #87ceeb;
            margin-bottom: 15px;
        }
        
        .compatible-types-card ul {
            list-style: none;
            padding: 0;
        }
        
        .compatible-types-card li {
            color: #fff;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .compatible-types-card li:before {
            content: "💕 ";
            margin-right: 10px;
        }
        
        .love-type-card {
            background: linear-gradient(135deg, rgba(40,50,60,0.95) 0%, rgba(60,70,80,0.9) 100%);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(5px);
            position: relative;
            transition: all 0.3s;
        }
        
        .love-type-card:hover {
            transform: translateY(-5px);
        }
        
        /* 恋愛タイプカードの色分け */
        .love-type-card:nth-child(1) {
            background: linear-gradient(135deg, rgba(255,0,100,0.15) 0%, rgba(255,100,150,0.1) 100%);
            border: 2px solid rgba(255,0,100,0.5);
            box-shadow: 0 5px 20px rgba(255,0,100,0.2);
        }
        
        .love-type-card:nth-child(2) {
            background: linear-gradient(135deg, rgba(50,255,180,0.15) 0%, rgba(30,220,150,0.1) 100%);
            border: 2px solid rgba(50,255,180,0.5);
            box-shadow: 0 5px 20px rgba(50,255,180,0.2);
        }
        
        .love-type-card:nth-child(3) {
            background: linear-gradient(135deg, rgba(0,150,255,0.15) 0%, rgba(100,200,255,0.1) 100%);
            border: 2px solid rgba(0,150,255,0.5);
            box-shadow: 0 5px 20px rgba(0,150,255,0.2);
        }
        
        .love-type-card:nth-child(4) {
            background: linear-gradient(135deg, rgba(255,150,0,0.15) 0%, rgba(255,200,100,0.1) 100%);
            border: 2px solid rgba(255,150,0,0.5);
            box-shadow: 0 5px 20px rgba(255,150,0,0.2);
        }
        
        .love-type-title {
            font-size: 18px;
            color: #ffffff;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        
        .love-type-title img {
            width: 42px;
            height: 42px;
            object-fit: contain;
            filter: brightness(1.2) contrast(1.1);
        }
        
        .love-type-icon {
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, #ffffff, #ffd700);
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(255,215,0,0.6);
        }
        
        .love-type-content {
            font-size: 16px;
            color: #ffffff;
            line-height: 2;
            font-weight: 500;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .love-type-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .love-type-content::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }
        
        .love-type-content::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
        }
        
        .love-type-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.5);
        }
        
        /* 運勢セクション */
        .fortune-section {
            margin-bottom: 30px;
            padding: 15px 8px;
            border-radius: 8px;
            backdrop-filter: blur(8px);
        }
        
        /* 直近3ヶ月運命セクション - 紫系 */
        .fortune-section.destiny {
            background: linear-gradient(135deg, rgba(60,40,70,0.95) 0%, rgba(80,60,90,0.9) 100%);
            border: 1px solid rgba(181,165,214,0.3);
        }
        
        /* 恋愛運セクション - ピンク系 */
        .fortune-section.love {
            background: linear-gradient(135deg, rgba(100,50,60,0.95) 0%, rgba(120,70,80,0.9) 100%);
            border: 1px solid rgba(255,182,193,0.3);
        }
        
        /* 人間関係運セクション - 青系 */
        .fortune-section.relationship {
            background: linear-gradient(135deg, rgba(30,50,70,0.95) 0%, rgba(50,60,80,0.9) 100%);
            border: 1px solid rgba(165,180,214,0.3);
        }
        
        /* 仕事運セクション - 緑系 */
        .fortune-section.career {
            background: linear-gradient(135deg, rgba(40,60,50,0.95) 0%, rgba(60,80,70,0.9) 100%);
            border: 1px solid rgba(150,255,180,0.3);
        }
        
        /* 金運セクション - ゴールド系 */
        .fortune-section.money {
            background: linear-gradient(135deg, rgba(90,70,50,0.95) 0%, rgba(110,90,70,0.9) 100%);
            border: 1px solid rgba(255,215,0,0.3);
        }
        
        .section-header {
            padding: 15px 0;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .section-header h3 {
            font-size: 28px;
            color: #ffd700;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }
        
        .section-header p {
            font-size: 20px;
            color: #ffffff;
            line-height: 2.1;
            font-weight: 600;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        
        .fortune-content {
            padding: 0 10px;
            line-height: 2.2;
            color: #ffffff;
            font-weight: 600;
            font-size: 18px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        
        .fortune-highlight {
            border-left: 3px solid #ffd700;
            padding-left: 20px;
            margin: 30px 0;
        }
        
        .fortune-list {
            list-style: none;
            padding: 0;
            margin: 20px 0;
        }
        
        .fortune-list li {
            position: relative;
            padding-left: 30px;
            margin-bottom: 15px;
            color: #ffffff;
            font-weight: 600;
            font-size: 17px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        
        .fortune-list li::before {
            content: '✦';
            position: absolute;
            left: 0;
            color: #ffd700;
        }
        
        /* 月齢カレンダー */
        .monthly-fortune {
            background: linear-gradient(135deg, rgba(30,50,70,0.95) 0%, rgba(50,60,80,0.9) 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 40px 0;
            width: 100%;
            overflow-x: hidden;
            backdrop-filter: blur(8px);
        }
        
        .calendar-wrapper {
            background: rgba(10,20,40,0.6);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .weekday-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255,215,0,0.3);
        }
        
        .weekday {
            text-align: center;
            color: #ffd700;
            font-weight: bold;
            font-size: 14px;
        }
        
        .weekday:first-child {
            color: #ff9999; /* 日曜日は赤系 */
        }
        
        .weekday:last-child {
            color: #9999ff; /* 土曜日は青系 */
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            width: 100%;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(20,30,50,0.8);
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s;
            min-width: 45px;
            position: relative;
        }
        
        .calendar-day:hover {
            background: rgba(255,215,0,0.2);
            transform: scale(1.05);
            cursor: pointer;
        }
        
        /* 空白セル */
        .calendar-day.empty {
            background: transparent;
            border: none;
            cursor: default;
        }
        
        .calendar-day.empty:hover {
            transform: none;
            background: transparent;
        }
        
        /* 日曜日のセル */
        .calendar-day.sunday .day-number {
            color: #ff9999;
        }
        
        /* 土曜日のセル */
        .calendar-day.saturday .day-number {
            color: #9999ff;
        }
        
        /* ラッキーデー */
        .calendar-day.lucky-day {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.25), rgba(255, 215, 0, 0.15));
            border: 2px solid #ffd700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }
        
        /* パワーデー */
        .calendar-day.power-day {
            background: linear-gradient(135deg, rgba(147, 112, 219, 0.25), rgba(147, 112, 219, 0.15));
            border: 2px solid #9370DB;
        }
        
        /* 注意日 */
        .calendar-day.caution-day {
            background: rgba(255, 100, 100, 0.15);
            border: 1px solid rgba(255, 100, 100, 0.5);
        }
        
        /* 特別マーク */
        .special-mark {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 12px;
        }
        
        /* カレンダーの凡例 */
        .calendar-legend {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 20px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #d0d0ff;
            font-size: 13px;
        }
        
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .legend-dot.lucky {
            background: #ffd700;
            box-shadow: 0 0 8px rgba(255, 215, 0, 0.6);
        }
        
        .legend-dot.power {
            background: #9370DB;
            box-shadow: 0 0 8px rgba(147, 112, 219, 0.6);
        }
        
        .legend-dot.caution {
            background: rgba(255, 100, 100, 0.8);
        }
        
        .day-number {
            font-size: 16px;
            color: #ffffff;
            margin-bottom: 5px;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        
        .moon-emoji {
            font-size: 20px;
        }
        
        /* CTAボタン */
        .cta-section {
            text-align: center;
            margin: 60px 0;
            padding: 40px;
            background: linear-gradient(135deg, rgba(181,165,214,0.15) 0%, rgba(207,143,169,0.1) 100%);
            border-radius: 30px;
            border: 2px solid rgba(181,165,214,0.3);
        }
        
        .cta-title {
            font-size: 24px;
            color: #ffd700;
            margin-bottom: 15px;
            letter-spacing: 2px;
        }
        
        .cta-description {
            font-size: 14px;
            color: #e0e0ff;
            margin-bottom: 30px;
            line-height: 1.8;
            font-weight: 600;
        }
        
        .paid-features {
            text-align: left;
            max-width: 600px;
            margin: 0 auto 30px;
            list-style: none;
            padding: 0;
        }
        
        .paid-features li {
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            color: #ffffff;
            font-size: 15px;
        }
        
        .price-info {
            margin: 30px 0;
            font-size: 20px;
        }
        
        .price-label {
            color: #d0d0ff;
        }
        
        .price {
            color: #ffd700;
            font-size: 36px;
            font-weight: bold;
            margin: 0 10px;
        }
        
        .price-note {
            color: #a0a0e0;
            font-size: 14px;
        }
        
        .guarantee {
            margin-top: 20px;
            font-size: 13px;
            color: #a0a0e0;
            line-height: 1.6;
        }
        
        .cta-button {
            display: inline-block;
            padding: 18px 40px;
            background: linear-gradient(135deg, #E8A0BF 0%, #917FB3 100%);
            color: white;
            text-decoration: none;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            letter-spacing: 2px;
            transition: all 0.4s;
            box-shadow: 0 10px 30px rgba(232,160,191,0.4);
            position: relative;
        }
        
        .cta-button .button-subtitle {
            display: block;
            font-size: 12px;
            margin-top: 5px;
            opacity: 0.9;
            font-weight: normal;
        }
        
        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(232,160,191,0.6);
        }
        
        /* 最終メッセージ */
        .final-message {
            background: linear-gradient(135deg, rgba(255,140,255,0.08) 0%, rgba(255,100,150,0.05) 100%);
            border-radius: 20px;
            padding: 30px 20px;
            text-align: center;
            margin-bottom: 50px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        
        .final-message h3 {
            font-size: 24px;
            color: #ffd700;
            margin-bottom: 20px;
            letter-spacing: 2px;
        }
        
        .final-message p {
            font-size: 15px;
            color: #d0d0ff;
            line-height: 2;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        /* テキスト強調システム */
        .emphasis-critical {
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.2), rgba(255, 100, 100, 0.15));
            padding: 8px 15px;
            border-radius: 8px;
            position: relative;
            display: inline-block;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .emphasis-critical::before {
            content: "⭐ 重要";
            position: absolute;
            top: -10px;
            left: 10px;
            background: #ff4444;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .emphasis-important {
            border-bottom: 3px solid #ffd700;
            padding-bottom: 2px;
            font-weight: 600;
        }
        
        .emphasis-note {
            border-left: 4px solid #9370db;
            padding-left: 15px;
            margin: 20px 0;
            opacity: 0.95;
        }
        
        /* ビジュアルセパレーター */
        .star-separator {
            text-align: center;
            margin: 80px 0;
            position: relative;
            height: 50px;
        }
        
        .star-separator::before {
            content: "✦ ✦ ✦";
            font-size: 24px;
            color: #ffd700;
            letter-spacing: 20px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            animation: starTwinkle 3s ease-in-out infinite;
        }
        
        @keyframes starTwinkle {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        /* セクション内の見出しスタイル */
        .rhythm-heading {
            background: linear-gradient(135deg, #ffd700 0%, #ff9500 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 3px;
            display: inline-block;
            font-size: 22px;
            font-weight: bold;
            margin: 30px 0;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        /* サブバナー（流れ説明用） */
        .sub-banner {
            background: rgba(147, 112, 219, 0.08);
            border-left: 4px solid #9370db;
            padding: 20px 30px;
            margin: 40px 0;
            font-size: 20px;
            font-weight: bold;
            color: #ffffff;
            position: relative;
        }
        
        /* 月別ボックス */
        .month-box {
            margin: 35px 0;
            position: relative;
        }
        
        .month-label {
            display: inline-block;
            background: transparent;
            color: #ffd700;
            font-weight: 900;
            font-size: 14px;
            padding: 6px 14px;
            border: 2px solid #ffd700;
            border-radius: 2px;
            margin-bottom: 15px;
            letter-spacing: 1px;
        }
        
        .month-box h3 {
            color: #ff9f9f;
            margin: 0 0 12px 0;
            font-size: 22px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .month-box p {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.8;
            margin: 0;
        }
        
        .monthly-sections {
            margin: 30px 0;
        }
        
        /* ポイントボックス */
        .point-box {
            background: rgba(255, 50, 50, 0.05);
            border-left: 4px solid #ff5555;
            padding: 20px 20px 20px 25px;
            margin: 35px 0;
            position: relative;
        }
        
        .point-box strong {
            color: #ff6666;
            font-size: 16px;
            display: block;
            margin-bottom: 12px;
            letter-spacing: 0.5px;
        }
        
        .point-box p {
            margin: 0;
            line-height: 1.8;
        }
        
        /* ハイライトバナー（転機用） */
        .highlight-banner {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #0a1628;
            padding: 14px 24px;
            margin: 30px 0;
            font-weight: 900;
            font-size: 20px;
            text-align: center;
            border-radius: 2px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            letter-spacing: 0.5px;
        }
        
        .highlight-banner::after {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: slideShine 2.5s infinite;
        }
        
        @keyframes slideShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        /* 視覚的休憩ゾーン */
        .visual-break {
            height: 150px;
            background: radial-gradient(ellipse at center, rgba(100, 100, 255, 0.1) 0%, transparent 70%);
            margin: 60px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
        }
        
        /* CTAボタン強化 */
        .cta-main {
            display: inline-block;
            padding: 20px 50px;
            background: linear-gradient(135deg, 
                #ff6b6b 0%, 
                #ffd700 25%, 
                #32ff80 50%, 
                #6b6bff 75%, 
                #ff6bff 100%);
            background-size: 200% 200%;
            animation: rainbowShift 3s ease infinite;
            color: white;
            font-size: 20px;
            font-weight: 900;
            border-radius: 50px;
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 10px 40px rgba(255, 107, 107, 0.4);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .cta-main::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes rainbowShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .cta-main:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 50px rgba(255, 107, 107, 0.6);
        }
        
        .cta-sub {
            display: inline-block;
            padding: 15px 35px;
            background: transparent;
            border: 2px solid #ffd700;
            color: #ffd700;
            font-size: 16px;
            font-weight: bold;
            border-radius: 30px;
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .cta-sub:hover {
            background: rgba(255, 215, 0, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
        }
        
        /* レスポンシブ対応 */
        @media (max-width: 768px) {
            .moon-types-circle {
                width: calc(100vw - 40px);
                max-width: 320px;
                height: calc(100vw - 40px);
                max-height: 320px;
            }
            
            .type-item {
                width: 85px;
                height: 85px;
                font-size: 12px;
                padding: 8px;
            }
            
            .type-label {
                font-size: 11px;
                margin-bottom: 3px;
            }
            
            .type-result {
                font-size: 11px;
                font-weight: bold;
                color: #ffd700;
            }
            
            .center-moon {
                width: 90px;
                height: 90px;
            }
            
            .energy-types {
                grid-template-columns: 1fr;
            }
            
            .love-type-grid {
                grid-template-columns: 1fr;
            }
            
            .moon-phase-header {
                flex-direction: column;
                text-align: center;
            }
            
            .calendar-wrapper {
                padding: 10px;
            }
            
            .weekday-header {
                gap: 5px;
            }
            
            .weekday {
                font-size: 12px;
            }
            
            .calendar-grid {
                gap: 5px;
            }
            
            .calendar-day {
                font-size: 11px;
                padding: 5px;
                min-width: 0;
            }
            
            .day-number {
                font-size: 12px;
            }
            
            .moon-emoji {
                font-size: 16px;
            }
        }
        
        /* 月詠キャラクター強化 */
        .tsukuyomi-section {
            position: relative;
            margin: 60px 0;
            display: flex;
            align-items: flex-start;
            gap: 25px;
            transition: all 0.3s ease;
        }
        
        .tsukuyomi-section:hover .tsukuyomi-character {
            transform: scale(1.1);
            filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.5));
        }
        
        .tsukuyomi-character {
            flex-shrink: 0;
            width: 180px;
            height: 180px;
            transition: all 0.5s ease;
            animation: characterFloat 4s ease-in-out infinite;
            position: relative;
        }
        
        .tsukuyomi-character img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 5px 15px rgba(100, 100, 255, 0.3));
        }
        
        .tsukuyomi-bubble {
            flex: 1;
            background: linear-gradient(135deg, rgba(22,33,62,0.95) 0%, rgba(53,80,112,0.9) 100%);
            border-radius: 20px;
            padding: 20px 25px;
            position: relative;
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            backdrop-filter: blur(10px);
        }
        
        .tsukuyomi-bubble::before {
            content: "";
            position: absolute;
            left: -10px;
            top: 30px;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 10px 10px 10px 0;
            border-color: transparent rgba(255,255,255,0.1) transparent transparent;
        }
        
        .tsukuyomi-name {
            font-size: 14px;
            color: #ffd700;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }
        
        .tsukuyomi-bubble p {
            font-size: 18px;
            line-height: 2.1;
            color: #f0f0ff;
        }
        
        /* 右側配置のキャラクター */
        .tsukuyomi-section.right {
            flex-direction: row-reverse;
        }
        
        .tsukuyomi-section.right .tsukuyomi-bubble::before {
            left: auto;
            right: -10px;
            border-width: 10px 0 10px 10px;
            border-color: transparent transparent transparent rgba(255,255,255,0.1);
        }
        
        @media (max-width: 768px) {
            .tsukuyomi-section {
                flex-direction: row;
                align-items: flex-start;
                margin: 30px 0;
                padding: 0 10px;
                gap: 10px;
            }
            
            .tsukuyomi-section.right {
                flex-direction: row-reverse;
            }
            
            .tsukuyomi-character {
                width: 80px;
                height: 80px;
                flex-shrink: 0;
                margin: 0;
            }
            
            .tsukuyomi-character img {
                width: 100%;
                height: 100%;
                object-fit: contain;
            }
            
            .tsukuyomi-bubble {
                flex: 1;
                padding: 15px;
                margin: 0;
                box-sizing: border-box;
            }
            
            .tsukuyomi-bubble::before {
                content: "";
                position: absolute;
                left: -8px;
                top: 20px;
                width: 0;
                height: 0;
                border-style: solid;
                border-width: 8px 8px 8px 0;
                border-color: transparent rgba(255,255,255,0.1) transparent transparent;
            }
            
            .tsukuyomi-section.right .tsukuyomi-bubble::before {
                left: auto;
                right: -8px;
                border-width: 8px 0 8px 8px;
                border-color: transparent transparent transparent rgba(255,255,255,0.1);
            }
            
            .tsukuyomi-bubble p {
                font-size: 16px;
                line-height: 2;
            }
            
            .tsukuyomi-name {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- スクロール進捗バー -->
    <div class="scroll-progress" id="scrollProgress"></div>
    <!-- 星空背景 -->
    <div class="stars-container" id="starsContainer"></div>
    
    <!-- メインコンテンツ -->
    <div class="container">
        <!-- ヘッダー -->
        <div class="header">
            <div class="main-moon"></div>
            <img src="/images/banner/1-title.png" alt="おつきさま診断" style="max-width: 100%; height: auto; margin: 10px 0 5px;">
            <p class="subtitle">月が導くあなたの運命</p>
            <p class="sub-description">
                生まれた日の月相から読み解く、あなただけの特別な運勢メッセージ
            </p>
        </div>
        
        <!-- フォームセクション -->
        <div class="form-section" id="formSection">
            <h2 class="form-title">あなたの生年月日を教えてください</h2>
            
            <form id="moonForm">
                <div class="form-group">
                    <label>お名前（ニックネーム可）<span class="required">*必須</span></label>
                    <input type="text" id="name" placeholder="例：月読みゆき" required>
                </div>
                
                <div class="form-group">
                    <label>生年月日<span class="required">*必須</span></label>
                    <div class="date-selects">
                        <select id="year" required>
                            <option value="">年</option>
                        </select>
                        <select id="month" required>
                            <option value="">月</option>
                        </select>
                        <select id="day" required>
                            <option value="">日</option>
                        </select>
                    </div>
                </div>
                
                <button type="submit">
                    診断する
                    <div class="button-subtitle">無料で全ての結果が見れます</div>
                </button>
            </form>
        </div>
        
        <!-- 結果セクション -->
        <div class="result-section" id="resultSection">
            <!-- 月詠の挨拶 -->
            <div class="tsukuyomi-section">
                <div class="tsukuyomi-character">
                    <img src="/images/tsukuyomi/2.png" alt="月詠">
                </div>
                <div class="tsukuyomi-bubble">
                    <div class="tsukuyomi-name">月詠</div>
                    <p>
                        こんにちは、<span id="resultName"></span>さん。私は月詠（つくよみ）と申します。今夜の月が、あなたの運命を照らし出します。あなたが生まれた日の月は、特別な形をしていました。その月が持つメッセージを、今からお伝えしていきますね。
                    </p>
                </div>
            </div>
            
            <!-- 月相診断結果 -->
            <div id="userMoonPhase"></div>
            
            <!-- タイプ診断タイトル -->
            <img src="/images/banner/2-anata.png" alt="おつきさま診断で読み解くあなた" style="max-width: 100%; height: auto; margin: 15px 0 5px;">
            
            <!-- 月詠による診断説明 -->
            <div class="tsukuyomi-section right">
                <div class="tsukuyomi-character">
                    <img src="/images/tsukuyomi/4.png" alt="月詠">
                </div>
                <div class="tsukuyomi-bubble">
                    <div class="tsukuyomi-name">月詠</div>
                    <p>
                        さて、ここからが本題です。これから、あなたの生まれた日の月相を基に、6つの要素からあなたの本質を明らかにしていきます。まずは、この6つの要素が何を意味するのかご覧ください。
                    </p>
                </div>
            </div>
            
            <!-- 6つのタイプを円形配置 -->
            <div class="moon-types-circle">
                <!-- 軌道線 -->
                <div class="orbit-path"></div>
                
                <!-- 中心の月 -->
                <div class="center-moon"></div>
                
                <!-- 要素コンテナ -->
                <div class="elements-container">
                    <!-- 月相 (0度 - 上) -->
                    <div class="type-item moon-phase-item" style="left: 160px; top: 20px;" data-moon-type="omote" data-moon-phase="0">
                        <img src="/images/moon/omote-0.png" alt="新月" style="width: 100%; height: 100%; object-fit: cover;">
                        <span style="position: absolute; top: -30px; left: 50%; transform: translateX(-50%); white-space: nowrap; color: #ffd700; font-weight: bold; font-size: 13px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); z-index: 20;">月相</span>
                        <span style="position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); white-space: nowrap; color: #ffffff; font-weight: bold; font-size: 12px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); z-index: 20;">新月</span>
                    </div>
                    
                    <!-- 裏月相 (60度) -->
                    <div class="type-item moon-phase-item" style="left: 281px; top: 90px;" data-moon-type="ura" data-moon-phase="1">
                        <img src="/images/moon/ura-1.png" alt="三日月" style="width: 100%; height: 100%; object-fit: cover;">
                        <span style="position: absolute; top: -30px; left: 50%; transform: translateX(-50%); white-space: nowrap; color: #b464ff; font-weight: bold; font-size: 13px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); z-index: 20;">裏月相</span>
                        <span style="position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); white-space: nowrap; color: #ffffff; font-weight: bold; font-size: 12px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); z-index: 20;">三日月</span>
                    </div>
                    
                    <!-- 感情表現 (120度) -->
                    <div class="type-item love-type-item" style="left: 281px; top: 230px; overflow: visible;" data-type="emotional" data-value="straight">
                        <img src="/images/love-types/emotional/straight.png" alt="ストレート型" style="width: 100%; height: 100%; object-fit: contain;">
                        <span style="position: absolute; top: -30px; left: 50%; transform: translateX(-50%); white-space: nowrap; color: #ff64b4; font-weight: bold; font-size: 13px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); z-index: 20;">感情表現</span>
                        <span style="position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); white-space: nowrap; color: #ffffff; font-weight: bold; font-size: 12px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); z-index: 20;">ストレート型</span>
                    </div>
                    
                    <!-- 距離感 (180度 - 下) -->
                    <div class="type-item love-type-item" style="left: 160px; top: 300px; overflow: visible;" data-type="distance" data-value="independent">
                        <img src="/images/love-types/distance/independent.png" alt="自由マイペース型" style="width: 100%; height: 100%; object-fit: contain;">
                        <span style="position: absolute; top: -30px; left: 50%; transform: translateX(-50%); white-space: nowrap; color: #32ffb4; font-weight: bold; font-size: 13px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); z-index: 20;">距離感</span>
                        <span style="position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); white-space: nowrap; color: #ffffff; font-weight: bold; font-size: 12px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); z-index: 20;">自由マイペース型</span>
                    </div>
                    
                    <!-- 価値観 (240度) -->
                    <div class="type-item love-type-item" style="left: 39px; top: 230px; overflow: visible;" data-type="values" data-value="romantic">
                        <img src="/images/love-types/values/romantic.png" alt="ロマンチスト型" style="width: 100%; height: 100%; object-fit: contain;">
                        <span style="position: absolute; top: -30px; left: 50%; transform: translateX(-50%); white-space: nowrap; color: #64c8ff; font-weight: bold; font-size: 13px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); z-index: 20;">価値観</span>
                        <span style="position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); white-space: nowrap; color: #ffffff; font-weight: bold; font-size: 12px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); z-index: 20;">ロマンチスト型</span>
                    </div>
                    
                    <!-- エネルギー (300度) -->
                    <div class="type-item love-type-item" style="left: 39px; top: 90px; overflow: visible;" data-type="energy" data-value="intense">
                        <img src="/images/love-types/energy/intense.png" alt="燃え上がり型" style="width: 100%; height: 100%; object-fit: contain;">
                        <span style="position: absolute; top: -30px; left: 50%; transform: translateX(-50%); white-space: nowrap; color: #ff7832; font-weight: bold; font-size: 13px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); z-index: 20;">エネルギー</span>
                        <span style="position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); white-space: nowrap; color: #ffffff; font-weight: bold; font-size: 12px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); z-index: 20;">燃え上がり型</span>
                    </div>
                </div>
            </div>
            
            <p class="section-description">
                生まれた日の月相から読み解く、あなたの「本当の自分」
            </p>
            
            <!-- 月相説明セクション -->
            <div style="padding: 20px 0 10px; text-align: center;">
                <img src="/images/banner/3-getsusou.png" alt="まずは、あなたの月相から見ていきましょう" style="max-width: 100%; height: auto; margin-bottom: 5px;">
                <p style="color: #ffffff; font-size: 18px; font-weight: 600; line-height: 2; margin-bottom: 5px; text-shadow: 1px 1px 3px rgba(0,0,0,0.5);">
                    月相とは、あなたが生まれた日の月の形。これによって、あなたの基本的な性格や人生のテーマがわかります。あなたの月相は...
                </p>
            </div>
            
            <!-- 月相タイプ -->
            <div class="moon-phase-card new-moon">
                <div class="moon-phase-header">
                    <img src="/images/moon/omote-0.png" alt="新月" class="moon-phase-visual" style="width: 120px; height: 120px; object-fit: cover; border-radius: 50%; flex-shrink: 0;">
                    <div class="moon-phase-info">
                        <h2>新月</h2>
                        <p class="moon-phase-subtitle">新しい始まりの力。無限の可能性を秘めた開拓者</p>
                    </div>
                </div>
                <div class="moon-phase-description">
                    あなたは新月の日に生まれた、始まりのエネルギーを持つ人。何もないところから何かを生み出す力があり、ゼロから1を作り出すことに長けています。純粋で素直な心を持ち、新しいことへの好奇心が旺盛。まだ誰も踏み入れていない道を進むパイオニア精神があります。時に無鉄砲に見えることもありますが、その勇気こそがあなたの最大の武器なのです。
                </div>
            </div>
            
            <!-- 裏月相説明 -->
            <div style="padding: 20px 0 10px; text-align: center;">
                <img src="/images/banner/4-2-uranokao.png" alt="そして、あなたの裏の顔も見てみましょう" style="max-width: 100%; height: auto; margin-bottom: 5px;">
                <p style="color: #ffffff; font-size: 18px; font-weight: 600; line-height: 1.8; text-shadow: 1px 1px 3px rgba(0,0,0,0.5);">
                    表の月相が社会的な顔だとすれば、裏月相はあなたのプライベートな顔。親しい人の前でだけ見せる、もう一つのあなたです。
                </p>
            </div>
            
            <!-- 裏月相 -->
            <div class="moon-phase-card crescent">
                <div class="moon-phase-header">
                    <img src="/images/moon/ura-1.png" alt="三日月" class="moon-phase-visual" style="width: 120px; height: 120px; object-fit: cover; border-radius: 50%; flex-shrink: 0;">
                    <div class="moon-phase-info">
                        <h2>三日月（裏の顔）</h2>
                        <p class="moon-phase-subtitle">内なる繊細さと慎重さを秘めた策士</p>
                    </div>
                </div>
                <div class="moon-phase-description">
                    表向きは勢いよく突き進むあなたですが、実は内面では細やかな配慮ができる繊細な人。新しいことを始める前に、実はしっかりと下調べをしていたり、リスクを計算していたりするでしょう。その慎重さと大胆さのバランスが、あなたの成功の秘訣。時々弱音を吐きたくなることもありますが、それは成長の証です。
                </div>
            </div>
            
            <!-- 3つの月の力セクション -->
            <div style="padding: 20px 0 10px; text-align: center;">
                <img src="/images/banner/5-1-3tsuno.png" alt="あなたが持っている3つの力は〇〇です" style="max-width: 100%; height: auto; margin-bottom: 5px;">
                <p style="color: #ffffff; font-size: 18px; font-weight: 600; line-height: 2; text-shadow: 1px 1px 3px rgba(0,0,0,0.5);">
                    さらに深く、あなたの月が持つ特別な力を見ていきましょう。月には3つの力があり、それぞれがあなたの人生を導いています。
                </p>
            </div>
            
            <div class="energy-types three-powers">
                <div class="energy-item">
                    <div class="energy-title">直感力</div>
                    <div class="energy-description">
                        第六感が鋭く、見えない危険を察知する能力があります。迷った時は、理屈より直感を信じることで正しい道を選べるでしょう。
                    </div>
                </div>
                <div class="energy-item">
                    <div class="energy-title">創造力</div>
                    <div class="energy-description">
                        無から有を生み出す力。アイデアが湧き出る泉のような存在で、周りの人に新しい視点を与えることができます。
                    </div>
                </div>
                <div class="energy-item">
                    <div class="energy-title">浄化力</div>
                    <div class="energy-description">
                        ネガティブなエネルギーを跳ね返し、周りの空気を清める力。あなたがいるだけで、場の雰囲気が明るくなります。
                    </div>
                </div>
            </div>
            
            <!-- 4つの軸からあなたを紐解く -->
            <div style="padding: 20px 0 10px; text-align: center;">
                <img src="/images/banner/5-2-tikara.png" alt="4つの軸からあなたを紐解く" style="max-width: 100%; height: auto; margin-bottom: 5px;">
                <p style="color: #ffffff; font-size: 18px; font-weight: 600; line-height: 2; text-shadow: 1px 1px 3px rgba(0,0,0,0.5);">
                    次に、4つの軸から見たあなたの特性を見ていきます。
                </p>
            </div>
            
            <div class="love-type-grid">
                <div class="love-type-card">
                    <div class="love-type-title">
                        <img src="/images/love-types/emotional/straight.png" alt="ストレート型">
                        感情表現：<span id="emotionalExpressionType">ストレート型</span>
                    </div>
                    <div class="love-type-content" id="emotionalExpressionContent">
                        好きな人には素直に気持ちを伝えるタイプ。駆け引きは苦手で、思ったことがすぐ顔に出てしまいます。その純粋さが、相手の心を動かす最大の魅力。
                    </div>
                </div>
                <div class="love-type-card">
                    <div class="love-type-title">
                        <img src="/images/love-types/distance/independent.png" alt="自由マイペース型">
                        距離感：<span id="distanceStyleType">自由マイペース型</span>
                    </div>
                    <div class="love-type-content" id="distanceStyleContent">
                        束縛されることを嫌い、自分のペースを大切にします。相手にも自由を与え、お互いに成長できる関係を理想とします。
                    </div>
                </div>
                <div class="love-type-card">
                    <div class="love-type-title">
                        <img src="/images/love-types/values/romantic.png" alt="ロマンチスト型">
                        価値観：<span id="loveValuesType">ロマンチスト型</span>
                    </div>
                    <div class="love-type-content" id="loveValuesContent">
                        あなたは恋愛に夢と理想を求め、映画や小説のような美しい物語を紡ぎたいタイプです。運命の出会い、劇的な告白、記念日のサプライズ、全てにドラマチックな演出を求めます。日常の中にも特別な瞬間を見出し、二人だけの思い出を大切に積み重ねていきます。<br><br>
                        初デートの場所、初めてのキス、プロポーズの瞬間、全てにこだわりを持ち、完璧なシチュエーションを演出したいと考えます。記念日は必ず特別な計画を立て、相手を驚かせ感動させることに喜びを感じます。写真や動画で思い出を記録し、二人の恋愛史を美しく残していきます。<br><br>
                        言葉選びも詩的で、「愛してる」だけでなく「君は僕の太陽だ」「運命の人に出会えた」といったロマンチックな表現を使います。相手にも同じような情熱的な愛情表現を期待し、日常の中に非日常的な愛を求めます。<br><br>
                        このタイプの素晴らしさは、恋愛を特別なものとして大切にし、相手を心から幸せにしようとすること。現実的な問題に直面した時も、愛の力で乗り越えられると信じています。時に理想が高すぎることもありますが、その純粋な愛への憧れは、パートナーシップに魔法のような輝きを与え、忘れられない愛の物語を作り出すでしょう。
                    </div>
                </div>
                <div class="love-type-card">
                    <div class="love-type-title">
                        <img src="/images/love-types/energy/intense.png" alt="燃え上がり型">
                        エネルギー：<span id="loveEnergyType">燃え上がり型</span>
                    </div>
                    <div class="love-type-content" id="loveEnergyContent">
                        あなたは恋愛において、一気に感情が燃え上がるタイプです。好きになったら全速力でアプローチし、恋愛モードに入ると他のことが手につかなくなるほど。その情熱的な恋愛スタイルは、まさに恋の炎が激しく燃え上がる様子そのものです。<br><br>
                        出会って「ビビッ」ときたら、すぐに行動開始。相手のSNSを全てチェックし、共通の話題を見つけ、デートに誘うまでが超スピード。付き合い始めたら毎日でも会いたいし、会えない時は一日中相手のことを考えています。仕事中も相手からのLINEが気になって仕方ありません。<br><br>
                        愛情表現も情熱的で、「世界で一番愛してる」「君なしでは生きていけない」といった激しい言葉を使います。プレゼントも奮発し、サプライズも全力投球。相手を喜ばせるためなら、どんな努力も惜しみません。この期間のあなたのエネルギーは、まさに恋愛に全振り状態です。<br><br>
                        この激しい恋愛スタイルは、相手に「こんなに愛されている」という強い実感を与えます。ただし、燃え上がりが激しい分、落ち着いた後のギャップに注意が必要かもしれません。でも、その純粋で情熱的な愛は、忘れられない恋愛体験を作り出し、相手の人生に強烈な印象を残すでしょう。初期の情熱を上手にコントロールできれば、深い愛情へと昇華していきます。
                    </div>
                </div>
            </div>
            
            <!-- 月詠による恋愛タイプ総括 -->
            <div class="tsukuyomi-section">
                <div class="tsukuyomi-character">
                    <img src="/images/tsukuyomi/5.png" alt="月詠">
                </div>
                <div class="tsukuyomi-bubble">
                    <div class="tsukuyomi-name">月詠</div>
                    <p>
                        いかがでしたでしょうか。あなた自身、自覚していた面も、初めて意識した面もあったと思います。これらすべてが、あなたという月の持つ多面的な輝きなのです。
                    </p>
                </div>
            </div>
            
            <!-- 月詠による直近3ヶ月導入 -->
            <div class="tsukuyomi-section right">
                <div class="tsukuyomi-character">
                    <img src="/images/tsukuyomi/7.png" alt="月詠">
                </div>
                <div class="tsukuyomi-bubble">
                    <div class="tsukuyomi-name">月詠</div>
                    <p>
                        ここまで、あなたの月相、裏の顔、3つの月の力、そして4つの軸から見たあなたの本質を見てきました。これらすべてを踏まえて、いよいよ<span style="color: #ffd700; font-weight: bold; font-size: 20px;">直近3ヶ月のあなたに訪れる運命</span>を読み解いていきます。全体運から始まり、恋愛運、人間関係運、仕事運、金運...月のリズムが教えてくれる、あなただけの3ヶ月の集中的なストーリーをお届けしますね。
                    </p>
                </div>
            </div>
            
            <!-- 総合恋愛タイプ診断 -->
            <div id="combinedPersonality" style="margin: 40px 0;"></div>
            
            <!-- 相性の良いタイプ -->
            <div id="compatibleTypes" style="margin: 30px 0;"></div>
            
            <!-- スターセパレーター -->
            <div class="star-separator"></div>
            
            <!-- 直近3ヶ月全体運バナー -->
            <img src="/images/banner/7-unmei.png" alt="直近3ヶ月の運命" style="max-width: 100%; height: auto; margin: 15px 0 5px;">
            
            <!-- 運勢グラフセクション -->
            <div class="fortune-graph-section" style="margin: 40px 0;">
                <div style="background: linear-gradient(135deg, rgba(20, 10, 50, 0.95), rgba(40, 20, 70, 0.95)); padding: 20px 15px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                    <h4 style="color: #ffd700; margin-bottom: 20px; text-align: center; font-size: 24px; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">
                        3ヶ月の運勢推移グラフ
                    </h4>
                    <p style="text-align: center; color: rgba(255,255,255,0.8); margin-bottom: 25px; font-size: 14px;">
                        あなたの運勢の波を可視化しました
                    </p>
                    
                    <!-- グラフコンテナー -->
                    <div style="background: rgba(0, 0, 0, 0.2); border-radius: 10px; padding: 10px; position: relative;">
                        <div style="height: 420px;">
                            <canvas id="fortuneChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- グラフの解説 -->
                    <div id="graphDescription"></div>
                    <div style="margin-top: 20px; padding: 15px; background: rgba(255, 215, 0, 0.1); border-radius: 10px; border-left: 3px solid #ffd700;">
                        <p style="color: #ffd700; font-size: 14px; margin: 0 0 8px; font-weight: bold;">グラフの見方</p>
                        <p style="color: rgba(255, 255, 255, 0.8); font-size: 12px; line-height: 1.6; margin: 0;">
                            このグラフは、あなたの直近3ヶ月（12週間）の運気の流れを表しています。<br>
                            • 運気が上がるタイミングが一目でわかります<br>
                            • ピーク時期を見極めて、大事な行動を計画しましょう<br>
                            • 波が下がる時期はエネルギーを蓄える大切な準備期間です
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- 直近3ヶ月全体運 -->
            <div class="fortune-section destiny">
                <div class="section-header">
                    <h2 class="rhythm-heading">創造と情熱が交差する集中期</h2>
                    <p>
                        この3ヶ月は『創造と情熱が交差する集中期』のリズム。短期間で大きな変化が起きそうです。直近3ヶ月は、あなたにとって即座に行動し成果を得る期間。新月のエネルギーが最高潮に達し、素早く新しいことを始め、すぐに結果を得られる最適な時期です。
                    </p>
                </div>
                
                <div class="fortune-content">
                    <div class="fortune-highlight">
                        <div class="sub-banner">直近3ヶ月の全体的な流れ</div>
                        <p class="fortune-overall-text">
                            直近3ヶ月は、あなたにとって集中的な変化と成長を経験する重要な期間となります。新月の創造力と満月の情熱が短期間で絶妙に混ざり合い、驚くほど素早く大きな成果を生み出すでしょう。特に診断から1ヶ月目と3ヶ月目には、人生を変えるような重要な出来事が起こります。診断から1ヶ月後の新月と、2ヶ月後の満月は特に重要な日。この日に始めたことは、3ヶ月以内に大きな実を結ぶでしょう。
                        </p>
                    </div>
                    
                    <div class="monthly-sections">
                        <div class="month-box">
                            <span class="month-label">1ヶ月目</span>
                            <h3>集中スタート期</h3>
                            <p>過去の整理と即座の行動開始。新月の創造力が活性化し、革新的なアイデアが次々と湧いてきます。この月には重要な出会いがあり、すぐに行動に移すことで月末には最初の成果が見え始めるでしょう。</p>
                        </div>
                        <div class="month-box">
                            <span class="month-label">2ヶ月目</span>
                            <h3>加速展開期</h3>
                            <p>1ヶ月目の種が急速に成長。満月の情熱が加わり、行動力が最高潮に達します。予想外の展開が起き、重要な決断を迫られますが、直感に従うことで大きな飛躍につながります。</p>
                        </div>
                        <div class="month-box">
                            <span class="month-label">3ヶ月目</span>
                            <h3>結果収穫期</h3>
                            <p>これまでの努力が短期間で実を結ぶ。周囲からの評価が急上昇し、金運も大幅に向上します。3ヶ月の総仕上げとして大きな成果を手にし、次の3ヶ月への確固たる基盤を築きます。</p>
                        </div>
                    </div>
                    
                    <div class="point-box">
                        <strong>⚠️ 注意ポイント</strong>
                        <p>
                            ただし、注意すべきは診断から2ヶ月目の満月期。この時期は感情が高ぶりやすく、衝動的な決断をしがちです。大切な決定は、一度冷静になってから行いましょう。特に2ヶ月目中旬は、新月と満月のエネルギーが衝突しやすく、内面的な葛藤を感じることがあるかもしれませんが、この葛藤こそが大きな成長の源となります。
                        </p>
                    </div>
                    
                    <p>
                        全体として、この3ヶ月はあなたにとって「創造と情熱の集中融合期」。短期間で過去にとらわれず、新しい自分として生まれ変わるチャンスです。月のリズムに従って、積極的かつ自然体で進んでいけば、驚くほど早く良い結果が現れます。新月の直感力と満月の表現力を活かし、たった3ヶ月でこれまでにない大きな成果を手にすることができるでしょう。
                    </p>
                    
                    <div class="fortune-highlight">
                        <div class="highlight-banner">重要な転機の時期</div>
                        <p>
                            第1の転機：診断から1ヶ月後。新しい出会いや機会がすぐに訪れ、人生の方向性が急速に変わる可能性があります。この時期の決断は、今後の3ヶ月全体を左右する重要なものとなるでしょう。
                        </p>
                        <p>
                            第2の転機：診断から2ヶ月後。1ヶ月目の努力がすぐに認められ、大きなチャンスが立て続けに巡ってきます。勇気を出して一歩踏み出すことで、短期間で想像以上の成果を得られるでしょう。
                        </p>
                        <p>
                            第3の転機：診断から3ヶ月後。3ヶ月の総決算として、驚くほど大きな成果を手にします。同時に、次の3ヶ月への明確な目標と確実な基盤も見えてくるでしょう。
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- 月詠による恋愛運への移行 -->
            <div class="tsukuyomi-section">
                <div class="tsukuyomi-character">
                    <img src="/images/tsukuyomi/7.png" alt="月詠">
                </div>
                <div class="tsukuyomi-bubble">
                    <div class="tsukuyomi-name">月詠</div>
                    <p>
                        全体運を踏まえて、次に気になるのは恋愛運ですね。直近3ヶ月、あなたの恋愛にはどんな展開が待っているのでしょうか。月の導きから、あなたの恋の行方を詳しく見ていきましょう。
                    </p>
                </div>
            </div>
            
            <!-- 恋愛運バナー -->
            <img src="/images/banner/8-rennai.png" alt="あなたの恋愛運" style="max-width: 100%; height: auto; margin: 15px 0 5px;">
            
            <!-- 恋愛運 -->
            <div class="fortune-section love">
                <div class="section-header">
                    <p>
                        この3ヶ月は、短期間で集中的に情熱的で運命的な恋が訪れますよ。新月タイプのあなたは、相手の心に新しい風を即座に吹き込む存在。初対面から強い印象を残し、短期間で相手の人生に大きな変化をもたらすでしょう。
                    </p>
                </div>
                
                <div class="fortune-content">
                    <div class="fortune-highlight">
                        <div class="sub-banner">直近3ヶ月の恋愛運の特徴</div>
                        <p class="fortune-love-text">
                            新月タイプのあなたは、相手の心に新しい風を即座に吹き込む存在。初対面から強い印象を残し、短期間で相手の人生に大きな変化をもたらすでしょう。
                        </p>
                    </div>
                    
                    <div class="monthly-sections">
                        <div class="month-box">
                            <span class="month-label">1ヶ月目</span>
                            <h3>運命的な出会い期</h3>
                            <p>新しく始めた習い事やオンラインコミュニティで、運命の人と出会う可能性大。特に新月の日は最強の出会い運。</p>
                        </div>
                        <div class="month-box">
                            <span class="month-label">2ヶ月目</span>
                            <h3>情熱的な発展期</h3>
                            <p>裏の満月の力で、濃密かつ情熱的な愛情を注ぐことができる時期。満月の日は告白やプロポーズに最適。</p>
                        </div>
                        <div class="month-box">
                            <span class="month-label">3ヶ月目</span>
                            <h3>関係確立期</h3>
                            <p>これまでの関係が確固たるものに。複数の人から好意を寄せられるかもしれませんが、直感に従って選ぶことで幸せに。</p>
                        </div>
                    </div>
                    
                    <div class="point-box">
                        <strong>⚠️ 恋愛の注意ポイント</strong>
                        <p>
                            診断から2ヶ月目中旬の満月期は感情的になりやすいので要注意。短期間で結論を急がず冷静さを保つことが大切。
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- 月詠による月齢カレンダーへの移行 -->
            <div class="tsukuyomi-section">
                <div class="tsukuyomi-character">
                    <img src="/images/tsukuyomi/5.png" alt="月詠">
                </div>
                <div class="tsukuyomi-bubble">
                    <div class="tsukuyomi-name">月詠</div>
                    <p>
                        ここで特別なプレゼントがあります！恋愛運をさらに活かすために、あなただけの特別な月齢カレンダーをお伝えしますね。
                    </p>
                </div>
            </div>
            
            <!-- 月齢カレンダー -->
            <div class="monthly-fortune">
                <h4 style="color: #ffd700; font-size: 22px; text-align: center; margin-bottom: 20px; font-weight: bold; text-shadow: 1px 1px 3px rgba(0,0,0,0.5);">
                    あなただけの月齢カレンダー（<span id="calendarMonthYear"></span>）
                </h4>
                <div class="calendar-wrapper">
                    <div class="weekday-header">
                        <div class="weekday">日</div>
                        <div class="weekday">月</div>
                        <div class="weekday">火</div>
                        <div class="weekday">水</div>
                        <div class="weekday">木</div>
                        <div class="weekday">金</div>
                        <div class="weekday">土</div>
                    </div>
                    <div id="personalizedCalendar" class="calendar-grid">
                        <!-- JavaScriptで動的に生成 -->
                    </div>
                </div>
                <div class="calendar-legend">
                    <span class="legend-item"><span class="legend-dot lucky"></span>ラッキーデー</span>
                    <span class="legend-item"><span class="legend-dot power"></span>パワーデー</span>
                    <span class="legend-item"><span class="legend-dot caution"></span>注意日</span>
                </div>
                <p id="calendarMessage" style="color: #ffffff; text-align: center; margin-top: 20px; font-size: 16px; font-weight: 600; text-shadow: 1px 1px 3px rgba(0,0,0,0.5);">
                    <!-- パターンごとのメッセージが動的に表示 -->
                </p>
            </div>
            
            <!-- 月詠による人間関係運への移行 -->
            <div class="tsukuyomi-section right">
                <div class="tsukuyomi-character">
                    <img src="/images/tsukuyomi/4.png" alt="月詠">
                </div>
                <div class="tsukuyomi-bubble">
                    <div class="tsukuyomi-name">月詠</div>
                    <p>
                        恋愛運はいかがでしたか？さて、恋愛だけでなく、すべての人間関係も見ていきましょう。直近3ヶ月、あなたの周りにはどんな人が集まってくるのでしょうか。
                    </p>
                </div>
            </div>
            
            <!-- 人間関係運バナー -->
            <img src="/images/banner/9-ningenn.png" alt="人間関係運" style="max-width: 100%; height: auto; margin: 15px 0 5px;">
            
            <!-- 人間関係運 -->
            <div class="fortune-section relationship">
                <div class="section-header">
                    <p class="fortune-relationship-text">
                        新しい仲間との出会いが多い3ヶ月。あなたの持つ開拓者精神に共感する人たちが集まってきて、一緒に何か新しいことを始めることになりそう。
                    </p>
                </div>
                
                <div class="fortune-content">
                    <div class="sub-banner">直近3ヶ月で出会う3人のキーパーソン</div>
                    <div class="monthly-sections">
                        <div class="month-box">
                            <span class="month-label">1ヶ月目</span>
                            <h3>メンター的存在との出会い</h3>
                            <p>あなたに新しい視点を与えてくれる年上の人物。この人との出会いが、3ヶ月全体の方向性を決定づけます。</p>
                        </div>
                        <div class="month-box">
                            <span class="month-label">2ヶ月目</span>
                            <h3>協力パートナーの登場</h3>
                            <p>一緒にプロジェクトを立ち上げる同志が現れます。互いの長所を活かし合える理想的な関係に。</p>
                        </div>
                        <div class="month-box">
                            <span class="month-label">3ヶ月目</span>
                            <h3>サポーターとの縁</h3>
                            <p>あなたの弱点を補ってくれる存在と出会います。この人のおかげで、大きな成果を得られるでしょう。</p>
                        </div>
                    </div>
                    
                    <div class="highlight-banner">人間関係の転機</div>
                    <p>
                        人間関係で最も重要な時期は、診断から1ヶ月後の新月と2ヶ月後の満月。この日に出会った人や、この日に深まった関係は、あなたの人生に大きな影響を与えることになるでしょう。
                    </p>
                    
                    <div class="point-box">
                        <strong>⚠️ 注意ポイント</strong>
                        <p>
                            診断から2ヶ月目後半は、コミュニケーションのすれ違いが起きやすい時期。大切な話は、この時期を避けるか、文書で残すようにしましょう。
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- 月詠による仕事運への移行 -->
            <div class="tsukuyomi-section right">
                <div class="tsukuyomi-character">
                    <img src="/images/tsukuyomi/6.png" alt="月詠">
                </div>
                <div class="tsukuyomi-bubble">
                    <div class="tsukuyomi-name">月詠</div>
                    <p>
                        人間関係の次は、お仕事運を見てみましょう。直近3ヶ月のあなたのキャリアはどうなるのか...新月のパワーが、どんな仕事の扉を開いてくれるのでしょうか。
                    </p>
                </div>
            </div>
            
            <!-- 仕事運バナー -->
            <img src="/images/banner/10-shigoto.png" alt="仕事運" style="max-width: 100%; height: auto; margin: 15px 0 5px;">
            
            <!-- 仕事運 -->
            <div class="fortune-section career">
                <div class="section-header">
                    <h2 class="rhythm-heading">新たなキャリアの扉が開く3ヶ月</h2>
                    <p class="fortune-work-text">
                        起業や独立、転職など、新しいスタートを切るのに最適な3ヶ月。あなたのアイデアが形になりやすく、周りからの支援も得られやすい時期。
                    </p>
                </div>
                
                <div class="fortune-content">
                    <div class="sub-banner">直近3ヶ月のキャリア発展ステージ</div>
                    <div class="monthly-sections">
                        <div class="month-box">
                            <span class="month-label">1ヶ月目</span>
                            <h3>準備・種まき期</h3>
                            <p>新しいスキル習得やネットワーク構築に最適。この月に学んだことが、2ヶ月目以降の大きな成果につながります。</p>
                        </div>
                        <div class="month-box">
                            <span class="month-label">2ヶ月目</span>
                            <h3>始動・チャンス期</h3>
                            <p>新プロジェクトの立ち上げや転職面接のチャンス到来。積極的に動くことで、想像以上の結果が得られるでしょう。</p>
                        </div>
                        <div class="month-box">
                            <span class="month-label">3ヶ月目</span>
                            <h3>収穫・評価期</h3>
                            <p>これまでの努力が実を結び、昇進や昇給の可能性も。3ヶ月の総仕上げとして大きな成果を手にします。</p>
                        </div>
                    </div>
                    
                    <div class="highlight-banner">キャリアの転機</div>
                    <p>
                        特に重要な時期は、診断から1ヶ月後の新月と、2ヶ月後の満月。この日に始めた仕事やプロジェクトは、大きな成功につながるでしょう。
                    </p>
                    
                    <div class="point-box">
                        <strong>⚠️ キャリア成功の秘訣</strong>
                        <p>
                            新月の日に新しい仕事を始め、満月の日に大切なプレゼンや交渉を行うと成功確率UP。上弦の月の期間は積極的に動き、下弦の月の期間は振り返りと改善を。
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- 月詠による金運への移行 -->
            <div class="tsukuyomi-section right">
                <div class="tsukuyomi-character">
                    <img src="/images/tsukuyomi/3.png" alt="月詠">
                </div>
                <div class="tsukuyomi-bubble">
                    <div class="tsukuyomi-name">月詠</div>
                    <p>
                        お仕事運も良さそうですね！では、仕事運と密接に関わる金運も見ていきましょう。直近3ヶ月、あなたの財布にはどんな変化が訪れるのでしょうか。
                    </p>
                </div>
            </div>
            
            <!-- 金運バナー -->
            <img src="/images/banner/11-kin.png" alt="金運" style="max-width: 100%; height: auto; margin: 15px 0 5px;">
            
            <!-- 金運・財運 -->
            <div class="fortune-section money">
                <div class="section-header">
                    <p class="fortune-money-text">
                        新月から満月に向かうように、徐々に豊かさが増していく年。前半は投資の時期、後半は収穫の時期となります。
                    </p>
                </div>
                
                <div class="fortune-content">
                    <div class="sub-banner">3ヶ月で実践する金運アップ術</div>
                    <div class="monthly-sections">
                        <div class="month-box">
                            <span class="month-label">1ヶ月目</span>
                            <h3>財運の種まき</h3>
                            <p>新月の日に財布を新調し、投資や学習にお金を使う時期。この月の投資が3ヶ月後には大きなリターンとなって返ってきます。</p>
                        </div>
                        <div class="month-box">
                            <span class="month-label">2ヶ月目</span>
                            <h3>金運急上昇</h3>
                            <p>臨時収入や昇給のチャンス到来。満月の日に感謝の気持ちでお金を使うことで、さらなる豊かさを引き寄せます。</p>
                        </div>
                        <div class="month-box">
                            <span class="month-label">3ヶ月目</span>
                            <h3>財運の収穫期</h3>
                            <p>これまでの努力が金銭的な成果として現れる時期。ボーナスや報奨金など、予想以上の収入が期待できます。</p>
                        </div>
                    </div>
                    
                    <div class="highlight-banner">金運最高潮のタイミング</div>
                    <p>
                        特に診断から1ヶ月後の新月、2ヶ月後の満月、3ヶ月後の新月は金運が最高潮に。この時期に大きな買い物や投資を検討してみてください。
                    </p>
                    
                    <div class="point-box">
                        <strong>⚠️ 金運アップの秘訣</strong>
                        <p>
                            新月の日に財布を新調し、満月の夜に財布を月光浴させると金運UP。月が欠けていく時期は無駄遣いを控え、毎月の新月と満月に財布を整理することが大切。
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- 月詠による最終メッセージへの導入 -->
            <div class="tsukuyomi-section right">
                <div class="tsukuyomi-character">
                    <img src="/images/tsukuyomi/2.png" alt="月詠">
                </div>
                <div class="tsukuyomi-bubble">
                    <div class="tsukuyomi-name">月詠</div>
                    <p>
                        ここまで長い診断でしたね。最後に、直近3ヶ月を幸せに過ごすための特別な鍵をお伝えします。
                    </p>
                </div>
            </div>
            
            <!-- 最終メッセージ -->
            <div class="final-message">
                <img src="/images/banner/12-saigo.png" alt="月が教えてくれる5つの教え" style="max-width: 100%; height: auto; margin-bottom: 5px;">
                <p>
                    新月のあなたは、常に新しいことへチャレンジする勇気を持っています。その勇気は素晴らしいものですが、時には立ち止まることも大切。月のリズムに合わせて、緩急をつけることで、より大きな成果を得られるでしょう。
                </p>
                
                <div style="margin-top: 30px;">
                    <h4 style="font-size: 24px; color: #ffd700; margin-bottom: 20px; text-align: center;">月が教えてくれる最も重要なメッセージ</h4>
                    <div>
                        <p style="margin-bottom: 20px;">
                            月が教えてくれる最も重要なメッセージは、「すべては循環している」ということ。
                        </p>
                        
                        <p style="margin-bottom: 20px;">
                            新月から満月へ、そしてまた新月へ。月が満ち欠けを繰り返すように、あなたの人生にも波があります。その波を受け入れ、流れに身を任せることで、本当の幸せを掴むことができるでしょう。
                        </p>
                        
                        <div style="text-align: left; margin: 30px 0;">
                            <div style="margin-bottom: 20px;">
                                <strong style="color: #ffd700; font-size: 18px;">1. 新月の教え：「始める勇気を持ちなさい」</strong>
                                失敗を恐れず、新しいことに挑戦する勇気。それがあなたの最大の武器です。
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <strong style="color: #ffd700; font-size: 18px;">2. 上弦の月の教え：「成長を楽しみなさい」</strong>
                                困難も成長の糧。すべての経験があなたを強くします。
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <strong style="color: #ffd700; font-size: 18px;">3. 満月の教え：「感謝を忘れずに」</strong>
                                成功した時こそ、周りへの感謝を。それが次の幸運を呼びます。
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <strong style="color: #ffd700; font-size: 18px;">4. 下弦の月の教え：「手放す勇気を」</strong>
                                不要なものを手放すことで、新しいものが入ってきます。
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <strong style="color: #ffd700; font-size: 18px;">5. 闇月の教え：「休息も大切」</strong>
                                時には立ち止まり、自分を見つめ直す時間も必要です。
                            </div>
                        </div>
                        
                        <p style="margin-top: 30px;">
                            <strong>最後に...</strong>直近3ヶ月、あなたは多くの「始まり」を経験します。その一つ一つが、あなたの人生を豊かにする種となるでしょう。
                        </p>
                        
                        <p>
                            恐れずに一歩を踏み出してください。月はいつもあなたを見守り、導いています。
                        </p>
                        
                        <p style="color: #ffd700; font-size: 18px; margin-top: 30px;">
                            <strong>「新月の光があなたの道を照らしますように」</strong>
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- 月詠の最終メッセージ -->
            <div class="tsukuyomi-section">
                <div class="tsukuyomi-character">
                    <img src="/images/tsukuyomi/9.png" alt="月詠">
                </div>
                <div class="tsukuyomi-bubble">
                    <div class="tsukuyomi-name">月詠</div>
                    <p>
                        長い診断でしたが、最後まで聞いてくださってありがとうございました。ここまで、あなたの月相、裏の顔、3つの月の力、4つの軸から見たあなたの本質、そして直近3ヶ月の運勢を見てきました。月の光は、あなたの内なる光を映し出す鏡。この診断を通して、あなたが本当の自分を見つけ、より輝かしい人生を歩むきっかけになれば幸いです。月のリズムと共に、素晴らしい日々をお過ごしくださいね。
                    </p>
                </div>
            </div>
            
            <!-- CTAセクション -->
            <div class="cta-section">
                <h3 class="cta-title">月詠とLINEで繋がる</h3>
                <p class="cta-description">
                    毎日の月占い、相性診断、恋愛相談など、月詠があなたの恋を導きます。
                    今なら友だち追加で特別な月のメッセージをプレゼント！
                </p>
                <a href="https://lin.ee/egmCXoG" class="cta-button">LINE友だち追加する</a>
            </div>
        </div>
    </div>
    
    <script>
        // 星空アニメーション
        function createStars() {
            const container = document.getElementById('starsContainer');
            const starCount = 100;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 3 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 3 + 's';
                container.appendChild(star);
            }
            
            // 流れ星
            setInterval(() => {
                const shootingStar = document.createElement('div');
                shootingStar.className = 'shooting-star';
                shootingStar.style.left = Math.random() * 100 + '%';
                shootingStar.style.top = Math.random() * 50 + '%';
                container.appendChild(shootingStar);
                
                setTimeout(() => {
                    shootingStar.remove();
                }, 3000);
            }, 5000);
        }
        
        // 生年月日セレクトボックスの初期化
        function initDateSelects() {
            const yearSelect = document.getElementById('year');
            const monthSelect = document.getElementById('month');
            const daySelect = document.getElementById('day');
            
            // 年（1950-2010）
            for (let year = 2010; year >= 1950; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year + '年';
                yearSelect.appendChild(option);
            }
            
            // 月
            for (let month = 1; month <= 12; month++) {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = month + '月';
                monthSelect.appendChild(option);
            }
            
            // 日
            for (let day = 1; day <= 31; day++) {
                const option = document.createElement('option');
                option.value = day;
                option.textContent = day + '日';
                daySelect.appendChild(option);
            }
        }
        
        // URLからユーザーIDを取得
        function getUserIdFromUrl() {
            const params = new URLSearchParams(window.location.search);
            return params.get('userId');
        }
        
        // URLからパターンIDを取得（デバッグ用）
        function getPatternIdFromUrl() {
            const params = new URLSearchParams(window.location.search);
            const patternId = params.get('patternId');
            return patternId ? parseInt(patternId) : null;
        }
        
        // 月相パターンに応じてコンテンツを更新
        function updateMoonPhaseContent(patternId) {
            if (typeof OtsukisamaPatterns === 'undefined' || !OtsukisamaPatterns[patternId]) {
                console.log('Pattern data not found for ID:', patternId);
                return;
            }
            
            const pattern = OtsukisamaPatterns[patternId];
            
            // 表月相の更新
            const moonPhaseCard = document.querySelector('.moon-phase-card.new-moon');
            if (moonPhaseCard) {
                const moonPhaseImg = moonPhaseCard.querySelector('.moon-phase-visual');
                const moonPhaseTitle = moonPhaseCard.querySelector('.moon-phase-info h2');
                const moonPhaseSubtitle = moonPhaseCard.querySelector('.moon-phase-subtitle');
                const moonPhaseDesc = moonPhaseCard.querySelector('.moon-phase-description');
                
                // 月相に応じた画像を設定
                const phaseImages = {
                    '新月': '/images/moon/omote-0.png',
                    '三日月': '/images/moon/omote-1.png',
                    '上弦': '/images/moon/omote-2.png',
                    '十三夜': '/images/moon/omote-3.png',
                    '満月': '/images/moon/omote-4.png',
                    '十六夜': '/images/moon/omote-5.png',
                    '下弦': '/images/moon/omote-6.png',
                    '暁': '/images/moon/omote-7.png'
                };
                
                if (moonPhaseImg && phaseImages[pattern.moonPhase]) {
                    moonPhaseImg.src = phaseImages[pattern.moonPhase];
                    moonPhaseImg.alt = pattern.moonPhase;
                }
                
                if (moonPhaseTitle) {
                    moonPhaseTitle.textContent = pattern.moonPhase;
                }
                
                // 月相ごとのサブタイトルを設定（仕様書から）
                const phaseSubtitles = {
                    '新月': '新しい始まりの力。無限の可能性を秘めた開拓者',
                    '三日月': '成長のエネルギー。小さな芽を大きく育てる育成者',
                    '上弦': '挑戦のエネルギー。困難を乗り越える戦士',
                    '十三夜': '美と調和の力。バランスを保つ調整者',
                    '満月': '完成のエネルギー。すべてを照らす完全体',
                    '十六夜': '内省のエネルギー。真実を見つめる賢者',
                    '下弦': '手放しの力。不要なものを削ぎ落とす浄化者',
                    '暁': '準備のエネルギー。次なる始まりへの準備者'
                };
                
                if (moonPhaseSubtitle && phaseSubtitles[pattern.moonPhase]) {
                    moonPhaseSubtitle.textContent = phaseSubtitles[pattern.moonPhase];
                }
            }
            
            // 裏月相の更新
            const hiddenPhaseCard = document.querySelector('.moon-phase-card.crescent');
            if (hiddenPhaseCard) {
                const hiddenPhaseImg = hiddenPhaseCard.querySelector('.moon-phase-visual');
                const hiddenPhaseTitle = hiddenPhaseCard.querySelector('.moon-phase-info h2');
                const hiddenPhaseSubtitle = hiddenPhaseCard.querySelector('.moon-phase-subtitle');
                const hiddenPhaseDesc = hiddenPhaseCard.querySelector('.moon-phase-description');
                
                // 裏月相に応じた画像を設定
                const hiddenPhaseImages = {
                    '新月': '/images/moon/ura-0.png',
                    '三日月': '/images/moon/ura-1.png',
                    '上弦': '/images/moon/ura-2.png',
                    '十三夜': '/images/moon/ura-3.png',
                    '満月': '/images/moon/ura-4.png',
                    '十六夜': '/images/moon/ura-5.png',
                    '下弦': '/images/moon/ura-6.png',
                    '暁': '/images/moon/ura-7.png'
                };
                
                if (hiddenPhaseImg && hiddenPhaseImages[pattern.hiddenPhase]) {
                    hiddenPhaseImg.src = hiddenPhaseImages[pattern.hiddenPhase];
                    hiddenPhaseImg.alt = pattern.hiddenPhase;
                }
                
                if (hiddenPhaseTitle) {
                    hiddenPhaseTitle.textContent = pattern.hiddenPhase + '（裏の顔）';
                }
                
                // 裏月相のサブタイトル
                const hiddenPhaseSubtitles = {
                    '新月': '内なる静寂と無限の可能性',
                    '三日月': '内なる繊細さと慎重さを秘めた策士',
                    '上弦': '内なる勇気と決断力',
                    '十三夜': '内なる美意識と芸術性',
                    '満月': '内なる感情の豊かさ',
                    '十六夜': '内なる知恵と洞察力',
                    '下弦': '内なる浄化と解放の力',
                    '暁': '内なる静寂と準備の時'
                };
                
                if (hiddenPhaseSubtitle && hiddenPhaseSubtitles[pattern.hiddenPhase]) {
                    hiddenPhaseSubtitle.textContent = hiddenPhaseSubtitles[pattern.hiddenPhase];
                }
            }
            
            // 3つの月の力を更新
            if (pattern.threePowers && pattern.threePowers.length === 3) {
                const powerItems = document.querySelectorAll('.three-powers .energy-item');
                powerItems.forEach((item, index) => {
                    if (pattern.threePowers[index]) {
                        const titleEl = item.querySelector('.energy-title');
                        const descEl = item.querySelector('.energy-description');
                        if (titleEl) titleEl.textContent = pattern.threePowers[index].title;
                        if (descEl) descEl.textContent = pattern.threePowers[index].desc;
                    }
                });
            }
            
            // 運勢テキストの更新
            if (pattern.fortune) {
                // 全体運
                const overallSection = document.querySelector('.fortune-content');
                if (overallSection && pattern.fortune.overall) {
                    const overallText = overallSection.querySelector('p');
                    if (overallText) {
                        overallText.textContent = pattern.fortune.overall;
                    }
                }
                
                // 恋愛運、仕事運、人間関係運、金運の更新も同様に実装可能
            }
            
            console.log('Moon phase content updated for pattern:', patternId);
        }
        
        // ユーザーのプロフィールを取得して表示
        async function loadUserProfile() {
            // デバッグ用: URLからパターンIDを取得
            const patternId = getPatternIdFromUrl();
            if (patternId !== null) {
                console.log('Using pattern ID from URL:', patternId);
                updateMoonPhaseContent(patternId);
                // グラフデータも更新（もし実装されていれば）
                if (typeof updateFortuneGraph === 'function') {
                    updateFortuneGraph(patternId);
                }
            } else {
                // 通常はユーザーの生年月日から計算
                // ここではデモとしてランダムなパターンを設定
                const randomPatternId = Math.floor(Math.random() * 64);
                console.log('Using random pattern ID:', randomPatternId);
                updateMoonPhaseContent(randomPatternId);
            }
            
            const userId = getUserIdFromUrl();
            if (!userId) {
                console.log('No userId in URL, checking alternatives');
                // localStorageから取得を試みる
                const savedData = localStorage.getItem('userPersonalityData');
                if (savedData) {
                    const profile = JSON.parse(savedData);
                    updatePersonalityDisplay(profile);
                    displayCombinedPersonality(profile);
                } else {
                    // デフォルトメッセージを表示
                    displayNoProfileMessage();
                }
                return;
            }
            
            try {
                const response = await fetch(`/api/get-love-profile?userId=${userId}`);
                const data = await response.json();
                
                if (data.success && data.profile) {
                    // localStorageに保存（次回アクセス時用）
                    localStorage.setItem('userPersonalityData', JSON.stringify(data.profile));
                    
                    // 4つの軸の結果を更新
                    updatePersonalityDisplay(data.profile);
                    
                    // 組み合わせ診断文を生成して表示
                    displayCombinedPersonality(data.profile);
                    
                    console.log('User profile loaded:', data.profile);
                }
            } catch (error) {
                console.error('Failed to load user profile:', error);
            }
        }
        
        // 恋愛タイプの表示を更新
        function updatePersonalityDisplay(profile) {
            if (profile.emotionalExpression) {
                document.getElementById('emotionalExpressionType').textContent = profile.emotionalExpression;
                updateEmotionalExpressionContent(profile.emotionalExpression);
            }
            if (profile.distanceStyle) {
                document.getElementById('distanceStyleType').textContent = profile.distanceStyle;
                updateDistanceStyleContent(profile.distanceStyle);
            }
            if (profile.loveValues) {
                document.getElementById('loveValuesType').textContent = profile.loveValues;
                updateLoveValuesContent(profile.loveValues);
            }
            if (profile.loveEnergy) {
                document.getElementById('loveEnergyType').textContent = profile.loveEnergy;
                updateLoveEnergyContent(profile.loveEnergy);
            }
        }
        
        // プロフィールがない場合のメッセージを表示
        function displayNoProfileMessage() {
            // 4軸セクションに案内メッセージを表示
            const loveTypeCards = document.querySelectorAll('.love-type-card');
            if (loveTypeCards.length > 0) {
                // 最初のカードに案内メッセージを挿入
                const messageCard = document.createElement('div');
                messageCard.className = 'no-profile-message';
                messageCard.innerHTML = `
                    <div style="background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,100,100,0.1)); 
                                border: 2px dashed #ffd700; 
                                border-radius: 15px; 
                                padding: 30px; 
                                margin-bottom: 30px;
                                text-align: center;">
                        <h3 style="color: #ffd700; margin-bottom: 15px;">
                            💫 4つの恋愛タイプ診断を表示するには
                        </h3>
                        <p style="color: #fff; line-height: 1.8; margin-bottom: 20px;">
                            この部分は、LINEで事前に恋愛タイプ診断を受けていただいた方に<br>
                            パーソナライズされた結果を表示しています。
                        </p>
                        <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px; margin: 20px 0;">
                            <p style="color: #87ceeb; font-size: 14px; margin-bottom: 10px;">
                                📱 LINEで診断を受けるには：
                            </p>
                            <ol style="text-align: left; color: #ccc; line-height: 1.8; margin: 0 auto; max-width: 400px;">
                                <li>LINE公式アカウントを友だち追加</li>
                                <li>「恋愛タイプ診断」メニューを選択</li>
                                <li>4つの質問に回答</li>
                                <li>診断完了後、個人用URLが発行されます</li>
                            </ol>
                        </div>
                        <p style="color: #ffd700; font-size: 12px;">
                            ※ 現在は月相診断のみお楽しみいただけます
                        </p>
                    </div>
                `;
                
                // love-type-gridの前に挿入
                const loveTypeGrid = document.querySelector('.love-type-grid');
                if (loveTypeGrid && loveTypeGrid.parentNode) {
                    loveTypeGrid.parentNode.insertBefore(messageCard, loveTypeGrid);
                }
            }
            
            // 総合診断セクションにもメッセージを表示
            const combinedSection = document.getElementById('combinedPersonality');
            if (combinedSection) {
                combinedSection.innerHTML = `
                    <div class="combined-personality-card" style="background: rgba(100,100,100,0.2); border-style: dashed;">
                        <h3 class="combined-title">🔒 総合恋愛タイプ診断</h3>
                        <p style="text-align: center; color: #ccc;">
                            LINEで4つの質問に回答すると、<br>
                            あなただけの256通りの組み合わせから<br>
                            総合恋愛タイプが判定されます
                        </p>
                    </div>
                `;
            }
        }
        
        // 組み合わせ診断文を表示
        function displayCombinedPersonality(profile) {
            if (!window.PersonalityCombinations) {
                console.error('PersonalityCombinations not loaded');
                return;
            }
            
            // 組み合わせ診断文を生成
            const combined = PersonalityCombinations.generateCombinedText(
                profile.emotionalExpression,
                profile.distanceStyle,
                profile.loveValues,
                profile.loveEnergy
            );
            
            // 組み合わせ診断セクションを追加または更新
            const combinedSection = document.getElementById('combinedPersonality');
            if (combinedSection) {
                combinedSection.innerHTML = `
                    <div class="combined-personality-card">
                        <h3 class="combined-title">🌟 あなたの総合恋愛タイプ: ${combined.title}</h3>
                        <p class="combined-description">${combined.description}</p>
                        <div class="combined-advice">
                            <h4>💝 アドバイス</h4>
                            <p>${combined.advice}</p>
                        </div>
                    </div>
                `;
            }
            
            // 相性の良いタイプも表示
            const compatibleTypes = PersonalityCombinations.getCompatibleTypes(
                profile.emotionalExpression,
                profile.distanceStyle,
                profile.loveValues,
                profile.loveEnergy
            );
            
            if (compatibleTypes.length > 0) {
                const compatibleSection = document.getElementById('compatibleTypes');
                if (compatibleSection) {
                    compatibleSection.innerHTML = `
                        <div class="compatible-types-card">
                            <h4>相性の良いタイプ</h4>
                            <ul>
                                ${compatibleTypes.map(type => `<li>${type}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
            }
        }
        
        // 各タイプの説明を更新する関数
        function updateEmotionalExpressionContent(type) {
            const contents = {
                'ストレート告白型': '好きな人には素直に気持ちを伝えるタイプ。駆け引きは苦手で、思ったことがすぐ顔に出てしまいます。その純粋さが、相手の心を動かす最大の魅力。',
                'スキンシップ型': '言葉よりも行動で愛を表現するタイプ。手をつなぐ、ハグする、そばにいることで愛情を伝えます。触れ合いを通じて深い絆を築いていきます。',
                'さりげない気遣い型': '大げさな言葉よりも、日常の小さな優しさで愛を示すタイプ。相手の好みを覚えて、さりげなくプレゼントしたり、疲れた時にそっと寄り添います。',
                '奥手シャイ型': '心の中では大きな愛を抱えているけれど、なかなか表現できないタイプ。でも、その控えめな愛情表現が、かえって相手の心を掴むことも。'
            };
            const content = contents[type];
            if (content) {
                document.getElementById('emotionalExpressionContent').textContent = content;
            }
        }
        
        function updateDistanceStyleContent(type) {
            const contents = {
                'ベッタリ依存型': '恋人とは常に繋がっていたいタイプ。毎日会いたいし、連絡も頻繁。二人の世界に浸ることで、最高の幸せを感じます。',
                '安心セーフ型': '適度な連絡と会う頻度で安心感を得るタイプ。毎日一回は連絡を取り合い、週末はデート。バランスの取れた関係を築きます。',
                '自由マイペース型': '束縛されることを嫌い、自分のペースを大切にします。相手にも自由を与え、お互いに成長できる関係を理想とします。',
                '壁あり慎重型': 'すぐには心を開かず、じっくりと距離を縮めていくタイプ。時間をかけて築いた信頼関係は、誰よりも深く強固なものになります。'
            };
            const content = contents[type];
            if (content) {
                document.getElementById('distanceStyleContent').textContent = content;
            }
        }
        
        function updateLoveValuesContent(type) {
            // LP_love-type-descriptions.mdから取得した詳細な説明を使用
            const element = document.getElementById('loveValuesContent');
            if (!element) return;
            
            // 既存の長い説明をそのまま使用（タイプによって切り替え）
            // ここでは簡略版を表示（詳細版は別途実装可能）
            if (type !== 'ロマンチスト型') {
                element.innerHTML = getLoveValuesDetailedContent(type);
            }
        }
        
        function updateLoveEnergyContent(type) {
            const element = document.getElementById('loveEnergyContent');
            if (!element) return;
            
            if (type !== '燃え上がり型') {
                element.innerHTML = getLoveEnergyDetailedContent(type);
            }
        }
        
        function getLoveValuesDetailedContent(type) {
            // 詳細な説明を返す（LP_love-type-descriptions.mdの内容を参照）
            const contents = {
                'リアリスト型': '現実的で堅実な恋愛観を持つあなた。愛は日常の積み重ねだと考え、派手な演出よりも確実な幸せを求めます。',
                '刺激ハンター型': '新しい体験やドキドキを求めるあなた。マンネリは大敵で、常に新鮮な刺激を恋愛に求めます。',
                '成長パートナー型': '恋愛を通じて共に成長することを重視するあなた。相手と切磋琢磨し、より良い自分になることを目指します。'
            };
            return contents[type] || '';
        }
        
        function getLoveEnergyDetailedContent(type) {
            const contents = {
                '持続型': '安定した愛情を長く注ぎ続けるタイプ。激しい恋ではないけれど、確実に深まっていく愛を育みます。',
                '波あり型': '感情の浮き沈みがあるタイプ。時に情熱的、時にクール。その変化が恋愛にスパイスを与えます。',
                'クール型': '恋愛に全てを捧げず、冷静さを保つタイプ。バランスの取れた大人の恋愛を楽しみます。'
            };
            return contents[type] || '';
        }
        
        // フォームの送信処理
        document.getElementById('moonForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('name').value;
            const year = parseInt(document.getElementById('year').value);
            const month = parseInt(document.getElementById('month').value);
            const day = parseInt(document.getElementById('day').value);
            
            if (!name || !year || !month || !day) {
                alert('すべての項目を入力してください');
                return;
            }
            
            // 月相と裏月相を計算
            const moonPhase = calculateMoonPhaseType(year, month, day);
            const hiddenMoonPhase = getHiddenMoonPhaseName(year, month, day);
            const patternId = generatePatternId(year, month, day);
            
            // ユーザーデータを保存
            const userData = {
                name: name,
                birthdate: { year, month, day },
                moonPhase: moonPhase,
                hiddenMoonPhase: hiddenMoonPhase,
                patternId: patternId
            };
            
            // ローカルストレージに保存
            localStorage.setItem('otsukisama_user_data', JSON.stringify(userData));
            
            // 動的にコンテンツを更新
            updateDynamicContent(userData);
            
            // 結果セクションに名前を表示
            document.getElementById('resultName').textContent = name;
            
            // フォームを非表示にして結果を表示
            document.getElementById('formSection').style.display = 'none';
            document.getElementById('resultSection').style.display = 'block';
            
            // ユーザープロフィールを読み込む
            loadUserProfile();
            
            // スムーズにスクロール
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
        
        // スクロール進捗バーの更新
        function updateScrollProgress() {
            const scrollProgress = document.getElementById('scrollProgress');
            if (scrollProgress) {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                const scrollPercent = (scrollTop / scrollHeight) * 100;
                scrollProgress.style.width = scrollPercent + '%';
            }
        }
        
        window.addEventListener('scroll', updateScrollProgress);
        window.addEventListener('resize', updateScrollProgress);
        
        // 初期化
        createStars();
        initDateSelects();
        updateScrollProgress();
    </script>
    
    <!-- Chart.jsライブラリの読み込み -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/js/otsukisama-patterns.js"></script>
    <script src="/js/personality-combinations.js"></script>
    
    <!-- グラフ描画スクリプト -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // サンプルデータ
        const fortuneData = [5,4,2,5,3,5,1,5,4,5,2,3];
        const weekLabels = ['1週', '2週', '3週', '4週', '5週', '6週', '7週', '8週', '9週', '10週', '11週', '12週'];
        const fortuneLevels = ['準備期', '蓄積期', '安定期', '上昇期', '最高潮'];
        
        // 軸を入れ替えたデータを作成
        const chartData = fortuneData.map((value, index) => ({
            x: fortuneLevels[value - 1],  // X軸: 運勢レベルのラベル
            y: weekLabels[index]   // Y軸: 週ラベル
        }));
        
        // グラフ描画
        const ctx = document.getElementById('fortuneChart');
        if (ctx) {
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weekLabels,
                    datasets: [{
                        label: '総合運',
                        data: fortuneData,
                        borderColor: '#ffd700',
                        backgroundColor: 'rgba(255, 215, 0, 0.1)',
                        borderWidth: 3,
                        tension: 0.3,
                        fill: false,
                        pointRadius: 7,
                        pointBackgroundColor: function(context) {
                            const value = context.parsed.y;
                            if (value === 5) return '#ff6b6b';
                            if (value === 4) return '#ffd700';
                            if (value === 3) return '#32ffb4';
                            if (value === 2) return '#64c8ff';
                            return '#9999ff';
                        },
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointHoverRadius: 9
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(0, 0, 0, 0.9)',
                            titleColor: '#ffd700',
                            bodyColor: '#ffffff',
                            borderColor: '#ffd700',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                title: function(context) {
                                    const weekIndex = context[0].dataIndex;
                                    return `第${weekIndex + 1}週の運勢`;
                                },
                                label: function(context) {
                                    const value = context.parsed.x;
                                    const weekIndex = context.dataIndex;
                                    const levelText = ['準備期', '蓄積期', '安定期', '上昇期', '最高潮'][value - 1];
                                    const stars = '⭐'.repeat(value);
                                    
                                    // 週別コメントを生成
                                    const weeklyComments = {
                                        5: [
                                            "最高のスタート！今週の決断は大成功につながります",
                                            "エネルギー全開！新しいことを始める絶好のタイミング", 
                                            "運命の扉が開く週。チャンスを逃さないで",
                                            "勢いが止まらない！この調子で突き進んで",
                                            "周囲からの評価も最高潮。自信を持って行動を",
                                            "願いが叶いやすい時期。大きな目標にチャレンジ",
                                            "運気のピーク！重要な決断をするなら今",
                                            "すべてがうまく回る黄金期。積極的に動いて",
                                            "奇跡的な出会いや展開が期待できる週",
                                            "有終の美を飾る絶好調期。成果を確実に",
                                            "これまでの努力が大きく実る収穫の時",
                                            "次のステージへの扉が開く重要な週"
                                        ],
                                        4: [
                                            "順調な展開が続きます。着実に前進を",
                                            "良い流れに乗っています。このペースを維持",
                                            "チャンスが巡ってくる週。準備を怠らずに"
                                        ],
                                        3: [
                                            "安定した運気。基礎を固める良い時期",
                                            "大きな変化はないが、着実な進歩が可能",
                                            "平穏な週。エネルギーを蓄える時期として活用を"
                                        ],
                                        2: [
                                            "慎重な行動が吉。無理は禁物の時期",
                                            "一時的な停滞期。焦らず待つことも大切",
                                            "内省と準備の週。次の上昇に備えて"
                                        ],
                                        1: [
                                            "エネルギーを蓄える準備期間。次の飛躍への大切な時期",
                                            "困難な時期ですが、学びのチャンス",
                                            "嵐は必ず過ぎます。今は耐える時"
                                        ]
                                    };
                                    
                                    const comments = weeklyComments[value] || weeklyComments[3];
                                    let comment;
                                    if (value === 5) {
                                        // 絶好調の場合は週に応じて異なるコメント
                                        comment = weekIndex < comments.length ? comments[weekIndex] : comments[comments.length - 1];
                                    } else {
                                        // その他のレベルはランダムに選択
                                        comment = comments[weekIndex % comments.length];
                                    }
                                    
                                    return [
                                        `${levelText} ${stars}`,
                                        '',
                                        comment
                                    ];
                                },
                                footer: function() {
                                    return '💡 クリックして詳細を見る';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#ffffff',
                                font: {
                                    size: 11
                                }
                            },
                            grid: {
                                display: true,
                                color: 'rgba(255, 255, 255, 0.05)'
                            }
                        },
                        y: {
                            min: 0,
                            max: 6,
                            title: {
                                display: true,
                                text: '運勢レベル',
                                color: '#ffd700',
                                font: {
                                    size: 14
                                }
                            },
                            ticks: {
                                stepSize: 1,
                                callback: function(value) {
                                    const labels = ['', '準備期', '蓄積期', '安定期', '上昇期', '最高潮'];
                                    return labels[value] || '';
                                },
                                color: '#ffffff',
                                font: {
                                    size: 11
                                }
                            },
                            grid: {
                                display: true,
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }
    });
    </script>
    
    <!-- 月齢カレンダー動的生成 -->
    <script>
    // 月齢カレンダー64パターンデータ
    const moonCalendarPatterns = {
        '新月×新月': {
            lucky_days: [1, 2, 30, 31],
            power_days: [7, 8, 15],
            caution_days: [22, 23, 24],
            special_marks: {
                1: { mark: '🌟', message: '最強の始まりの日' },
                15: { mark: '💫', message: '願いが叶う満月' },
                30: { mark: '🌟', message: '新たなサイクル開始' }
            },
            monthly_message: '新月の力が2倍！始まりと創造の月',
            love_advice: '1日と30日の新月に告白すると成功率UP'
        },
        '新月×三日月': {
            lucky_days: [1, 3, 4, 5, 30],
            power_days: [8, 15, 16],
            caution_days: [19, 20, 25, 26],
            special_marks: {
                1: { mark: '✨', message: '新しい始まり' },
                3: { mark: '🌙', message: '成長開始の合図' },
                15: { mark: '💝', message: '愛が満ちる日' }
            },
            monthly_message: '始まりと成長が調和する穏やかな月',
            love_advice: '3-5日の三日月期間に距離を縮めて'
        }
        // 他のパターンも同様に定義（全64パターン）
    };
    
    // 基本月齢サイクル
    const baseMoonCycle = {
        1: { phase: '新月', emoji: '🌑' },
        2: { phase: '新月', emoji: '🌑' },
        3: { phase: '三日月', emoji: '🌒' },
        4: { phase: '三日月', emoji: '🌒' },
        5: { phase: '三日月', emoji: '🌒' },
        6: { phase: '三日月', emoji: '🌒' },
        7: { phase: '上弦', emoji: '🌓' },
        8: { phase: '上弦', emoji: '🌓' },
        9: { phase: '上弦', emoji: '🌓' },
        10: { phase: '十三夜', emoji: '🌔' },
        11: { phase: '十三夜', emoji: '🌔' },
        12: { phase: '十三夜', emoji: '🌔' },
        13: { phase: '十三夜', emoji: '🌔' },
        14: { phase: '満月前', emoji: '🌔' },
        15: { phase: '満月', emoji: '🌕' },
        16: { phase: '満月', emoji: '🌕' },
        17: { phase: '十六夜', emoji: '🌖' },
        18: { phase: '十六夜', emoji: '🌖' },
        19: { phase: '十六夜', emoji: '🌖' },
        20: { phase: '十六夜', emoji: '🌖' },
        21: { phase: '下弦前', emoji: '🌖' },
        22: { phase: '下弦', emoji: '🌗' },
        23: { phase: '下弦', emoji: '🌗' },
        24: { phase: '下弦', emoji: '🌗' },
        25: { phase: '暁', emoji: '🌘' },
        26: { phase: '暁', emoji: '🌘' },
        27: { phase: '暁', emoji: '🌘' },
        28: { phase: '暁', emoji: '🌘' },
        29: { phase: '新月前', emoji: '🌘' },
        30: { phase: '新月', emoji: '🌑' },
        31: { phase: '新月', emoji: '🌑' }
    };
    
    // LINE互換の月齢計算
    function calculateMoonAge(date) {
        // 基準日（新月）: 2000年1月6日 18:14:00
        const referenceDate = new Date('2000-01-06T18:14:00');
        const lunarCycle = 29.53059; // 朔望月（日）
        
        // 経過日数を計算
        const daysDiff = (date - referenceDate) / (1000 * 60 * 60 * 24);
        
        // 月齢を計算（0-29.53日）
        let moonAge = daysDiff % lunarCycle;
        if (moonAge < 0) moonAge += lunarCycle;
        
        return Math.round(moonAge * 10) / 10;
    }
    
    // 月齢から月相を判定
    function getMoonPhaseFromAge(moonAge) {
        if (moonAge < 3.7) return 0;  // 新月
        if (moonAge < 7.4) return 1;  // 三日月
        if (moonAge < 11.1) return 2; // 上弦
        if (moonAge < 14.8) return 3; // 十三夜
        if (moonAge < 18.5) return 4; // 満月
        if (moonAge < 22.1) return 5; // 十六夜
        if (moonAge < 25.8) return 6; // 下弦
        return 7; // 暁
    }
    
    // 月相名を取得
    function getMoonPhaseName(phase) {
        const names = ['新月', '三日月', '上弦', '十三夜', '満月', '十六夜', '下弦', '暁'];
        return names[phase];
    }
    
    // 生年月日から月相を計算
    function calculateMoonPhaseType(year, month, day) {
        const birthDate = new Date(year, month - 1, day);
        const moonAge = calculateMoonAge(birthDate);
        const moonPhase = getMoonPhaseFromAge(moonAge);
        return getMoonPhaseName(moonPhase);
    }
    
    // 月相インデックスを取得
    function getMoonPhaseIndex(year, month, day) {
        const birthDate = new Date(year, month - 1, day);
        const moonAge = calculateMoonAge(birthDate);
        return getMoonPhaseFromAge(moonAge);
    }
    
    // 裏月相計算（仕様書通り）
    function calculateHiddenMoonIndex(moonPhaseIndex, birthMonth, birthDay) {
        // 生日の数字根を計算
        let dayRoot = birthDay;
        while (dayRoot > 9) {
            dayRoot = Math.floor(dayRoot / 10) + (dayRoot % 10);
        }
        // 仕様書の計算式: (moonPhase + birthMonth + digitRoot(birthDay)) % 8
        return (moonPhaseIndex + birthMonth + dayRoot) % 8;
    }
    
    // 裏月相名を取得
    function getHiddenMoonPhaseName(year, month, day) {
        const moonPhaseIndex = getMoonPhaseIndex(year, month, day);
        const hiddenIndex = calculateHiddenMoonIndex(moonPhaseIndex, month, day);
        return getMoonPhaseName(hiddenIndex);
    }
    
    // パターンIDを生成（0-63の数値）
    function generatePatternId(year, month, day) {
        const moonPhaseIndex = getMoonPhaseIndex(year, month, day);
        const hiddenIndex = calculateHiddenMoonIndex(moonPhaseIndex, month, day);
        return moonPhaseIndex * 8 + hiddenIndex;
    }
    
    // カレンダー生成関数
    function generatePersonalizedCalendar() {
        const container = document.getElementById('personalizedCalendar');
        const messageElement = document.getElementById('calendarMessage');
        const monthYearElement = document.getElementById('calendarMonthYear');
        
        if (!container) return;
        
        // フォームから生年月日を取得（デモ用にデフォルト値を設定）
        const birthYear = parseInt(document.getElementById('year')?.value) || 1990;
        const birthMonth = parseInt(document.getElementById('month')?.value) || 7;
        const birthDay = parseInt(document.getElementById('day')?.value) || 15;
        
        // 月相タイプを計算
        const userMoonPhase = calculateMoonPhaseType(birthYear, birthMonth, birthDay);
        const hiddenMoonPhase = getHiddenMoonPhaseName(birthYear, birthMonth, birthDay);
        const patternId = `${userMoonPhase}×${hiddenMoonPhase}`;
        const numericPatternId = generatePatternId(birthYear, birthMonth, birthDay);
        
        // パターンデータを取得（デモ用にデフォルトパターンを使用）
        const patternData = moonCalendarPatterns[patternId] || moonCalendarPatterns['新月×新月'];
        
        // 現在の月の情報を取得
        const currentDate = new Date();
        const currentYear = currentDate.getFullYear();
        const currentMonth = currentDate.getMonth();
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        const firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay(); // 1日の曜日（0=日曜）
        
        // 月年を表示
        const monthNames = ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'];
        if (monthYearElement) {
            monthYearElement.textContent = `${currentYear}年${monthNames[currentMonth]}`;
        }
        
        // カレンダーをクリア
        container.innerHTML = '';
        
        // 月初めの空白セルを追加
        for (let i = 0; i < firstDayOfMonth; i++) {
            const emptyDiv = document.createElement('div');
            emptyDiv.className = 'calendar-day empty';
            container.appendChild(emptyDiv);
        }
        
        // 各日のカレンダーを生成
        for (let day = 1; day <= daysInMonth; day++) {
            const dayDiv = document.createElement('div');
            dayDiv.className = 'calendar-day';
            
            // 曜日を計算（0=日曜, 6=土曜）
            const dayOfWeek = (firstDayOfMonth + day - 1) % 7;
            if (dayOfWeek === 0) {
                dayDiv.classList.add('sunday');
            } else if (dayOfWeek === 6) {
                dayDiv.classList.add('saturday');
            }
            
            // クラスを追加
            if (patternData.lucky_days.includes(day)) {
                dayDiv.classList.add('lucky-day');
            }
            if (patternData.power_days.includes(day)) {
                dayDiv.classList.add('power-day');
            }
            if (patternData.caution_days.includes(day)) {
                dayDiv.classList.add('caution-day');
            }
            
            // 月相データを取得
            const moonData = baseMoonCycle[day] || baseMoonCycle[day % 30];
            
            // 日付を追加
            const dayNumber = document.createElement('span');
            dayNumber.className = 'day-number';
            dayNumber.textContent = day;
            dayDiv.appendChild(dayNumber);
            
            // 月の絵文字を追加
            const moonEmoji = document.createElement('span');
            moonEmoji.className = 'moon-emoji';
            moonEmoji.textContent = moonData.emoji;
            dayDiv.appendChild(moonEmoji);
            
            // 特別マークがある場合は追加
            if (patternData.special_marks[day]) {
                const specialMark = document.createElement('span');
                specialMark.className = 'special-mark';
                specialMark.textContent = patternData.special_marks[day].mark;
                specialMark.title = patternData.special_marks[day].message;
                dayDiv.appendChild(specialMark);
            }
            
            // ツールチップ設定
            let tooltip = `${day}日 - ${moonData.phase}`;
            if (patternData.special_marks[day]) {
                tooltip += `\n${patternData.special_marks[day].message}`;
            }
            dayDiv.title = tooltip;
            
            container.appendChild(dayDiv);
        }
        
        // 月末の空白セルを追加（必要に応じて）
        const totalCells = firstDayOfMonth + daysInMonth;
        const remainingCells = totalCells % 7;
        if (remainingCells !== 0) {
            for (let i = remainingCells; i < 7; i++) {
                const emptyDiv = document.createElement('div');
                emptyDiv.className = 'calendar-day empty';
                container.appendChild(emptyDiv);
            }
        }
        
        // メッセージを表示
        if (messageElement) {
            messageElement.innerHTML = `
                <strong>${patternData.monthly_message}</strong><br>
                ${patternData.love_advice}
            `;
        }
    }
    
    // 動的コンテンツを更新する関数
    async function updateDynamicContent(userData) {
        const { name, moonPhase, hiddenMoonPhase, patternId } = userData;
        
        // ユーザー名を複数箇所に表示
        const nameElements = ['resultName', 'resultName2', 'resultName3'];
        nameElements.forEach(id => {
            const elem = document.getElementById(id);
            if (elem) elem.textContent = name;
        });
        
        // 月相情報を表示
        const moonDisplay = document.getElementById('userMoonPhase');
        if (moonDisplay) {
            moonDisplay.innerHTML = `
                <div class="moon-phase-display" style="text-align: center; margin: 30px 0;">
                    <div style="display: flex; justify-content: center; gap: 40px; flex-wrap: wrap;">
                        <div class="phase-item">
                            <h3 style="color: #ffd700; margin-bottom: 10px;">あなたの月相</h3>
                            <p style="font-size: 28px; color: #fff; font-weight: bold;">${moonPhase}</p>
                        </div>
                        <div class="phase-item">
                            <h3 style="color: #ffd700; margin-bottom: 10px;">隠れ月相（裏の顔）</h3>
                            <p style="font-size: 28px; color: #fff; font-weight: bold;">${hiddenMoonPhase}</p>
                        </div>
                    </div>
                    <div style="margin-top: 20px; color: #aaa;">
                        <p>パターン ${patternId + 1}/64</p>
                        <p style="color: #ffd700; font-size: 20px; margin-top: 10px;">${moonPhase}×${hiddenMoonPhase}</p>
                    </div>
                </div>
            `;
        }
        
        // 運勢グラフを更新
        await loadFortuneGraph(patternId);
        
        // カレンダーを生成
        generatePersonalizedCalendar();
        
        // パターン固有のコンテンツを更新
        updatePatternContent(patternId, moonPhase, hiddenMoonPhase);
    }
    
    // 運勢グラフを読み込む関数
    async function loadFortuneGraph(patternId) {
        try {
            const response = await fetch('/docs/fortune_graph_all_64_patterns.json');
            const data = await response.json();
            
            // パターンIDに対応するデータを検索
            const patternData = data.patterns.find(p => p.pattern_number === (patternId + 1));
            
            if (patternData) {
                const ctx = document.getElementById('fortuneChart')?.getContext('2d');
                if (ctx && window.Chart) {
                    // 既存のチャートがあれば破棄
                    if (window.fortuneChartInstance) {
                        window.fortuneChartInstance.destroy();
                    }
                    
                    // 新しいチャートを作成
                    window.fortuneChartInstance = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['1週', '2週', '3週', '4週', '5週', '6週', 
                                    '7週', '8週', '9週', '10週', '11週', '12週'],
                            datasets: [{
                                label: '総合運',
                                data: patternData.fortune_data.overall,
                                borderColor: '#ffd700',
                                backgroundColor: 'rgba(255, 215, 0, 0.1)',
                                tension: 0.3,
                                fill: true,
                                pointRadius: 6,
                                pointBackgroundColor: '#ffd700',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2,
                                borderWidth: 3
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'top',
                                    labels: {
                                        color: '#ffd700',
                                        font: { size: 16, weight: 'bold' }
                                    }
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(0, 0, 0, 0.9)',
                                    titleColor: '#ffd700',
                                    bodyColor: '#fff',
                                    borderColor: '#ffd700',
                                    borderWidth: 1,
                                    displayColors: false,
                                    callbacks: {
                                        label: function(context) {
                                            const value = context.parsed.y;
                                            const labels = {
                                                5: '絶好調',
                                                4: '好調',
                                                3: '安定期',
                                                2: '充電期',
                                                1: '準備期'
                                            };
                                            return labels[value] || value;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: false,
                                    min: 1,
                                    max: 5,
                                    ticks: {
                                        stepSize: 1,
                                        color: '#ccc',
                                        font: { size: 12 },
                                        callback: function(value) {
                                            const labels = {
                                                5: '絶好調',
                                                4: '好調',
                                                3: '安定',
                                                2: '充電',
                                                1: '準備'
                                            };
                                            return labels[value] || '';
                                        }
                                    },
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)',
                                        drawBorder: false
                                    }
                                },
                                x: {
                                    ticks: {
                                        color: '#ccc',
                                        font: { size: 12 }
                                    },
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.05)',
                                        drawBorder: false
                                    }
                                }
                            }
                        }
                    });
                }
                
                // グラフの説明を更新
                const graphDesc = document.getElementById('graphDescription');
                if (graphDesc) {
                    graphDesc.innerHTML = `
                        <div style="background: rgba(255, 215, 0, 0.05); padding: 15px; border-radius: 5px; margin-top: 20px;">
                            <h4 style="color: #ffd700; margin-bottom: 10px;">${patternData.characteristics}</h4>
                            <p style="color: #fff;">ピーク週: 第${patternData.peak_weeks.join('・')}週</p>
                            <p style="color: #fff;">注意週: 第${patternData.caution_weeks.join('・')}週</p>
                        </div>
                    `;
                }
            }
        } catch (error) {
            console.error('運勢グラフの読み込みエラー:', error);
        }
    }
    
    // パターン固有のコンテンツを更新
    async function updatePatternContent(patternId, moonPhase, hiddenPhase) {
        // パターンデータを取得
        const patternData = window.getPatternContent ? window.getPatternContent(patternId) : null;
        
        if (!patternData) {
            console.warn(`Pattern ${patternId} data not found, using demo data`);
            // デモデータを使用
            updateDemoContent(patternId);
            return;
        }
        
        // 3つの月の力を更新（パターンベース）
        updateThreeMoonPowers(patternData.threePowers);
        
        // 性格4軸はLINEユーザーデータから取得するため、ここでは更新しない
        // updatePersonalityAxes()はloadUserProfile()から呼ばれる
        
        // 運勢テキストを更新（パターンベース）
        updateFortuneTexts(patternData.fortune);
        
        // 月相に応じた画像を更新
        updateMoonImages(moonPhase, hiddenPhase);
        
        console.log(`Pattern ${patternId} loaded: ${moonPhase}×${hiddenPhase}`);
        console.log('Note: Personality axes will be loaded from LINE user database');
    }
    
    // パターンごとの3つの力を取得
    function getPatternPowers(patternId) {
        // デモ用のデータ（実際にはパターンごとに異なるデータを用意）
        const powerSets = [
            [
                { title: '直感の力', desc: '内なる声に導かれ、正しい選択ができる時期' },
                { title: '創造の力', desc: '新しいアイデアが次々と湧き上がる' },
                { title: '調和の力', desc: '周囲との関係が円滑に進む' }
            ],
            [
                { title: '行動の力', desc: '思い立ったらすぐに動ける勢いがある' },
                { title: '成長の力', desc: '自己成長のチャンスが訪れる' },
                { title: '魅力の力', desc: 'あなたの魅力が最大限に発揮される' }
            ]
        ];
        return powerSets[patternId % 2] || powerSets[0];
    }
    
    // 3つの月の力を表示更新
    function updateThreeMoonPowers(powers) {
        const container = document.querySelector('.three-powers');
        if (container) {
            container.innerHTML = powers.map((power, i) => `
                <div class="power-card" style="background: rgba(255, 215, 0, 0.05); padding: 20px; border-radius: 5px; border-left: 3px solid #ffd700;">
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <div style="width: 30px; height: 30px; background: #ffd700; color: #000; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 10px;">${i + 1}</div>
                        <h4 style="color: #ffd700; margin: 0;">${power.title}</h4>
                    </div>
                    <p style="color: #fff; margin: 0;">${power.desc}</p>
                </div>
            `).join('');
        }
    }
    
    // 運勢テキストを更新
    function updateFortuneTexts(fortuneData) {
        // 全体運を更新
        const overallElem = document.querySelector('.fortune-overall-text');
        if (overallElem) {
            overallElem.textContent = fortuneData.overall;
        }
        
        // 恋愛運を更新
        const loveElem = document.querySelector('.fortune-love-text');
        if (loveElem) {
            loveElem.textContent = fortuneData.love;
        }
        
        // 仕事運を更新
        const workElem = document.querySelector('.fortune-work-text');
        if (workElem) {
            workElem.textContent = fortuneData.work;
        }
        
        // 人間関係運を更新
        const relationshipElem = document.querySelector('.fortune-relationship-text');
        if (relationshipElem) {
            relationshipElem.textContent = fortuneData.relationship;
        }
        
        // 金運を更新
        const moneyElem = document.querySelector('.fortune-money-text');
        if (moneyElem) {
            moneyElem.textContent = fortuneData.money;
        }
    }
    
    // 性格4軸を更新
    function updatePersonalityAxes(personalityData) {
        // 感情表現の軸
        const emotionalType = document.getElementById('emotionalExpressionType');
        const emotionalContent = document.getElementById('emotionalExpressionContent');
        if (emotionalType) emotionalType.textContent = personalityData.emotional;
        if (emotionalContent) emotionalContent.textContent = personalityData.emotionalDesc;
        
        // 距離感の軸
        const distanceType = document.getElementById('distanceStyleType');
        const distanceContent = document.getElementById('distanceStyleContent');
        if (distanceType) distanceType.textContent = personalityData.distance;
        if (distanceContent) distanceContent.textContent = personalityData.distanceDesc;
        
        // 価値観の軸
        const valuesType = document.getElementById('loveValuesType');
        const valuesContent = document.getElementById('loveValuesContent');
        if (valuesType) valuesType.textContent = personalityData.values;
        if (valuesContent) valuesContent.textContent = personalityData.valuesDesc;
        
        // エネルギーの軸
        const energyType = document.getElementById('loveEnergyType');
        const energyContent = document.getElementById('loveEnergyContent');
        if (energyType) energyType.textContent = personalityData.energy;
        if (energyContent) energyContent.textContent = personalityData.energyDesc;
    }
    
    // 月相に応じた画像を更新
    function updateMoonImages(moonPhase, hiddenPhase) {
        // 月相に基づいて月詠の画像を変更
        const tsukuyomiImages = document.querySelectorAll('.tsukuyomi-character img');
        const moonPhaseIndex = ['新月', '三日月', '上弦', '十三夜', '満月', '十六夜', '下弦', '暁'].indexOf(moonPhase);
        
        // 画像番号を決定（1-8の範囲）
        const imageNumber = (moonPhaseIndex % 8) + 1;
        
        tsukuyomiImages.forEach((img, index) => {
            // 各セクションで異なる画像を使用
            const sectionImageNum = ((imageNumber + index) % 8) + 1;
            img.src = `/images/tsukuyomi/${sectionImageNum}.png`;
        });
    }
    
    // デモコンテンツを更新（パターンデータがない場合）
    function updateDemoContent(patternId) {
        // デモ用の3つの力
        const demoPowers = [
            { title: '直感の力', desc: '内なる声に導かれ、正しい選択ができる時期' },
            { title: '創造の力', desc: '新しいアイデアが次々と湧き上がる' },
            { title: '調和の力', desc: '周囲との関係が円滑に進む' }
        ];
        updateThreeMoonPowers(demoPowers);
        
        // デモ用の運勢テキスト
        const demoFortune = {
            overall: '今後3ヶ月は、新しい挑戦と成長の時期です。あなたの持つ潜在能力が開花し、これまでにない成果を上げることができるでしょう。',
            love: '恋愛運は上昇傾向にあり、素敵な出会いが期待できます。既存の関係も深まり、より強い絆で結ばれるでしょう。',
            work: '仕事では創造性が高まり、新しいアイデアが評価されるでしょう。チームワークも良好で、大きなプロジェクトを成功に導けます。',
            relationship: '人間関係は安定し、信頼できる仲間との絆が深まります。新しい出会いもあり、あなたの世界が広がる時期です。',
            money: '金運は波がありますが、計画的な行動で安定します。新しい収入源も見つかり、経済的な余裕が生まれるでしょう。'
        };
        updateFortuneTexts(demoFortune);
    }
    
    // ページ読み込み時にカレンダーを生成
    document.addEventListener('DOMContentLoaded', function() {
        // 結果セクションが表示されたらカレンダーを生成
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.target.id === 'resultSection' && mutation.target.style.display === 'block') {
                    generatePersonalizedCalendar();
                }
            });
        });
        
        const resultSection = document.getElementById('resultSection');
        if (resultSection) {
            observer.observe(resultSection, { attributes: true, attributeFilter: ['style'] });
        }
        
        // デモ用：初期表示でもカレンダーを生成
        if (document.getElementById('personalizedCalendar')) {
            generatePersonalizedCalendar();
        }
    });
    </script>
</body>
</html>