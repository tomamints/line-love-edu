<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãŠã¤ãã•ã¾è¨ºæ–­ - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¥åŠ›</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Hiragino Sans", "Noto Sans CJK JP", sans-serif;
      background: linear-gradient(135deg, #1a0033 0%, #4a0e6b 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      backdrop-filter: blur(10px);
    }
    
    .header h1 {
      font-size: 32px;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .header p {
      font-size: 16px;
      opacity: 0.9;
    }
    
    .form-container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }
    
    form {
      padding: 30px;
    }
    
    .section {
      margin-bottom: 30px;
    }
    
    .section-title {
      font-size: 20px;
      color: #667eea;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-size: 14px;
      font-weight: 500;
    }
    
    input[type="text"],
    input[type="email"],
    input[type="date"],
    select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      transition: border-color 0.3s;
      background: white;
    }
    
    .radio-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .radio-option {
      display: flex;
      align-items: flex-start;
      padding: 15px;
      background: #f8f9fa;
      border: 2px solid transparent;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .radio-option:hover {
      background: #f0f4ff;
      border-color: #d0d9ff;
    }
    
    .radio-option.selected {
      background: #e8eeff;
      border-color: #667eea;
    }
    
    .radio-option input[type="radio"] {
      margin-right: 12px;
      margin-top: 2px;
    }
    
    .radio-label {
      flex: 1;
    }
    
    .radio-title {
      font-weight: 600;
      color: #333;
      margin-bottom: 4px;
      font-size: 15px;
    }
    
    .radio-description {
      color: #666;
      font-size: 13px;
      line-height: 1.4;
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .submit-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }
    
    .submit-btn:active {
      transform: translateY(0);
    }
    
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }
    
    .loading.show {
      display: block;
    }
    
    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .success-message {
      display: none;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 40px 20px;
      border-radius: 20px;
      text-align: center;
      margin: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    .success-message.show {
      display: block;
      animation: fadeIn 0.5s ease-in;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ãŠã¤ãã•ã¾è¨ºæ–­</h1>
      <p>ãŠã¤ãã•ã¾ã«ã‚ãªãŸã¨ãŠç›¸æ‰‹ã®ã“ã¨ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚</p>
    </div>
    
    <div class="form-container">
      <div class="success-message" id="successMessage">
        <div style="font-size: 24px; margin-bottom: 20px;">ğŸŒ™</div>
        <div style="font-size: 20px; margin-bottom: 15px; font-weight: bold;">
          æœˆã¸ã®ç¥ˆã‚ŠãŒå±Šãã¾ã—ãŸ
        </div>
        <div style="line-height: 1.8;">
          ã‚ãªãŸã¨ãŠç›¸æ‰‹ã®æœˆã®å§¿ã‚’<br>
          é™ã‹ã«è¦–ã•ã›ã¦ã„ãŸã ã„ã¦ãŠã‚Šã¾ã™<br><br>
          
          ãµãŸã‚Šã®æœˆãŒç¹”ã‚Šãªã™ç‰©èªã‚’<br>
          ã¾ã‚‚ãªããŠä¼ãˆã„ãŸã—ã¾ã™<br><br>
          
          <span style="font-size: 14px; opacity: 0.9;">
            ã©ã†ãã“ã®ã¾ã¾ãŠå¾…ã¡ãã ã•ã„<br>
            æœˆã®å°ããŒã‚ãªãŸã«å±Šãã¾ã™ã‚ˆã†ã«
          </span>
        </div>
      </div>
      
      <form id="profileForm" action="/api/profile-form" method="POST">
        <input type="hidden" name="userId" id="userId" value="">
        
        <div class="section">
          <h2 class="section-title">ğŸ‘¤ ã‚ãªãŸã®ã“ã¨</h2>
          
          <div class="form-group">
            <label for="userBirthdate"><strong>ç”Ÿå¹´æœˆæ—¥</strong></label>
            <div style="display: flex; gap: 5px;">
              <select id="userYear" style="flex: 1;" required>
                <option value="">å¹´</option>
              </select>
              <select id="userMonth" style="flex: 1;" required>
                <option value="">æœˆ</option>
              </select>
              <select id="userDay" style="flex: 1;" required>
                <option value="">æ—¥</option>
              </select>
            </div>
            <input type="hidden" id="userBirthdate" name="userBirthdate" value="" required>
          </div>
          
          <input type="hidden" id="userAge" name="userAge" value="">
          
          <div class="form-group">
            <label for="userGender"><strong>æ€§åˆ¥</strong></label>
            <select id="userGender" name="userGender" required>
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
              <option value="male">ç”·æ€§</option>
              <option value="female">å¥³æ€§</option>
              <option value="other">ãã®ä»–</option>
            </select>
          </div>
        </div>
        
        <div class="section">
          <h2 class="section-title">ğŸ’– ãŠç›¸æ‰‹ã®ã“ã¨</h2>
          
          <div class="form-group">
            <label for="partnerBirthdate"><strong>ç”Ÿå¹´æœˆæ—¥</strong></label>
            <div style="display: flex; gap: 5px;">
              <select id="partnerYear" style="flex: 1;" required>
                <option value="">å¹´</option>
              </select>
              <select id="partnerMonth" style="flex: 1;" required>
                <option value="">æœˆ</option>
              </select>
              <select id="partnerDay" style="flex: 1;" required>
                <option value="">æ—¥</option>
              </select>
            </div>
            <input type="hidden" id="partnerBirthdate" name="partnerBirthdate" value="" required>
          </div>
          
          <input type="hidden" id="partnerAge" name="partnerAge" value="">
          
          <div class="form-group">
            <label for="partnerGender"><strong>æ€§åˆ¥</strong></label>
            <select id="partnerGender" name="partnerGender" required>
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
              <option value="male">ç”·æ€§</option>
              <option value="female">å¥³æ€§</option>
              <option value="other">ãã®ä»–</option>
            </select>
          </div>
        </div>
        
        <div class="section">
          <h2 class="section-title">ğŸŒ™ æ‹æ„›çŠ¶æ³ã«ã¤ã„ã¦</h2>
          
          <div class="form-group">
            <label><strong>Q1ï¼šã‚ãªãŸã®æ‹ã®çŠ¶æ³ã¯ã€ã©ã‚Œã«è¿‘ã„ã§ã™ã‹ï¼Ÿ</strong></label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="loveSituation" value="beginning" required>
                <div class="radio-label">
                  <div class="radio-title">æ‹ã®å§‹ã¾ã‚Šãƒ»ç›¸æ‰‹ã¨ã®è·é›¢æ„Ÿ</div>
                  <div class="radio-description">ç‰‡æƒ³ã„ã€æ°—ã«ãªã‚‹äººã€æ‹äººæœªæº€ã€ãƒãƒƒãƒãƒ³ã‚°ã‚¢ãƒ—ãƒªã§ã®å‡ºä¼šã„ãªã©</div>
                </div>
              </label>
              <label class="radio-option">
                <input type="radio" name="loveSituation" value="relationship" required>
                <div class="radio-label">
                  <div class="radio-title">äº¤éš›ä¸­ã®ç›¸æ‰‹ã¨ã®ã“ã¨</div>
                  <div class="radio-description">ç¾åœ¨ã®æ‹äººã¨ã®ä»Šå¾Œã€çµå©šã€ãƒãƒ³ãƒãƒªã€ã™ã‚Œé•ã„ãªã©</div>
                </div>
              </label>
              <label class="radio-option">
                <input type="radio" name="loveSituation" value="marriage" required>
                <div class="radio-label">
                  <div class="radio-title">å¤«å©¦é–¢ä¿‚</div>
                  <div class="radio-description">å–§å˜©ã€ã™ã‚Œé•ã„ã€æ„è¦‹ã®ç›¸é•ã€çµå©šå¾Œã®ã‚®ãƒ£ãƒƒãƒ—</div>
                </div>
              </label>
              <label class="radio-option">
                <input type="radio" name="loveSituation" value="complicated" required>
                <div class="radio-label">
                  <div class="radio-title">è¤‡é›‘ãªäº‹æƒ…ã‚’æŠ±ãˆã‚‹æ‹</div>
                  <div class="radio-description">ç¦æ–­ã®æ‹ã€é è·é›¢ã€éšœå®³ã®ã‚ã‚‹æ‹ã€å…¬ã«ã§ããªã„é–¢ä¿‚ãªã©</div>
                </div>
              </label>
              <label class="radio-option">
                <input type="radio" name="loveSituation" value="ending" required>
                <div class="radio-label">
                  <div class="radio-title">å¾©ç¸ãƒ»çµ‚ã‚ã£ãŸæ‹</div>
                  <div class="radio-description">å¾©ç¸ã—ãŸã„ã€åˆ¥ã‚Œã®å±æ©Ÿã€å¤±æ‹ã‚’ä¹—ã‚Šè¶ŠãˆãŸã„ãªã©</div>
                </div>
              </label>
            </div>
          </div>
          
          <div class="form-group">
            <label><strong>Q2ï¼šä»Šã€ç‰¹ã«ä½•ã‚’çŸ¥ã‚ŠãŸã„ã§ã™ã‹ï¼Ÿ</strong></label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="wantToKnow" value="feelings" required>
                <div class="radio-label" style="display: flex; align-items: center; min-height: 40px;">
                  <div class="radio-title">ç›¸æ‰‹ãŒä»Šã€ã©ã‚“ãªæ°—æŒã¡ãªã®ã‹</div>
                </div>
              </label>
              <label class="radio-option">
                <input type="radio" name="wantToKnow" value="action" required>
                <div class="radio-label" style="display: flex; align-items: center; min-height: 40px;">
                  <div class="radio-title">ä»Šã€è‡ªåˆ†ãŒã©ã†ã—ãŸã‚‰ã„ã„ã‹</div>
                </div>
              </label>
              <label class="radio-option">
                <input type="radio" name="wantToKnow" value="past" required>
                <div class="radio-label" style="display: flex; align-items: center; min-height: 40px;">
                  <div class="radio-title">éå»ï¼ˆå‡ºæ¥äº‹ï¼‰ã®æ„å‘³ã‚„ç†ç”±</div>
                </div>
              </label>
              <label class="radio-option">
                <input type="radio" name="wantToKnow" value="future" required>
                <div class="radio-label" style="display: flex; align-items: center; min-height: 40px;">
                  <div class="radio-title">ã“ã‚Œã‹ã‚‰ã©ã†ãªã£ã¦ã„ãã®ã‹</div>
                </div>
              </label>
            </div>
          </div>
          
          <div class="form-group">
            <label><strong>Q3ï¼šæƒ³ã„ã‚’ä¼ãˆã‚‹ã¨ãã®ã‚¹ã‚¿ã‚¤ãƒ«ã¯ï¼Ÿ</strong></label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="emotionalExpression" value="straight" required>
                <div class="radio-label">
                  <div class="radio-title">ã€Œå¥½ãï¼ã€ã¨çœŸã£ç›´ãä¼ãˆã‚‹</div>
                </div>
              </label>
              <label class="radio-option">
                <input type="radio" name="emotionalExpression" value="physical" required>
                <div class="radio-label">
                  <div class="radio-title">æ‰‹ã‚’ã¤ãªã„ã ã‚Šä¼šã„ã«è¡Œã</div>
                </div>
              </label>
              <label class="radio-option">
                <input type="radio" name="emotionalExpression" value="subtle" required>
                <div class="radio-label">
                  <div class="radio-title">ãƒ—ãƒãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã‚„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§åŒ‚ã‚ã›</div>
                </div>
              </label>
              <label class="radio-option">
                <input type="radio" name="emotionalExpression" value="shy" required>
                <div class="radio-label">
                  <div class="radio-title">æ°—æŒã¡ã¯ã‚ã‚‹ã®ã«ãªã‹ãªã‹ä¼ãˆã‚‰ã‚Œãªã„</div>
                </div>
              </label>
            </div>
          </div>
          
          <div class="form-group">
            <label><strong>Q4ï¼šãµãŸã‚Šã«ã¨ã£ã¦å¤§åˆ‡ãªã‚‚ã®ã¯ï¼Ÿ</strong></label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="distanceStyle" value="close" required>
                <div class="radio-label">
                  <div class="radio-title">ã„ã¤ã§ã‚‚ä¸€ç·’ï¼å…±æœ‰ã‚¿ã‚¤ãƒ </div>
                </div>
              </label>
              <label class="radio-option">
                <input type="radio" name="distanceStyle" value="moderate" required>
                <div class="radio-label">
                  <div class="radio-title">é©åº¦ãªè·é›¢æ„Ÿã§ãƒªãƒ©ãƒƒã‚¯ã‚¹</div>
                </div>
              </label>
              <label class="radio-option">
                <input type="radio" name="distanceStyle" value="independent" required>
                <div class="radio-label">
                  <div class="radio-title">ãŠäº’ã„ã®æ™‚é–“ã‚‚å¤§åˆ‡ã«</div>
                </div>
              </label>
              <label class="radio-option">
                <input type="radio" name="distanceStyle" value="cautious" required>
                <div class="radio-label">
                  <div class="radio-title">ã˜ã£ãã‚Šæ™‚é–“ã‚’ã‹ã‘ã¦</div>
                </div>
              </label>
            </div>
          </div>
          
          <div class="form-group">
            <label><strong>Q5ï¼šæ‹æ„›ã«ãŠã„ã¦é‡è¦–ã™ã‚‹ã“ã¨ã¯ï¼Ÿ</strong></label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="loveValues" value="romantic" required>
                <div class="radio-label">
                  <div class="radio-title">ã¨ãã‚ãã¨ãƒ­ãƒãƒ³ã‚¹</div>
                </div>
              </label>
              <label class="radio-option">
                <input type="radio" name="loveValues" value="realistic" required>
                <div class="radio-label">
                  <div class="radio-title">ç¾å®Ÿçš„ãªå®‰å®šæ„Ÿ</div>
                </div>
              </label>
              <label class="radio-option">
                <input type="radio" name="loveValues" value="excitement" required>
                <div class="radio-label">
                  <div class="radio-title">åˆºæ¿€çš„ãªæ—¥ã€…</div>
                </div>
              </label>
              <label class="radio-option">
                <input type="radio" name="loveValues" value="growth" required>
                <div class="radio-label">
                  <div class="radio-title">ãŠäº’ã„ã®æˆé•·</div>
                </div>
              </label>
            </div>
          </div>
          
          <div class="form-group">
            <label><strong>Q6ï¼šæ‹ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã¯ã©ã‚“ãªã‚¿ã‚¤ãƒ—ï¼Ÿ</strong></label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="loveEnergy" value="intense" required>
                <div class="radio-label">
                  <div class="radio-title">æƒ…ç†±çš„ã«ç‡ƒãˆä¸ŠãŒã‚‹</div>
                </div>
              </label>
              <label class="radio-option">
                <input type="radio" name="loveEnergy" value="stable" required>
                <div class="radio-label">
                  <div class="radio-title">ç©ã‚„ã‹ã«æŒç¶šã™ã‚‹</div>
                </div>
              </label>
              <label class="radio-option">
                <input type="radio" name="loveEnergy" value="fluctuating" required>
                <div class="radio-label">
                  <div class="radio-title">æ³¢ãŒã‚ã‚‹ã‚¿ã‚¤ãƒ—</div>
                </div>
              </label>
              <label class="radio-option">
                <input type="radio" name="loveEnergy" value="cool" required>
                <div class="radio-label">
                  <div class="radio-title">ã‚¯ãƒ¼ãƒ«ã«å†·é™ã«</div>
                </div>
              </label>
            </div>
          </div>
        </div>
        
        <div class="loading" id="loadingDiv">
          <div class="spinner"></div>
          <p style="margin-top: 20px; color: #667eea;">è¨ºæ–­ä¸­ã§ã™...</p>
        </div>
        
        <button type="submit" class="submit-btn" id="submitBtn">
          ğŸŒ™ æœˆã«èã„ã¦ã¿ã‚‹
        </button>
      </form>
    </div>
  </div>
  
  <script>
    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰userIdã‚’å–å¾—
    const urlParams = new URLSearchParams(window.location.search);
    const userId = urlParams.get('userId');
    if (userId) {
      document.getElementById('userId').value = userId;
    }
    
    // å¹´æœˆæ—¥é¸æŠè‚¢ã®ç”Ÿæˆ
    function initDateSelects() {
      const currentYear = new Date().getFullYear();
      
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”Ÿå¹´æœˆæ—¥
      const userYear = document.getElementById('userYear');
      for (let y = currentYear - 15; y >= 1950; y--) {
        const option = document.createElement('option');
        option.value = y;
        option.textContent = y + 'å¹´';
        userYear.appendChild(option);
      }
      
      const userMonth = document.getElementById('userMonth');
      for (let m = 1; m <= 12; m++) {
        const option = document.createElement('option');
        option.value = m;
        option.textContent = m + 'æœˆ';
        userMonth.appendChild(option);
      }
      
      const userDay = document.getElementById('userDay');
      for (let d = 1; d <= 31; d++) {
        const option = document.createElement('option');
        option.value = d;
        option.textContent = d + 'æ—¥';
        userDay.appendChild(option);
      }
      
      // ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ç”Ÿå¹´æœˆæ—¥
      const partnerYear = document.getElementById('partnerYear');
      for (let y = currentYear - 15; y >= 1950; y--) {
        const option = document.createElement('option');
        option.value = y;
        option.textContent = y + 'å¹´';
        partnerYear.appendChild(option);
      }
      
      const partnerMonth = document.getElementById('partnerMonth');
      for (let m = 1; m <= 12; m++) {
        const option = document.createElement('option');
        option.value = m;
        option.textContent = m + 'æœˆ';
        partnerMonth.appendChild(option);
      }
      
      const partnerDay = document.getElementById('partnerDay');
      for (let d = 1; d <= 31; d++) {
        const option = document.createElement('option');
        option.value = d;
        option.textContent = d + 'æ—¥';
        partnerDay.appendChild(option);
      }
    }
    
    // ç”Ÿå¹´æœˆæ—¥ã®å¤‰æ›´ã‚’ç›£è¦–
    function watchBirthdateChanges() {
      ['userYear', 'userMonth', 'userDay'].forEach(id => {
        document.getElementById(id).addEventListener('change', function() {
          const year = document.getElementById('userYear').value;
          const month = document.getElementById('userMonth').value;
          const day = document.getElementById('userDay').value;
          
          if (year && month && day) {
            const birthdate = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            document.getElementById('userBirthdate').value = birthdate;
            
            // å¹´é½¢è¨ˆç®—
            const age = calculateAge(new Date(birthdate));
            document.getElementById('userAge').value = age;
          }
        });
      });
      
      ['partnerYear', 'partnerMonth', 'partnerDay'].forEach(id => {
        document.getElementById(id).addEventListener('change', function() {
          const year = document.getElementById('partnerYear').value;
          const month = document.getElementById('partnerMonth').value;
          const day = document.getElementById('partnerDay').value;
          
          if (year && month && day) {
            const birthdate = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            document.getElementById('partnerBirthdate').value = birthdate;
            
            // å¹´é½¢è¨ˆç®—
            const age = calculateAge(new Date(birthdate));
            document.getElementById('partnerAge').value = age;
          }
        });
      });
    }
    
    // å¹´é½¢è¨ˆç®—
    function calculateAge(birthDate) {
      const today = new Date();
      let age = today.getFullYear() - birthDate.getFullYear();
      const m = today.getMonth() - birthDate.getMonth();
      if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
        age--;
      }
      return age;
    }
    
    // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«åˆ¶å¾¡
    document.querySelectorAll('.radio-option').forEach(option => {
      option.addEventListener('click', function() {
        const radioGroup = this.parentElement;
        radioGroup.querySelectorAll('.radio-option').forEach(opt => {
          opt.classList.remove('selected');
        });
        this.classList.add('selected');
        this.querySelector('input[type="radio"]').checked = true;
      });
    });
    
    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
    document.getElementById('profileForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submitBtn');
      const loadingDiv = document.getElementById('loadingDiv');
      const successMessage = document.getElementById('successMessage');
      
      submitBtn.style.display = 'none';
      loadingDiv.classList.add('show');
      
      const formData = new FormData(this);
      const data = Object.fromEntries(formData);
      
      try {
        const response = await fetch('/api/profile-form', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
          loadingDiv.classList.remove('show');
          successMessage.classList.add('show');
          
          // 3ç§’å¾Œã«çµæœãƒšãƒ¼ã‚¸ã¸é·ç§»
          setTimeout(() => {
            window.location.href = result.redirectUrl || '/';
          }, 3000);
        } else {
          alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + (result.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'));
          submitBtn.style.display = 'block';
          loadingDiv.classList.remove('show');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
        submitBtn.style.display = 'block';
        loadingDiv.classList.remove('show');
      }
    });
    
    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
      initDateSelects();
      watchBirthdateChanges();
    });
  </script>
</body>
</html>
