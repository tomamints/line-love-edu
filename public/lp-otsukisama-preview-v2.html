<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨ºæ–­çµæœãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ - ãŠã¤ãã•ã¾è¨ºæ–­</title>
    <link rel="stylesheet" href="css/lp-otsukisama.css">
    <style>
        /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å°‚ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .form-section {
            display: none !important;
        }
        
        .result-section {
            display: block !important;
        }
        
        /* ã¼ã‹ã—åŠ¹æœã¨ãƒ­ãƒƒã‚¯ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        .content-locked {
            position: relative;
            filter: blur(8px);
            user-select: none;
            pointer-events: none;
        }
        
        .lock-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.98);
            padding: 40px 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(138, 97, 250, 0.2);
            border: 2px solid rgba(138, 97, 250, 0.1);
            z-index: 100;
            filter: none;
        }
        
        .lock-icon {
            font-size: 48px;
            display: block;
            margin-bottom: 20px;
        }
        
        .lock-overlay h3 {
            color: #4a3a8c;
            font-size: 20px;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .lock-overlay p {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .unlock-button {
            background: linear-gradient(135deg, #8a61fa 0%, #c77dff 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .unlock-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(138, 97, 250, 0.4);
        }
        
        /* æœ‰æ–™ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒ©ãƒƒãƒ‘ãƒ¼ */
        .premium-content-wrapper {
            position: relative;
        }
        
        /* CTAã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .preview-cta {
            background: linear-gradient(135deg, #f8f4ff 0%, #fff5fb 100%);
            padding: 60px 20px;
            margin: 60px 0;
            border-radius: 30px;
            text-align: center;
            border: 2px solid rgba(138, 97, 250, 0.1);
        }
        
        .preview-cta h2 {
            color: #4a3a8c;
            font-size: 28px;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .preview-cta p {
            color: #666;
            font-size: 16px;
            margin-bottom: 30px;
            line-height: 1.8;
        }
        
        .price-info {
            margin: 30px 0;
        }
        
        .original-price {
            color: #999;
            text-decoration: line-through;
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .special-price {
            font-size: 36px;
            color: #8a61fa;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .price-note {
            color: #666;
            font-size: 14px;
        }
        
        .purchase-button {
            background: linear-gradient(135deg, #8a61fa 0%, #c77dff 100%);
            color: white;
            border: none;
            padding: 20px 60px;
            border-radius: 30px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            text-decoration: none;
            margin-top: 20px;
        }
        
        .purchase-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(138, 97, 250, 0.4);
        }
    </style>
</head>
<body>
    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">è¨ºæ–­çµæœã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</div>
        </div>
    </div>
    
    <!-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é€²æ—ãƒãƒ¼ -->
    <div class="scroll-progress" id="scrollProgress"></div>
    <!-- æ˜Ÿç©ºèƒŒæ™¯ -->
    <div class="stars-container" id="starsContainer"></div>
    
    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="header">
            <div class="main-moon"></div>
            <img src="/images/banner/1-title.png" alt="ãŠã¤ãã•ã¾è¨ºæ–­" class="responsive-image">
            <p class="subtitle">è¨ºæ–­çµæœï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç‰ˆï¼‰</p>
            <p class="sub-description">
                ä¸€éƒ¨ã®å†…å®¹ã®ã¿è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™
            </p>
        </div>
        
        <!-- çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæœ¬ç•ªãƒšãƒ¼ã‚¸ã¨åŒã˜å†…å®¹ï¼‰ -->
        <div class="result-section" id="resultSection">
            <!-- æœˆè© ã®æŒ¨æ‹¶ -->
            <div class="tsukuyomi-section">
                <div class="tsukuyomi-character">
                    <img src="/images/tsukuyomi/2.png" alt="æœˆè© ">
                </div>
                <div class="tsukuyomi-bubble">
                    <div class="tsukuyomi-name">æœˆè© </div>
                    <p>
                        ã“ã‚“ã«ã¡ã¯ã€<span id="resultName"></span>ã•ã‚“ã€‚ç§ã¯æœˆè© ï¼ˆã¤ãã‚ˆã¿ï¼‰ã¨ç”³ã—ã¾ã™ã€‚ä»Šå¤œã®æœˆãŒã€ã‚ãªãŸã®é‹å‘½ã‚’ç…§ã‚‰ã—å‡ºã—ã¾ã™ã€‚ã‚ãªãŸãŒç”Ÿã¾ã‚ŒãŸæ—¥ã®æœˆã¯ã€ç‰¹åˆ¥ãªå½¢ã‚’ã—ã¦ã„ã¾ã—ãŸã€‚ãã®æœˆãŒæŒã¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã€ä»Šã‹ã‚‰ãŠä¼ãˆã—ã¦ã„ãã¾ã™ã­ã€‚
                    </p>
                </div>
            </div>
            
            <!-- ã‚¿ã‚¤ãƒ—è¨ºæ–­ã‚¿ã‚¤ãƒˆãƒ« -->
            <img src="/images/banner/2-anata.png" alt="ãŠã¤ãã•ã¾è¨ºæ–­ã§èª­ã¿è§£ãã‚ãªãŸ" class="full-width-banner">
            
            <!-- æœˆè© ã«ã‚ˆã‚‹è¨ºæ–­èª¬æ˜ -->
            <div class="tsukuyomi-section right">
                <div class="tsukuyomi-character">
                    <img src="/images/tsukuyomi/4.png" alt="æœˆè© ">
                </div>
                <div class="tsukuyomi-bubble">
                    <div class="tsukuyomi-name">æœˆè© </div>
                    <p>
                        ã•ã¦ã€ã“ã“ã‹ã‚‰ãŒæœ¬é¡Œã§ã™ã€‚ã“ã‚Œã‹ã‚‰ã€ã‚ãªãŸã®ç”Ÿã¾ã‚ŒãŸæ—¥ã®æœˆç›¸ã‚’åŸºã«ã€6ã¤ã®è¦ç´ ã‹ã‚‰ã‚ãªãŸã®æœ¬è³ªã‚’æ˜ã‚‰ã‹ã«ã—ã¦ã„ãã¾ã™ã€‚ã¾ãšã¯ã€ã“ã®6ã¤ã®è¦ç´ ãŒä½•ã‚’æ„å‘³ã™ã‚‹ã®ã‹ã”è¦§ãã ã•ã„ã€‚
                    </p>
                </div>
            </div>
            
            <!-- 6ã¤ã®ã‚¿ã‚¤ãƒ—ã‚’å††å½¢é…ç½®ï¼ˆç„¡æ–™ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰ -->
            <div class="moon-types-circle">
                <!-- è»Œé“ç·š -->
                <div class="orbit-path"></div>
                
                <!-- ä¸­å¿ƒã®æœˆ -->
                <div class="center-moon"></div>
                
                <!-- è¦ç´ ã‚³ãƒ³ãƒ†ãƒŠ -->
                <div class="elements-container">
                    <!-- æœˆç›¸ (0åº¦ - ä¸Š) -->
                    <div class="type-item moon-phase-item" data-position="0" data-moon-type="omote" data-moon-phase="0">
                        <img src="/images/moon/omote-0.png" alt="è¡¨æœˆç›¸" class="circle-element-image">
                        <span class="circle-element-label-top label-color-gold">æœˆç›¸</span>
                        <span class="circle-element-label-bottom">èª­ã¿è¾¼ã¿ä¸­...</span>
                    </div>
                    
                    <!-- è£æœˆç›¸ (60åº¦ - å³ä¸Š) -->
                    <div class="type-item moon-phase-item" data-position="60" data-moon-type="ura" data-moon-phase="1">
                        <img src="/images/moon/ura-0.png" alt="è£æœˆç›¸" class="circle-element-image">
                        <span class="circle-element-label-top label-color-purple">è£æœˆç›¸</span>
                        <span class="circle-element-label-bottom">èª­ã¿è¾¼ã¿ä¸­...</span>
                    </div>
                    
                    <!-- æ„Ÿæƒ…è¡¨ç¾ (120åº¦ - å³ä¸‹) -->
                    <div class="type-item love-type-item" data-position="120" data-type="emotional" data-value="">
                        <img src="/images/love-types/emotional/straight.png" alt="æ„Ÿæƒ…è¡¨ç¾" class="circle-element-image-contain">
                        <span class="circle-element-label-top label-color-pink">æ„Ÿæƒ…è¡¨ç¾</span>
                        <span class="circle-element-label-bottom">...</span>
                    </div>
                    
                    <!-- è·é›¢æ„Ÿ (180åº¦ - ä¸‹) -->
                    <div class="type-item love-type-item" data-position="180" data-type="distance" data-value="">
                        <img src="/images/love-types/distance/close.png" alt="è·é›¢æ„Ÿ" class="circle-element-image-contain">
                        <span class="circle-element-label-top label-color-green">è·é›¢æ„Ÿ</span>
                        <span class="circle-element-label-bottom">...</span>
                    </div>
                    
                    <!-- ä¾¡å€¤è¦³ (240åº¦ - å·¦ä¸‹) -->
                    <div class="type-item love-type-item" data-position="240" data-type="values" data-value="">
                        <img src="/images/love-types/values/realistic.png" alt="ä¾¡å€¤è¦³" class="circle-element-image-contain">
                        <span class="circle-element-label-top label-color-blue">ä¾¡å€¤è¦³</span>
                        <span class="circle-element-label-bottom">...</span>
                    </div>
                    
                    <!-- ã‚¨ãƒãƒ«ã‚®ãƒ¼ (300åº¦ - å·¦ä¸Š) -->
                    <div class="type-item love-type-item" data-position="300" data-type="energy" data-value="">
                        <img src="/images/love-types/energy/intense.png" alt="ã‚¨ãƒãƒ«ã‚®ãƒ¼" class="circle-element-image-contain">
                        <span class="circle-element-label-top label-color-orange">ã‚¨ãƒãƒ«ã‚®ãƒ¼</span>
                        <span class="circle-element-label-bottom">...</span>
                    </div>
                </div>
            </div>
            
            <p class="section-description">
                ç”Ÿã¾ã‚ŒãŸæ—¥ã®æœˆç›¸ã‹ã‚‰èª­ã¿è§£ãã€ã‚ãªãŸã®ã€Œæœ¬å½“ã®è‡ªåˆ†ã€
            </p>
            
            <!-- æœˆç›¸èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆç„¡æ–™ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰ -->
            <div class="section-header-container">
                <img src="/images/banner/3-getsusou.png" alt="ã¾ãšã¯ã€ã‚ãªãŸã®æœˆç›¸ã‹ã‚‰è¦‹ã¦ã„ãã¾ã—ã‚‡ã†" class="full-width-banner">
                <p class="section-description">
                    æœˆç›¸ã¨ã¯ã€ã‚ãªãŸãŒç”Ÿã¾ã‚ŒãŸæ—¥ã®æœˆã®å½¢ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€ã‚ãªãŸã®åŸºæœ¬çš„ãªæ€§æ ¼ã‚„äººç”Ÿã®ãƒ†ãƒ¼ãƒãŒã‚ã‹ã‚Šã¾ã™ã€‚ã‚ãªãŸã®æœˆç›¸ã¯...
                </p>
            </div>
            
            <!-- æœˆç›¸ã‚¿ã‚¤ãƒ— -->
            <div class="moon-phase-card new-moon">
                <div class="moon-phase-header">
                    <img src="/images/moon/omote-0.png" alt="æ–°æœˆ" class="moon-phase-visual moon-phase-image">
                    <div class="moon-phase-info">
                        <h2>æ–°æœˆ</h2>
                        <p class="moon-phase-subtitle">æ–°ã—ã„å§‹ã¾ã‚Šã®åŠ›ã€‚ç„¡é™ã®å¯èƒ½æ€§ã‚’ç§˜ã‚ãŸé–‹æ‹“è€…</p>
                    </div>
                </div>
                <div class="moon-phase-description" id="moon-phase-description">
                    ã‚ãªãŸã¯æ–°æœˆã®æ—¥ã«ç”Ÿã¾ã‚ŒãŸã€å§‹ã¾ã‚Šã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æŒã¤äººã€‚ä½•ã‚‚ãªã„ã¨ã“ã‚ã‹ã‚‰ä½•ã‹ã‚’ç”Ÿã¿å‡ºã™åŠ›ãŒã‚ã‚Šã€ã‚¼ãƒ­ã‹ã‚‰1ã‚’ä½œã‚Šå‡ºã™ã“ã¨ã«é•·ã‘ã¦ã„ã¾ã™ã€‚ç´”ç²‹ã§ç´ ç›´ãªå¿ƒã‚’æŒã¡ã€æ–°ã—ã„ã“ã¨ã¸ã®å¥½å¥‡å¿ƒãŒæ—ºç››ã€‚ã¾ã èª°ã‚‚è¸ã¿å…¥ã‚Œã¦ã„ãªã„é“ã‚’é€²ã‚€ãƒ‘ã‚¤ã‚ªãƒ‹ã‚¢ç²¾ç¥ãŒã‚ã‚Šã¾ã™ã€‚æ™‚ã«ç„¡é‰„ç ²ã«è¦‹ãˆã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ãŒã€ãã®å‹‡æ°—ã“ããŒã‚ãªãŸã®æœ€å¤§ã®æ­¦å™¨ãªã®ã§ã™ã€‚
                </div>
            </div>
            
            <!-- è³¼å…¥CTA -->
            <div class="preview-cta">
                <h2>ğŸ”’ å®Œå…¨ç‰ˆã§å…¨ã¦ã®å†…å®¹ã‚’è¦‹ã‚‹</h2>
                <p>
                    ä»¥ä¸‹ã®å†…å®¹ã‚’å«ã‚€ã€ã‚ãªãŸã ã‘ã®å®Œå…¨ãªè¨ºæ–­çµæœã‚’ã”è¦§ã„ãŸã ã‘ã¾ã™ï¼š
                </p>
                <ul style="text-align: left; max-width: 500px; margin: 0 auto; color: #666; line-height: 2;">
                    <li>è£ã®æœˆç›¸ã¨ã‚ãªãŸã®éš ã•ã‚ŒãŸé¡”</li>
                    <li>3ã¤ã®æœˆã®åŠ›ã®è©³ç´°è§£èª¬</li>
                    <li>4ã¤ã®è»¸ã‹ã‚‰è¦‹ãŸæ‹æ„›æ€§æ ¼ã®å®Œå…¨åˆ†æ</li>
                    <li>ç›´è¿‘3ãƒ¶æœˆã®è©³ç´°ãªé‹å‹¢äºˆæ¸¬</li>
                    <li>æ‹æ„›é‹ãƒ»äººé–“é–¢ä¿‚é‹ãƒ»ä»•äº‹é‹ãƒ»é‡‘é‹ã®å®Œå…¨ç‰ˆ</li>
                    <li>ã‚ãªãŸã ã‘ã®æœˆé½¢ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</li>
                    <li>æœˆãŒæ•™ãˆã¦ãã‚Œã‚‹5ã¤ã®æ•™ãˆ</li>
                </ul>
                
                <div class="price-info">
                    <div class="original-price">é€šå¸¸ä¾¡æ ¼ Â¥2,980</div>
                    <div class="special-price">ç‰¹åˆ¥ä¾¡æ ¼ Â¥980</div>
                    <div class="price-note">ï¼ˆç¨è¾¼ï¼‰</div>
                </div>
                
                <button class="purchase-button" id="purchaseButton">
                    è¨ºæ–­çµæœã‚’è³¼å…¥ã™ã‚‹
                </button>
            </div>
            
            <!-- ä»¥é™ã®å†…å®¹ã¯ã¼ã‹ã—è¡¨ç¤º -->
            <div class="premium-content-wrapper">
                <div class="content-locked">
                    <!-- è£æœˆç›¸èª¬æ˜ -->
                    <div class="section-header-container">
                        <img src="/images/banner/4-2-uranokao.png" alt="ãã—ã¦ã€ã‚ãªãŸã®è£ã®é¡”ã‚‚è¦‹ã¦ã¿ã¾ã—ã‚‡ã†" class="full-width-banner">
                        <p class="section-description-compact">
                            è¡¨ã®æœˆç›¸ãŒç¤¾ä¼šçš„ãªé¡”ã ã¨ã™ã‚Œã°ã€è£æœˆç›¸ã¯ã‚ãªãŸã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªé¡”ã€‚è¦ªã—ã„äººã®å‰ã§ã ã‘è¦‹ã›ã‚‹ã€ã‚‚ã†ä¸€ã¤ã®ã‚ãªãŸã§ã™ã€‚
                        </p>
                    </div>
                    
                    <!-- è£æœˆç›¸ -->
                    <div class="moon-phase-card crescent">
                        <div class="moon-phase-header">
                            <img src="/images/moon/ura-1.png" alt="ä¸‰æ—¥æœˆ" class="moon-phase-visual moon-phase-image">
                            <div class="moon-phase-info">
                                <h2>ä¸‰æ—¥æœˆï¼ˆè£ã®é¡”ï¼‰</h2>
                                <p class="moon-phase-subtitle">å†…ãªã‚‹ç¹Šç´°ã•ã¨æ…é‡ã•ã‚’ç§˜ã‚ãŸç­–å£«</p>
                            </div>
                        </div>
                        <div class="moon-phase-description" id="hidden-phase-description">
                            è¡¨å‘ãã¯å‹¢ã„ã‚ˆãçªãé€²ã‚€ã‚ãªãŸã§ã™ãŒã€å®Ÿã¯å†…é¢ã§ã¯ç´°ã‚„ã‹ãªé…æ…®ãŒã§ãã‚‹ç¹Šç´°ãªäººã€‚æ–°ã—ã„ã“ã¨ã‚’å§‹ã‚ã‚‹å‰ã«ã€å®Ÿã¯ã—ã£ã‹ã‚Šã¨ä¸‹èª¿ã¹ã‚’ã—ã¦ã„ãŸã‚Šã€ãƒªã‚¹ã‚¯ã‚’è¨ˆç®—ã—ã¦ã„ãŸã‚Šã™ã‚‹ã§ã—ã‚‡ã†ã€‚ãã®æ…é‡ã•ã¨å¤§èƒ†ã•ã®ãƒãƒ©ãƒ³ã‚¹ãŒã€ã‚ãªãŸã®æˆåŠŸã®ç§˜è¨£ã€‚æ™‚ã€…å¼±éŸ³ã‚’åããŸããªã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ãŒã€ãã‚Œã¯æˆé•·ã®è¨¼ã§ã™ã€‚
                        </div>
                    </div>
                </div>
                
                <div class="lock-overlay">
                    <span class="lock-icon">ğŸ”’</span>
                    <h3>ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</h3>
                    <p>ã“ã®å…ˆã®è©³ç´°ãªè¨ºæ–­çµæœã‚’<br>ã”è¦§ã„ãŸã ãã«ã¯è³¼å…¥ãŒå¿…è¦ã§ã™</p>
                    <button class="unlock-button" onclick="document.getElementById('purchaseButton').click()">
                        å®Œå…¨ç‰ˆã‚’è¦‹ã‚‹
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/otsukisama-data-loader.js?v=20250829001"></script>
    <script src="js/lp-otsukisama-moon.js?v=20241228006"></script>
    <script src="js/lp-otsukisama-api.js?v=20241228006"></script>
    <script src="js/lp-otsukisama-display.js?v=20250829007"></script>
    <script src="js/lp-otsukisama-display-line.js?v=20241228006"></script>
    <script src="js/lp-otsukisama-calendar.js?v=20241228008"></script>
    <script src="js/lp-otsukisama-graph.js?v=20241228006"></script>
    
    <script>
        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã®åˆæœŸåŒ–
        async function initPreview() {
            const urlParams = new URLSearchParams(window.location.search);
            const diagnosisId = urlParams.get('id');
            const userId = urlParams.get('userId');
            
            // è¨ºæ–­ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
            if (diagnosisId) {
                try {
                    const response = await fetch(`/api/profile-form?action=get-diagnosis&id=${diagnosisId}`);
                    const data = await response.json();
                    
                    if (data.success && data.diagnosis) {
                        // åå‰ã‚’è¡¨ç¤º
                        const resultName = document.getElementById('resultName');
                        if (resultName) {
                            resultName.textContent = data.diagnosis.user_name || 'ã‚ãªãŸ';
                        }
                        
                        // ãƒ‘ã‚¿ãƒ¼ãƒ³IDã‹ã‚‰æœˆç›¸ã‚’è¨ˆç®—
                        const patternId = data.diagnosis.pattern_id;
                        const moonPhaseIndex = Math.floor(patternId / 8);
                        const hiddenPhaseIndex = patternId % 8;
                        
                        // æœˆç›¸ç”»åƒã‚’æ›´æ–°
                        const moonPhaseImg = document.querySelector('.moon-phase-image');
                        if (moonPhaseImg) {
                            moonPhaseImg.src = `/images/moon/omote-${moonPhaseIndex}.png`;
                        }
                        
                        // ãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šï¼ˆæœ¬ç•ªãƒšãƒ¼ã‚¸ã¨åŒã˜é–¢æ•°ã‚’ä½¿ç”¨ï¼‰
                        if (typeof updateMoonPhaseContent === 'function') {
                            updateMoonPhaseContent(patternId);
                        }
                        if (typeof updateSixElements === 'function') {
                            const moonPhaseNames = ['æ–°æœˆ', 'ä¸‰æ—¥æœˆ', 'ä¸Šå¼¦ã®æœˆ', 'åä¸‰å¤œ', 'æº€æœˆ', 'åå…­å¤œ', 'ä¸‹å¼¦ã®æœˆ', 'æš'];
                            updateSixElements(patternId, moonPhaseNames[moonPhaseIndex], moonPhaseNames[hiddenPhaseIndex], null);
                        }
                    }
                } catch (error) {
                    console.error('è¨ºæ–­ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                }
            }
            
            // è³¼å…¥ãƒœã‚¿ãƒ³ã®è¨­å®š
            document.getElementById('purchaseButton').addEventListener('click', async () => {
                const button = document.getElementById('purchaseButton');
                button.disabled = true;
                button.textContent = 'å‡¦ç†ä¸­...';
                
                try {
                    const response = await fetch('/api/profile-form?action=create-checkout', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            diagnosisId: diagnosisId,
                            userId: userId || ''
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        if (data.isPaid) {
                            window.location.href = data.redirectUrl;
                        } else {
                            window.location.href = data.checkoutUrl;
                        }
                    } else {
                        throw new Error(data.error || 'æ±ºæ¸ˆå‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                } catch (error) {
                    console.error('æ±ºæ¸ˆã‚¨ãƒ©ãƒ¼:', error);
                    alert('æ±ºæ¸ˆå‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
                    button.disabled = false;
                    button.textContent = 'è¨ºæ–­çµæœã‚’è³¼å…¥ã™ã‚‹';
                }
            });
        }
        
        // DOMãƒ­ãƒ¼ãƒ‰å¾Œã«åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', initPreview);
    </script>
</body>
</html>