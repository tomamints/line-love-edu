<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>3つの力テスト</title>
    <style>
        .moon-characteristic {
            color: #FFD700;
            font-weight: bold;
        }
        .energy-item {
            margin: 20px;
            padding: 20px;
            border: 1px solid #ccc;
        }
        .energy-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .test-section {
            margin: 30px;
            padding: 20px;
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <h1>3つの力のHTMLタグ表示テスト</h1>
    
    <div class="test-section">
        <h2>テスト1: 現在の実装（問題あり）</h2>
        <div id="test1"></div>
    </div>
    
    <div class="test-section">
        <h2>テスト2: 修正案1</h2>
        <div id="test2"></div>
    </div>
    
    <div class="test-section">
        <h2>テスト3: 修正案2（DOMParser使用）</h2>
        <div id="test3"></div>
    </div>

    <script>
        // テストデータ
        const testPower = {
            title: "段取りの力",
            desc: "〇〇さんは、周りの人よりも<span class='moon-characteristic'>先の流れを考えて動いてしまう</span>タイプです。\n例えば、旅行の前に持ち物や予定を細かく決めてしまうこと、ありませんか？\nその段取り力が、〇〇さんの安心感を生み出しているのです。"
        };
        const displayName = "とうま";
        
        // テスト1: 現在の実装（問題を再現）
        function test1() {
            const container = document.getElementById('test1');
            let desc = testPower.desc.replace(/〇〇/g, displayName);
            const lines = desc.split('\n');
            const processed = lines.join('<br>');
            
            const html = `
                <div class="energy-item">
                    <div class="energy-title">${testPower.title}</div>
                    <div class="energy-description">
                        ${processed}
                    </div>
                </div>
            `;
            container.innerHTML = html;
            
            console.log('Test1 HTML:', html);
            console.log('Test1 innerHTML result:', container.querySelector('.energy-description').innerHTML);
        }
        
        // テスト2: 修正案1 - テキストノードとHTMLを分離
        function test2() {
            const container = document.getElementById('test2');
            const energyItem = document.createElement('div');
            energyItem.className = 'energy-item';
            
            const title = document.createElement('div');
            title.className = 'energy-title';
            title.textContent = testPower.title;
            energyItem.appendChild(title);
            
            const description = document.createElement('div');
            description.className = 'energy-description';
            
            // descの処理
            let desc = testPower.desc.replace(/〇〇/g, displayName);
            // 改行を<br>に変換しながらHTMLを保持
            desc = desc.replace(/\n/g, '<br>');
            
            // innerHTMLで直接設定
            description.innerHTML = desc;
            energyItem.appendChild(description);
            
            container.appendChild(energyItem);
            
            console.log('Test2 desc:', desc);
            console.log('Test2 innerHTML result:', description.innerHTML);
        }
        
        // テスト3: 修正案2 - DOMParserを使用
        function test3() {
            const container = document.getElementById('test3');
            
            // descの処理
            let desc = testPower.desc.replace(/〇〇/g, displayName);
            desc = desc.replace(/\n/g, '<br>');
            
            // テンプレートリテラルで作成
            const htmlString = `
                <div class="energy-item">
                    <div class="energy-title">${testPower.title}</div>
                    <div class="energy-description">${desc}</div>
                </div>
            `;
            
            // DOMParserを使用してパース
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlString, 'text/html');
            const element = doc.body.firstChild;
            
            container.appendChild(element);
            
            console.log('Test3 desc:', desc);
            console.log('Test3 innerHTML result:', container.querySelector('.energy-description').innerHTML);
        }
        
        // テスト実行
        test1();
        test2();
        test3();
        
        // コンソールに結果を表示
        console.log('===== テスト結果 =====');
        console.log('Test1 HTML内容:', document.getElementById('test1').querySelector('.energy-description')?.textContent);
        console.log('Test2 HTML内容:', document.getElementById('test2').querySelector('.energy-description')?.textContent);
        console.log('Test3 HTML内容:', document.getElementById('test3').querySelector('.energy-description')?.textContent);
    </script>
</body>
</html>