// æœˆç›¸å ã„ã‚¨ãƒ³ã‚¸ãƒ³ V2
// aisyo.md ã®è©³ç´°ãªæœˆã‚¿ã‚¤ãƒ—è¨ºæ–­ã‚’å®Ÿè£…

class MoonFortuneEngineV2 {
  constructor() {
    // 8ã¤ã®æœˆã‚¿ã‚¤ãƒ—å®šç¾©ï¼ˆaisyo.mdãƒ™ãƒ¼ã‚¹ï¼‰
    this.moonTypes = [
      'æ–°æœˆ',      // 0
      'ä¸‰æ—¥æœˆ',    // 1
      'ä¸Šå¼¦ã®æœˆ',  // 2
      'åä¸‰å¤œ',    // 3
      'æº€æœˆ',      // 4
      'åå…­å¤œ',    // 5
      'ä¸‹å¼¦ã®æœˆ',  // 6
      'æš'         // 7
    ];

    // æœˆé½¢ã‹ã‚‰æœˆã‚¿ã‚¤ãƒ—ã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°
    this.moonPhaseRanges = [
      { type: 'æ–°æœˆ', emoji: 'ğŸŒ‘', range: [0, 1.8] },
      { type: 'ä¸‰æ—¥æœˆ', emoji: 'ğŸŒ’', range: [1.8, 5.5] },
      { type: 'ä¸Šå¼¦ã®æœˆ', emoji: 'ğŸŒ“', range: [5.5, 9.2] },
      { type: 'åä¸‰å¤œ', emoji: 'ğŸŒ”', range: [9.2, 13.0] },
      { type: 'æº€æœˆ', emoji: 'ğŸŒ•', range: [13.0, 16.5] },
      { type: 'åå…­å¤œ', emoji: 'ğŸŒ–', range: [16.5, 20.2] },
      { type: 'ä¸‹å¼¦ã®æœˆ', emoji: 'ğŸŒ—', range: [20.2, 24.0] },
      { type: 'æš', emoji: 'ğŸŒ˜', range: [24.0, 29.5] }
    ];

    // ç›¸æ€§ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ï¼ˆaisyo.mdã‹ã‚‰ï¼‰
    // â—=95ç‚¹ã€â—‹=75ç‚¹ã€â–³=55ç‚¹
    this.compatibilityMatrix = {
      'æ–°æœˆ': {
        'æ–°æœˆ': 95, 'ä¸‰æ—¥æœˆ': 55, 'ä¸Šå¼¦ã®æœˆ': 75, 'åä¸‰å¤œ': 95,
        'æº€æœˆ': 95, 'åå…­å¤œ': 75, 'ä¸‹å¼¦ã®æœˆ': 55, 'æš': 55
      },
      'ä¸‰æ—¥æœˆ': {
        'æ–°æœˆ': 55, 'ä¸‰æ—¥æœˆ': 95, 'ä¸Šå¼¦ã®æœˆ': 95, 'åä¸‰å¤œ': 75,
        'æº€æœˆ': 75, 'åå…­å¤œ': 95, 'ä¸‹å¼¦ã®æœˆ': 75, 'æš': 55
      },
      'ä¸Šå¼¦ã®æœˆ': {
        'æ–°æœˆ': 75, 'ä¸‰æ—¥æœˆ': 95, 'ä¸Šå¼¦ã®æœˆ': 75, 'åä¸‰å¤œ': 75,
        'æº€æœˆ': 55, 'åå…­å¤œ': 55, 'ä¸‹å¼¦ã®æœˆ': 95, 'æš': 75
      },
      'åä¸‰å¤œ': {
        'æ–°æœˆ': 95, 'ä¸‰æ—¥æœˆ': 75, 'ä¸Šå¼¦ã®æœˆ': 75, 'åä¸‰å¤œ': 95,
        'æº€æœˆ': 75, 'åå…­å¤œ': 55, 'ä¸‹å¼¦ã®æœˆ': 55, 'æš': 95
      },
      'æº€æœˆ': {
        'æ–°æœˆ': 95, 'ä¸‰æ—¥æœˆ': 75, 'ä¸Šå¼¦ã®æœˆ': 55, 'åä¸‰å¤œ': 75,
        'æº€æœˆ': 55, 'åå…­å¤œ': 95, 'ä¸‹å¼¦ã®æœˆ': 75, 'æš': 55
      },
      'åå…­å¤œ': {
        'æ–°æœˆ': 75, 'ä¸‰æ—¥æœˆ': 95, 'ä¸Šå¼¦ã®æœˆ': 55, 'åä¸‰å¤œ': 55,
        'æº€æœˆ': 95, 'åå…­å¤œ': 95, 'ä¸‹å¼¦ã®æœˆ': 75, 'æš': 75
      },
      'ä¸‹å¼¦ã®æœˆ': {
        'æ–°æœˆ': 55, 'ä¸‰æ—¥æœˆ': 75, 'ä¸Šå¼¦ã®æœˆ': 95, 'åä¸‰å¤œ': 55,
        'æº€æœˆ': 75, 'åå…­å¤œ': 75, 'ä¸‹å¼¦ã®æœˆ': 95, 'æš': 95
      },
      'æš': {
        'æ–°æœˆ': 55, 'ä¸‰æ—¥æœˆ': 55, 'ä¸Šå¼¦ã®æœˆ': 75, 'åä¸‰å¤œ': 95,
        'æº€æœˆ': 55, 'åå…­å¤œ': 75, 'ä¸‹å¼¦ã®æœˆ': 95, 'æš': 95
      }
    };

    // æœˆã‚¿ã‚¤ãƒ—ã”ã¨ã®è©³ç´°èª¬æ˜ï¼ˆaisyo.mdã‹ã‚‰æŠœç²‹ï¼‰
    this.moonTypeDetails = {
      'æ–°æœˆ': {
        title: 'æ–°æœˆã‚¿ã‚¤ãƒ—ã®ç‰©èª',
        introduction: 'ã‚ãªãŸãŒç”Ÿã¾ã‚ŒãŸå¤œã€ç©ºã«ã¯æœˆãŒè¦‹ãˆã¾ã›ã‚“ã§ã—ãŸã€‚',
        symbolism: 'æ–°æœˆã¯ã€Œå§‹ã¾ã‚Šã€ã€ŒçœŸã£ã•ã‚‰ãªå¯èƒ½æ€§ã€ã€Œã¾ã è¦‹ãˆãªã„æœªæ¥ã€ã‚’è±¡å¾´ã—ã¾ã™ã€‚',
        traits: [
          'ç›´æ„ŸåŠ›ã¨ç¬ç™ºåŠ›ãŒé£›ã³æŠœã‘ã¦ã„ã¾ã™',
          'æœªçŸ¥ã®äººãƒ»å ´æ‰€ãƒ»ä½“é¨“ã«å¼·ãæƒ¹ã‹ã‚Œã‚‹',
          'å¿ƒãŒå‹•ã„ãŸç¬é–“ã«è¡Œå‹•ã§ãã‚‹',
          'åˆå¯¾é¢ã§ã‚‚è‡ªç„¶ã«è·é›¢ã‚’ç¸®ã‚ã‚‰ã‚Œã‚‹',
          'ã€Œä»Šã€ã®æ°—æŒã¡ã‚’å¤§äº‹ã«ã—ã€å‹¢ã„ãŒã‚ã‚‹'
        ],
        loveStyle: 'æ–°æœˆã®æ‹ã¯ã€é›·ãŒè½ã¡ã‚‹ã‚ˆã†ã«å§‹ã¾ã‚Šã¾ã™ã€‚ã€Œã“ã®äººã ï¼ã€ã¨ç›´æ„Ÿã—ãŸã‚‰ã€ä¸€æ°—ã«è·é›¢ã‚’è©°ã‚ã€çŸ­æœŸé–“ã§æ·±ã„é–¢ä¿‚ã«ã€‚',
        loveExamples: [
          'å‡ºä¼šã£ã¦æ•°æ™‚é–“ã§ã€Œæ¥é€±ã€ã”é£¯è¡Œã“ã†ï¼ã€ã¨å³ææ¡ˆ',
          'LINEã¯ç†±é‡é«˜ã‚ã€å†™çœŸã‚„å‹•ç”»ã‚‚ã™ãå…±æœ‰',
          'ä»˜ãåˆã†å‰ã§ã‚‚ã‚µãƒ—ãƒ©ã‚¤ã‚ºã‚„é å‡ºã‚’ææ¡ˆã—ã€ç›¸æ‰‹ã‚’ãƒ¯ã‚¯ãƒ¯ã‚¯ã•ã›ã‚‹'
        ],
        caution: 'ãŸã ã—ã€å®‰å®šæœŸã«å…¥ã‚‹ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒçŸ­ããªã£ãŸã‚Šã€ä¼šã†é–“éš”ãŒç©ºã„ãŸã‚Šã™ã‚‹ã“ã¨ã‚‚ã€‚æœ¬äººã¯ã€Œè½ã¡ç€ã„ãŸã ã‘ã€ã§ã‚‚ã€ç›¸æ‰‹ã¯ã€Œå†·ã‚ã‚‰ã‚ŒãŸï¼Ÿã€ã¨æ„Ÿã˜ã‚„ã™ã„ç‚¹ã«æ³¨æ„ã€‚',
        actionAdvice: [
          'ã€Œå®‰å®šãƒ‡ãƒ¼ã€ã‚’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«å…ˆç½®ãï¼šæœˆã«2å›ã¯å‹•ã‹ãªã„ãƒ‡ãƒ¼ãƒˆï¼ˆè‡ªç‚Šãƒ»æ•£æ­©ãƒ»æ˜ ç”»ï¼‰ã‚’äºˆç´„',
          'ç†±é‡ã®"3æ®µå¤‰é€Ÿ"é‹è»¢ï¼šåˆæœŸï¼å…¨é–‹ï¼ä¸­æœŸï¼å®‰å®šï¼é•·æœŸï¼ä½ç‡ƒè²»',
          'é€±1æ—¥ã¯é€£çµ¡ã‚„ææ¡ˆã‚’ã›ãšã€ç›¸æ‰‹ã‹ã‚‰ã®å‹•ãã‚’å¾…ã¤'
        ]
      },
      'ä¸‰æ—¥æœˆ': {
        title: 'ä¸‰æ—¥æœˆã‚¿ã‚¤ãƒ—ã®ç‰©èª',
        introduction: 'ã‚ãªãŸãŒç”Ÿã¾ã‚ŒãŸæ—¥ã®å¤œç©ºã«ã¯ã€å³å´ã«ç´°ãå…‰ã‚‹ä¸‰æ—¥æœˆãŒæµ®ã‹ã‚“ã§ã„ã¾ã—ãŸã€‚',
        symbolism: 'ä¸‰æ—¥æœˆã¯ã€Œæº–å‚™ã€ã€ŒèŠ½å¹ãã®ä¿è­·ã€ã€ŒæŸ”è»Ÿãªé©å¿œåŠ›ã€ã‚’è±¡å¾´ã—ã¾ã™ã€‚',
        traits: [
          'çŠ¶æ³ã‚’ã‚ˆãè¦³å¯Ÿã—ã€ç›¸æ‰‹ã‚„ç’°å¢ƒã«åˆã‚ã›ã¦è·é›¢æ„Ÿã‚’èª¿æ•´ã§ãã‚‹',
          'ç›¸æ‰‹ã®æ„Ÿæƒ…ã‚„é›°å›²æ°—ã‚’æ•æ„Ÿã«å¯ŸçŸ¥ã™ã‚‹',
          'è‡ªåˆ†ã‚ˆã‚Šã‚‚ç›¸æ‰‹ã‚’å„ªå…ˆã™ã‚‹å ´é¢ãŒå¤šã„',
          'ç„¡ç†ã‚’ã›ãšè‡ªç„¶ä½“ã§é–¢ä¿‚ã‚’ç¶šã‘ã‚‰ã‚Œã‚‹'
        ],
        loveStyle: 'ä¸‰æ—¥æœˆã®æ‹ã¯ã€ç¨®ã‚’å°‘ã—ãšã¤è‚²ã¦ã‚‹åº­å¸«ã®ã‚ˆã†ã§ã™ã€‚ä¸€ç›®æƒšã‚Œã‚ˆã‚Šã‚‚ã€å®‰å¿ƒæ„Ÿã‚’ç©ã¿é‡ã­ã¦è·é›¢ã‚’ç¸®ã‚ã¾ã™ã€‚',
        loveExamples: [
          'æ°—ã«ãªã‚‹ç›¸æ‰‹ã«ã¯ã€ã¾ãšLINEã‚„ä¼šè©±ã§ä¿¡é ¼é–¢ä¿‚ã‚’ä½œã£ã¦ã‹ã‚‰ãƒ‡ãƒ¼ãƒˆã«èª˜ã†',
          'ç›¸æ‰‹ãŒå¿™ã—ã„ã¨ãã¯ç„¡ç†ã«ä¼šãŠã†ã¨ã›ãšã€çŸ­ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã ã‘é€ã‚‹',
          'æ‹äººã®ç–²ã‚Œã‚’å¯ŸçŸ¥ã—ã¦ã€ä¼šã†ä»£ã‚ã‚Šã«ã€Œã‚†ã£ãã‚Šä¼‘ã‚“ã§ã­ã€ã¨ä¼ãˆã‚‹'
        ],
        caution: 'å„ªã—ã•ãŒå¼·ã™ãã¦æœ¬éŸ³ã‚’å¾Œå›ã—ã«ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã€æ‹æ„›ã®é€²å±•ãŒã‚†ã£ãã‚Šã«ãªã‚ŠãŒã¡ã§ã™ã€‚',
        actionAdvice: [
          '"å°ã•ãªä¸€æ­©ã‚¢ã‚¯ã‚·ãƒ§ãƒ³"ã‚’æœˆ3å›ï¼šè»½ã„èª˜ã„ã‚„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§è‡ªåˆ†ã‹ã‚‰å‹•ãç¿’æ…£',
          'æœ¬éŸ³ãƒ¡ãƒ¢ã‚’é€±1å›ï¼šç›¸æ‰‹ã«ä¼ãˆãŸã„ã“ã¨ã‚’ãƒ¡ãƒ¢ã«æ›¸ãå‡ºã—ã€ãã®ä¸­ã‹ã‚‰1ã¤ã ã‘ä¼ãˆã‚‹',
          'æ„Ÿæƒ…å…±æœ‰ãƒ‡ãƒ¼ï¼šæœˆæœ«ã«ã€Œä»Šæœˆã®å¬‰ã—ã‹ã£ãŸã“ã¨ãƒ»ä¸å®‰ã ã£ãŸã“ã¨ã€ã‚’ãŠäº’ã„è©±ã™'
        ]
      },
      'ä¸Šå¼¦ã®æœˆ': {
        title: 'ä¸Šå¼¦ã®æœˆã‚¿ã‚¤ãƒ—ã®ç‰©èª',
        introduction: 'ã‚ãªãŸãŒç”Ÿã¾ã‚ŒãŸå¤œã€å³åŠåˆ†ãŒãã£ãã‚Šã¨å…‰ã‚‹ä¸Šå¼¦ã®æœˆãŒç©ºã«ã‹ã‹ã£ã¦ã„ã¾ã—ãŸã€‚',
        symbolism: 'ä¸Šå¼¦ã®æœˆã¯ã€Œè¡Œå‹•è¨ˆç”»ã€ã€ŒåŠ é€Ÿã€ã€Œæ®µéšçš„ãªæˆé•·ã€ã‚’è±¡å¾´ã—ã¾ã™ã€‚',
        traits: [
          'ç›®çš„ã‚’æ±ºã‚ãŸã‚‰"ã„ã¤ãƒ»ä½•ã‚’ãƒ»ã©ã†ã‚„ã£ã¦"ã‚’è‡ªç„¶ã«çµ„ã¿ç«‹ã¦ã‚‹',
          'å‹¢ã„ã ã‘ã§èµ°ã‚‹ã®ã§ã¯ãªãã€ç¾å®Ÿã«è½ã¨ã—è¾¼ã‚€è¨­è¨ˆå›³ã¥ãã‚ŠãŒå¾—æ„',
          'ç€å®Ÿã«å‰ã¸é€²ã‚ã‚‹æ¨é€²åŠ›ãŒã‚ã‚‹',
          'è¨ˆç”»ã‚’å®ˆã‚‹æ„è­˜ãŒå¼·ã„'
        ],
        loveStyle: 'ä¸Šå¼¦ã‚¿ã‚¤ãƒ—ã®æ‹ã¯ã€"è¦‹é€šã—"ã‚’æŒã¤ã¨ã“ã‚ã‹ã‚‰å§‹ã¾ã‚Šã¾ã™ã€‚ç›¸æ‰‹ã‚’ã‚ˆãè¦³å¯Ÿã—ã€ä¾¡å€¤è¦³ã‚„ç”Ÿæ´»ãƒªã‚ºãƒ ãŒå™›ã¿åˆã†ã‹ã‚’ç¢ºèªã€‚',
        loveExamples: [
          'åˆå›ã®é£Ÿäº‹ãŒè‰¯ã„æ„Ÿè§¦ãªã‚‰ã€å¸°ã‚Šéš›ã«ã€Œæ¥é€±ã©ã“ã‹ã§ãƒ©ãƒ³ãƒã©ã†ï¼Ÿã€ã¨ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å‰æã§èª˜ã†',
          'ç›¸æ‰‹ãŒå¿™ã—ã„æ™‚æœŸã¯ã€"è² æ‹…ã‚’ä¸Šã’ãªã„æ¥ç‚¹"ã¨ã—ã¦ãƒœã‚¤ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„ã‚¹ã‚¿ãƒ³ãƒ—ã§æ§˜å­è¦‹',
          'é–¢ä¿‚ãŒé€²ã‚€ã¨ã€æ—…è¡Œãƒ»è¨˜å¿µæ—¥ãƒ»å°†æ¥ã®æš®ã‚‰ã—æ–¹ãªã©ä¸­æœŸè¨ˆç”»ã®è©±é¡Œã‚’è‡ªç„¶ã«æŒã¡è¾¼ã‚€'
        ],
        caution: 'ãƒšãƒ¼ã‚¹è¨­å®šãŒã‚„ã‚„"å‰ã®ã‚ã‚Š"ã«ãªã‚Šã‚„ã™ãã€ç›¸æ‰‹ã«ã¯ã€Œæ€¥ã‹ã•ã‚Œã¦ã„ã‚‹ã€ã¨æ„Ÿã˜ã‚‰ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚',
        actionAdvice: [
          '"ä½™ç™½ãƒ‡ãƒ¼"ã‚’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«å…ˆç½®ãï¼šæœˆã«2å›ã€ã‚ãˆã¦"ä½•ã‚‚ã—ãªã„ãƒ‡ãƒ¼ãƒˆ"ã‚’äºˆç´„',
          'ä¼šè©±ã®å†’é ­15åˆ†ã¯"å…±æ„Ÿãƒ¢ãƒ¼ãƒ‰å›ºå®š"ï¼šè§£æ±ºç­–ãƒ»ææ¡ˆã¯15åˆ†ä»¥é™',
          'ãƒ‡ãƒ¼ãƒˆã®å¹¹ã‚’ç›¸æ‰‹ã«ä¸¸æŠ•ã’ã™ã‚‹"ãŠä»»ã›å›"ã‚’å®šæœŸé–‹å‚¬'
        ]
      },
      'åä¸‰å¤œ': {
        title: 'åä¸‰å¤œã‚¿ã‚¤ãƒ—ã®ç‰©èª',
        introduction: 'ã‚ãªãŸãŒç”Ÿã¾ã‚ŒãŸå¤œã€ã»ã¼æº€ã¡ãŸæœˆâ€•â€•åä¸‰å¤œãŒã€æº€ã¡ã‚‹ç›´å‰ã®é™ã‹ãªé«˜ã¾ã‚Šã‚’æ¹›ãˆã¦ã„ã¾ã—ãŸã€‚',
        symbolism: 'åä¸‰å¤œã¯ã€Œå®Ÿã‚Šã€ã€Œå……è¶³ã€ã€Œå®‰å®šã—ãŸç™ºå±•ã€ã‚’è±¡å¾´ã—ã¾ã™ã€‚',
        traits: [
          'è½ã¡ç€ã„ãŸç‰©è…°ã¨ã€ç›¸æ‰‹ã®æ°—æŒã¡ã‚’å—ã‘æ­¢ã‚ã‚‹åŒ…å®¹åŠ›',
          'å£°ã‚’è’ã’ãšã€çŠ¶æ³ã‚’æ•´ãˆã€å ´ã®æ¸©åº¦ã‚’ã¡ã‚‡ã†ã©ã‚ˆãä¿ã¤',
          'ä»•äº‹ã§ã¯ç«æ¶ˆã—ãƒ»æ®µå–ã‚Šã®å¾®ä¿®æ­£ãƒ»é–¢ä¿‚èª¿æ•´ãŒå¾—æ„',
          'å‹äººé–“ã§ã¯"èãå½¹"ã¨ã—ã¦å®‰å¿ƒã‚’ä¾›çµ¦'
        ],
        loveStyle: 'åä¸‰å¤œã®æ‹ã¯ã€å®‰å¿ƒã®åœŸå°ã¥ãã‚Šã‹ã‚‰å§‹ã¾ã‚Šã¾ã™ã€‚é€£çµ¡ã¯é‡ã‚ˆã‚Šè³ªã€‚ä¼šã†é »åº¦ã‚‚"æŒç¶šå¯èƒ½ãªãƒšãƒ¼ã‚¹"ã‚’é‡è¦–ã€‚',
        loveExamples: [
          'é€±3ã®çŸ­ã„LINEã‚ˆã‚Šã€é€±2ã®ä¸å¯§ãªé€šè©±ã§äº’ã„ã®è¿‘æ³ã¨æ„Ÿæƒ…ã‚’å…±æœ‰',
          'å¤–é£Ÿç¶šãã‚ˆã‚Šã€è‡ªå®…ã§ä¸€ç·’ã«æ–™ç†â†’ãƒ‰ãƒ©ãƒ1è©±ã®ã»ã†ãŒæº€è¶³åº¦ãŒé«˜ã„',
          'å°†æ¥ã®è©±ã‚‚ã€Œ2å¹´ä»¥å†…ã«åŒæ£²ã€ã€ŒåŒæ–¹ã®é€šå‹¤30åˆ†åœå†…ã€ãªã©ç¾å®Ÿçš„ãªæ¡ä»¶ã§æ“¦ã‚Šåˆã‚ã›'
        ],
        caution: 'æ…é‡ã•ãŒ"å—ã‘èº«"ã«è¦‹ãˆã‚‹ã“ã¨ãŒã‚ã‚Šã€ç›¸æ‰‹ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ææ¡ˆã«ã€Œä»Šåº¦ã­ã€ã‚’é‡ã­ã‚‹ã¨ã€é–¢ä¿‚ãŒåœæ»ã—ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚',
        actionAdvice: [
          '"å°ã•ãªå¤‰åŒ–ã‚¯ã‚©ãƒ¼ã‚¿"ã‚’æœˆ2å›ï¼šæ–°ã—ã„åº—/æœªçµŒé¨“ã‚¸ãƒ£ãƒ³ãƒ«ã®æ˜ ç”»ãªã©ã€ä½ãƒªã‚¹ã‚¯ã®å†’é™ºã‚’äºˆå®šåŒ–',
          'ã‚±ã‚¢ã¨è¨€èªåŒ–ã®ä¸¡è¼ªï¼šç›¸æ‰‹ãŒè½ã¡è¾¼ã‚€æ—¥ã¯æ¸©ã‹ã„æ–™ç†ï¼‹15åˆ†ã®å‚¾è´',
          'å®‰å¿ƒã®åˆè¨€è‘‰ã‚’æ±ºã‚ã‚‹ï¼šä¾‹ã€Œç§ãŸã¡ã¯é•·è·é›¢èµ°ã€'
        ]
      },
      'æº€æœˆ': {
        title: 'æº€æœˆã‚¿ã‚¤ãƒ—ã®ç‰©èª',
        introduction: 'ã‚ãªãŸãŒç”Ÿã¾ã‚ŒãŸå¤œç©ºã«ã¯ã€ã¾ã‚“ä¸¸ã«è¼ãæº€æœˆãŒã€æš—é—‡ã‚’ä½™ã™ã“ã¨ãªãç…§ã‚‰ã—ã¦ã„ã¾ã—ãŸã€‚',
        symbolism: 'æº€æœˆã¯ã€Œå…‰ã€ã€Œé–‹æ”¾ã€ã€Œæ„Ÿæƒ…ã®è±Šã‹ã•ã€ã‚’è±¡å¾´ã—ã¾ã™ã€‚',
        traits: [
          'ã¾ã‚‹ã§ç¯å°ã®ã‚ˆã†ã«ã€äººã‚’è‡ªç„¶ã¨æƒ¹ãã¤ã‘ã‚‹',
          'æ„Ÿæƒ…è¡¨ç¾ãŒã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã§ã€å¬‰ã—ã„ã¨ãã¯å…¨èº«ã§å–œã¶',
          'æ‚²ã—ã„ã¨ãã¯æ¶™ã‚’éš ã•ãªã„æ­£ç›´ã•',
          'ä¿¡é ¼ã§ãã‚‹ã€ä¸€ç·’ã«ã„ã¦å¿ƒãŒæ¸©ã¾ã‚‹å­˜åœ¨'
        ],
        loveStyle: 'æº€æœˆã®æ‹ã¯ã€èŠ±ç«ãŒå¤œç©ºã«ä¸€æ°—ã«é–‹ãã‚ˆã†ãªã‚¹ã‚¿ãƒ¼ãƒˆã€‚å‡ºä¼šã£ãŸç¬é–“ã‹ã‚‰è·é›¢ã‚’ç¸®ã‚ã€çŸ­æœŸé–“ã§æ·±ã„çµ†ã‚’ç¯‰ãã¾ã™ã€‚',
        loveExamples: [
          'äº¤éš›åˆæœŸã‹ã‚‰ã€Œæ¯æ—¥ãŠã¯ã‚ˆã†ã¨ãŠã‚„ã™ã¿ã®LINEã€ã‚’æ¬ ã‹ã•ãªã„',
          'èª•ç”Ÿæ—¥ã‚„è¨˜å¿µæ—¥ã«ã¯å…¨åŠ›ã§ãŠç¥ã„ã—ã€ç›¸æ‰‹ã®å–œã¶é¡”ã‚’è¦‹ãŸã„ä¸€å¿ƒã§è¨ˆç”»',
          'è½ã¡è¾¼ã‚€ç›¸æ‰‹ã‚’ã€ç¬‘ã‚ã›ã‚ˆã†ã¨å†—è«‡ã‚„è¡Œå‹•ã§å…¨åŠ›ãƒ•ã‚©ãƒ­ãƒ¼'
        ],
        caution: 'æ„Ÿæƒ…ã®æ³¢ãŒå¤§ãã„ãŸã‚ã€ç†±ãŒå†·ã‚ã‚‹ã¨æ€¥ã«è·é›¢ã‚’ç½®ãå‚¾å‘ã‚‚ã€‚ç›¸æ‰‹ã‚’ä¸å®‰ã«ã•ã›ã‚„ã™ã„é¢ãŒã‚ã‚Šã¾ã™ã€‚',
        actionAdvice: [
          'æ„›ã‚’å—ã‘å–ã‚‹ç·´ç¿’ï¼šãƒ‡ãƒ¼ãƒˆè¨ˆç”»ã‚’ç›¸æ‰‹ã«ä»»ã›ã¦ã¿ã‚‹',
          'æœˆã«1ã€œ2å›ã¯ã€Œè‡ªåˆ†ã‹ã‚‰èª˜ã‚ãªã„æ—¥ã€ã‚’æ„è­˜çš„ã«ä½œã‚‹',
          'æ„Ÿæƒ…ã®ãƒ”ãƒ¼ã‚¯ã¯"ä¸€æ™©ä¿ç®¡"ãƒ«ãƒ¼ãƒ«ï¼šç¿Œæœèª­ã¿è¿”ã—ã¦ã‹ã‚‰é€ä¿¡'
        ]
      },
      'åå…­å¤œ': {
        title: 'åå…­å¤œã‚¿ã‚¤ãƒ—ã®ç‰©èª',
        introduction: 'ã‚ãªãŸãŒç”Ÿã¾ã‚ŒãŸå¤œç©ºã«æµ®ã‹ã‚“ã§ã„ãŸã®ã¯ã€æº€æœˆã®ç¿Œæ—¥ã«å°‘ã—ã ã‘æ¬ ã‘å§‹ã‚ãŸåå…­å¤œã®æœˆã€‚',
        symbolism: 'åå…­å¤œã¯ã€Œæˆç†Ÿã€ã€Œä½™è£•ã€ã€Œå¼•ãéš›ã®ç¾å­¦ã€ã‚’è±¡å¾´ã—ã¾ã™ã€‚',
        traits: [
          'ä¸€æ­©å¼•ã„ã¦å…¨ä½“ã‚’è¦‹æ¸¡ã™è¦–ç‚¹',
          'ç‰©äº‹ã‚’å††æ»‘ã«é€²ã‚ã‚‹èª¿æ•´åŠ›',
          'å¤§ããªå£°ã§ä¸»å¼µã—ãªãã¦ã‚‚å­˜åœ¨æ„ŸãŒã‚ã‚‹',
          'äººé–“é–¢ä¿‚ã®æ¸©åº¦ã‚’ä¸€å®šã«ä¿ã¤ã“ã¨ãŒã§ãã‚‹'
        ],
        loveStyle: 'åå…­å¤œã®æ‹ã¯ã€é™ã‹ã§å®‰å®šçš„ãªç‚ã€‚ç›¸æ‰‹ã‚’ã‚ˆãè¦³å¯Ÿã—ã€éå‰°ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚„æŠ¼ã—ã™ãã¯ã—ã¾ã›ã‚“ã€‚',
        loveExamples: [
          'ä¼šã„ãŸã„æ°—æŒã¡ãŒã‚ã£ã¦ã‚‚ã€ç›¸æ‰‹ã®ç–²ã‚Œã‚„äºˆå®šã‚’å„ªå…ˆã—ã¦é€£çµ¡ã‚’æ§ãˆã‚‹',
          'è¨˜å¿µæ—¥ã‚„ã‚µãƒ—ãƒ©ã‚¤ã‚ºã‚ˆã‚Šã‚‚ã€æ—¥å¸¸ã®ä¸­ã§ç›¸æ‰‹ãŒå–œã¶è¡Œå‹•ã‚’é¸ã¶',
          'å–§å˜©ã«ãªã‚Šãã†ãªæ™‚ã¯æ²ˆé»™ã‚’é¸ã³ã€æ™‚é–“ã‚’ãŠã„ã¦å†·é™ãªè©±ã—åˆã„ã«æŒã¡è¾¼ã‚€'
        ],
        caution: 'ã‚ã¾ã‚Šã«è½ã¡ç€ãã™ãã¦ã€Œæœ¬å½“ã«å¥½ããªã®ã‹ãªï¼Ÿã€ã¨æ€ã‚ã‚ŒãŸã‚Šã€æƒ…ç†±ãŒè¦‹ãˆã«ãããªã‚‹ã“ã¨ã‚‚ã€‚',
        actionAdvice: [
          '"åŠæ­©å‰é€²ãƒ‡ãƒ¼"ã‚’è¨­å®šï¼šæœˆã«1å›ã¯ã€è‡ªåˆ†ã‹ã‚‰ãƒ‡ãƒ¼ãƒˆã‚„æ—…è¡Œã®ææ¡ˆã‚’ã™ã‚‹',
          'æ„Ÿæƒ…ã‚’"è¦‹ãˆã‚‹å½¢"ã§æ¸¡ã™ç¿’æ…£ï¼šæ‰‹ç´™ãƒ»çŸ­ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§æ™®æ®µè¨€ã‚ãªã„æ°—æŒã¡ã‚’å¯è¦–åŒ–',
          '"æ€ã„å‡ºãƒˆãƒªã‚¬ãƒ¼"ã‚’æ´»ç”¨ï¼šéå»ã®æ¥½ã—ã‹ã£ãŸãƒ‡ãƒ¼ãƒˆã‚’æ™‚ã€…å¼•ã£å¼µã‚Šå‡ºã—ã¦å…±æœ‰'
        ]
      },
      'ä¸‹å¼¦ã®æœˆ': {
        title: 'ä¸‹å¼¦ã®æœˆã‚¿ã‚¤ãƒ—ã®ç‰©èª',
        introduction: 'ã‚ãªãŸãŒç”Ÿã¾ã‚ŒãŸå¤œç©ºã«ã¯ã€å·¦åŠåˆ†ãŒãã£ãã‚Šã¨å…‰ã‚‹ä¸‹å¼¦ã®æœˆã€‚',
        symbolism: 'ä¸‹å¼¦ã¯ã€Œæ•´ç†ã€ã€ŒåæŸã€ã€Œå®‰å®šåŒ–ã€ã‚’è±¡å¾´ã—ã¾ã™ã€‚',
        traits: [
          'æƒ…å ±ãƒ»æ„Ÿæƒ…ãƒ»å‡ºæ¥äº‹ã‚’å†·é™ã«æ•´ç†ã™ã‚‹åŠ›',
          'ç‰©äº‹ã‚’å¼•ãç®—ã§æ•´ãˆã‚‹',
          'æµè¡Œã‚„æ„Ÿæƒ…ã«å·¦å³ã•ã‚Œãšã€è‡ªåˆ†ã®è»¸ã‚’æŒã¤',
          'ä»–äººã®æ„Ÿæƒ…ã‚’å—ã‘æ­¢ã‚ã¤ã¤ã‚‚ã€é£²ã¿è¾¼ã¾ã‚Œãªã„è·é›¢æ„Ÿ'
        ],
        loveStyle: 'ä¸‹å¼¦ã®æ‹ã¯ã€ã˜ã£ãã‚Šç†Ÿæˆå‹ã€‚æ€¥é€Ÿãªè·é›¢ã®è©°ã‚æ–¹ã‚ˆã‚Šã‚‚ã€ãŠäº’ã„ã®ä¿¡é ¼ã‚’ç©ã¿ä¸Šã’ã¦ã‹ã‚‰æ·±ã¾ã‚Šã¾ã™ã€‚',
        loveExamples: [
          'é€£çµ¡ã¯é©åº¦ã€ç›¸æ‰‹ã®ç”Ÿæ´»ãƒªã‚ºãƒ ã‚’å°Šé‡ã—ã¦è¿”ã™',
          'ç›¸æ‰‹ãŒè½ã¡è¾¼ã‚“ã§ã„ã¦ã‚‚ã€å¿…è¦ä»¥ä¸Šã«è¸ã¿è¾¼ã¾ãšã€ãã°ã«ã„ã‚‹å®‰å¿ƒæ„Ÿã‚’ä¸ãˆã‚‹',
          'äº¤éš›ãŒå®‰å®šæœŸã«å…¥ã‚‹ã¨ã€ä¼šã†é »åº¦ã‚„éã”ã—æ–¹ã‚‚å¿ƒåœ°ã‚ˆã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å®šç€'
        ],
        caution: 'å¤‰åŒ–ã‚’æ±‚ã‚ã‚‰ã‚ŒãŸã‚Šã€å¼·ã„æ„Ÿæƒ…è¡¨ç¾ã‚’å—ã‘ã‚‹ã¨ã€Œè‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã‚’ä¹±ã•ã‚Œã‚‹ã€ã¨æ„Ÿã˜ã‚„ã™ã„å‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚',
        actionAdvice: [
          '"å¤‰åŒ–ä½“é¨“"ã‚’æœˆ1å›ã ã‘å…¥ã‚Œã‚‹ï¼šæ™®æ®µã®å®‰å®šãƒ‡ãƒ¼ãƒˆã«åŠ ãˆã€æ–°ã—ã„å ´æ‰€ã‚„ä½“é¨“ã‚’è©¦ã™',
          'æ„Ÿæƒ…ã‚’"äº‹å®Ÿã®å‰"ã«è©±ã™ï¼šææ¡ˆã‚„æ•´ç†ã‚ˆã‚Šã‚‚å…ˆã«æ„Ÿæƒ…ã‚’ä¸€è¨€æ·»ãˆã‚‹',
          '"äºˆå®šãªã—æ™‚é–“"ã‚’ä¸€ç·’ã«éã”ã™è¨“ç·´ï¼šã‚´ãƒ¼ãƒ«ã®ãªã„ãƒ‡ãƒ¼ãƒˆã‚’æœˆã«1å›'
        ]
      },
      'æš': {
        title: 'æšã‚¿ã‚¤ãƒ—ã®ç‰©èª',
        introduction: 'ã‚ãªãŸãŒç”Ÿã¾ã‚ŒãŸå¤œç©ºã¯ã€æœˆãŒæ²ˆã¿ã€å¤œæ˜ã‘å‰ã®é™ã‘ã•ãŒä¸–ç•Œã‚’åŒ…ã‚“ã§ã„ã¾ã—ãŸã€‚',
        symbolism: 'æšã¯ã€Œçµ‚ã‚ã‚Šã¨å§‹ã¾ã‚Šã®å¢ƒç›®ã€ã€Œé™ã‹ãªå†…çœã€ã€Œæ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸ã®æº–å‚™ã€ã‚’è±¡å¾´ã—ã¾ã™ã€‚',
        traits: [
          'æ·±ãè€ƒãˆã‚‹åŠ›ã¨ã€ç‰©äº‹ã‚’é™ã‹ã«æ•´ãˆã¦ã„ãåŠ›',
          'æ„Ÿæƒ…ã‚’å¤–ã«æ¿€ã—ãå‡ºã™ã‚ˆã‚Šã€ã¾ãšå†…å´ã§æ•´ç†',
          'ã˜ã£ãã‚Šè€ƒãˆã¦ã‹ã‚‰è¡Œå‹•ã™ã‚‹',
          'æœ¬å½“ã«å¤§åˆ‡ã ã¨æ€ãˆã‚‹ç›¸æ‰‹ã‚„ã“ã¨ã ã‘ã‚’é¸ã³æŠœã'
        ],
        loveStyle: 'æšã®æ‹ã¯ã€é™ã‹ã«æ·±ã¾ã‚‹æ°´è„ˆã®ã‚ˆã†ã€‚ä¸€æ°—ã«ç‡ƒãˆä¸ŠãŒã‚‹ã‚ˆã‚Šã‚‚ã€å°‘ã—ãšã¤å¿ƒã‚’è¨±ã—ã€æ™‚é–“ã‚’ã‹ã‘ã¦çµ†ã‚’å¼·ãã—ã¦ã„ãã¾ã™ã€‚',
        loveExamples: [
          'é€£çµ¡é »åº¦ã¯å°‘ãªã‚ã§ã‚‚ã€ä¼šã£ãŸã¨ãã®æ™‚é–“å¯†åº¦ã¯æ¿ƒã„',
          'ç›¸æ‰‹ã®æ„Ÿæƒ…ã«ã™ãåå¿œã›ãšã€ã¾ãšã¯èã„ã¦å—ã‘æ­¢ã‚ã¦ã‹ã‚‰è¿”ã™',
          'ãƒ‡ãƒ¼ãƒˆã¯è½ã¡ç€ã„ãŸå ´æ‰€ã‚„äºŒäººãã‚Šã«ãªã‚Œã‚‹ç©ºé–“ã‚’å¥½ã‚€'
        ],
        caution: 'ãƒ†ãƒ³ãƒã®é€Ÿã„æ‹æ„›ã‚„ã€æ„Ÿæƒ…è¡¨ç¾ã®æ¿€ã—ã„ç›¸æ‰‹ã¨ã¯ã€ãƒšãƒ¼ã‚¹ã®é•ã„ã§ç–²ã‚Œã‚„ã™ã„å‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚',
        actionAdvice: [
          '"åŠæ­©å…ˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³"ã‚’ç¿’æ…£åŒ–ï¼šè‡ªåˆ†ã‹ã‚‰ã‚‚è»½ã„ææ¡ˆã‚’æœˆ2å›ã™ã‚‹',
          'æ„Ÿæƒ…ã®"äº‹å‰ã‚·ã‚°ãƒŠãƒ«"ã‚’å‡ºã™ï¼šè€ƒãˆã‚‹æ™‚é–“ãŒå¿…è¦ãªã¨ãã¯ä¸€è¨€æ·»ãˆã‚‹',
          'æœˆ1å›"ã‚ªãƒ¼ãƒ—ãƒ³ãƒ‡ãƒ¼"ã‚’è¨­å®šï¼šãã®æ—¥ã¯æ„è­˜çš„ã«è‡ªåˆ†ã®æ°—æŒã¡ã‚’å¤šã‚ã«è©±ã™'
        ]
      }
    };

    // ç›¸æ€§ã®è©³ç´°èª¬æ˜
    this.compatibilityDetails = {
      95: {
        level: 'â— ã¨ã¦ã‚‚ç›¸æ€§ãŒè‰¯ã„',
        description: 'æœˆãŒå‘Šã’ã¦ã„ã¾ã™ã€‚ãŠäºŒäººã®æ³¢é•·ã¯å®Œç’§ã«èª¿å’Œã—ã€äº’ã„ã®é­…åŠ›ã‚’æœ€å¤§é™ã«å¼•ãå‡ºã™é–¢ä¿‚ã§ã™ã€‚'
      },
      75: {
        level: 'â—‹ ç›¸æ€§ãŒè‰¯ã„',
        description: 'æœˆãŒå°ã„ã¦ã„ã¾ã™ã€‚ãŠäº’ã„ã‚’æˆé•·ã•ã›ã‚‹è‰¯ã„é–¢ä¿‚ã€‚æ™‚ã«é•ã„ã‚’æ„Ÿã˜ã¦ã‚‚ã€ãã‚ŒãŒæ–°é®®ãªåˆºæ¿€ã¨ãªã‚Šã¾ã™ã€‚'
      },
      55: {
        level: 'â–³ æ™®é€š',
        description: 'æœˆãŒç¤ºã—ã¦ã„ã¾ã™ã€‚ç•°ãªã‚‹å€‹æ€§ãŒå‡ºä¼šã†ã“ã¨ã§ã€æ–°ã—ã„å¯èƒ½æ€§ãŒç”Ÿã¾ã‚Œã¾ã™ã€‚ç†è§£ã¨å°Šé‡ãŒé–¢ä¿‚ã‚’æ·±ã‚ã‚‹éµã¨ãªã‚‹ã§ã—ã‚‡ã†ã€‚'
      }
    };
  }

  // æœˆé½¢ã‚’è¨ˆç®—ï¼ˆç°¡æ˜“ç‰ˆï¼‰
  calculateMoonAge(date) {
    const year = date.getFullYear();
    const month = date.getMonth() + 1;
    const day = date.getDate();
    
    // ç°¡æ˜“çš„ãªæœˆé½¢è¨ˆç®—
    let moonAge = ((year - 2000) * 12.368 + month * 29.53 + day) % 29.53;
    
    return Math.round(moonAge * 10) / 10;
  }

  // æœˆé½¢ã‹ã‚‰æœˆã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š
  getMoonTypeFromAge(moonAge) {
    for (const phase of this.moonPhaseRanges) {
      if (moonAge >= phase.range[0] && moonAge < phase.range[1]) {
        return {
          type: phase.type,
          emoji: phase.emoji
        };
      }
    }
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
    return {
      type: 'æ–°æœˆ',
      emoji: 'ğŸŒ‘'
    };
  }

  // ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰æœˆã‚¿ã‚¤ãƒ—ã‚’å–å¾—
  getMoonTypeFromBirthdate(birthdate) {
    const date = new Date(birthdate);
    const moonAge = this.calculateMoonAge(date);
    return this.getMoonTypeFromAge(moonAge);
  }

  // ç›¸æ€§ã‚¹ã‚³ã‚¢ã‚’å–å¾—
  getCompatibilityScore(type1, type2) {
    return this.compatibilityMatrix[type1]?.[type2] || 55;
  }

  // ç›¸æ€§ã®è©³ç´°æƒ…å ±ã‚’ç”Ÿæˆ
  getCompatibilityDetails(userType, partnerType) {
    const score = this.getCompatibilityScore(userType, partnerType);
    const baseDetails = this.compatibilityDetails[score] || this.compatibilityDetails[55];
    
    // aisyo.mdã‹ã‚‰ã®å…·ä½“çš„ãªç›¸æ€§èª¬æ˜ã‚’è¿½åŠ 
    const specificDetails = this.getSpecificCompatibilityAdvice(userType, partnerType);
    
    return {
      score,
      ...baseDetails,
      specific: specificDetails
    };
  }

  // ç‰¹å®šã®çµ„ã¿åˆã‚ã›ã«å¯¾ã™ã‚‹è©³ç´°ã‚¢ãƒ‰ãƒã‚¤ã‚¹
  getSpecificCompatibilityAdvice(userType, partnerType) {
    // aisyo.mdã®ç›¸æ€§èª¬æ˜ã‹ã‚‰ä¸»è¦ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè£…
    const key = `${userType}-${partnerType}`;
    
    const adviceMap = {
      'æ–°æœˆ-æ–°æœˆ': {
        reason: 'åŒã˜ã‚¹ãƒ”ãƒ¼ãƒ‰æ„Ÿã¨ç†±é‡ã§èµ°ã‚Œã‚‹åŒå¿—',
        example: 'é‡‘æ›œå¤œã«ã€Œæ˜æ—¥æ¸©æ³‰è¡Œã‹ãªã„ï¼Ÿã€ã¨ç‰‡æ–¹ãŒè¨€ãˆã°ã€ã™ãã«è·é€ ã‚Šã—ã¦GO',
        advice: 'äº’ã„ã«åˆºæ¿€ã‚’ä¸ãˆåˆã„ã€æ¯æ—¥ãŒã‚¤ãƒ™ãƒ³ãƒˆã®ã‚ˆã†ã«éã”ã›ã¾ã™'
      },
      'æ–°æœˆ-æº€æœˆ': {
        reason: 'æº€æœˆã®æ¸©ã‹ã•ã¨æ„Ÿæƒ…è¡¨ç¾ãŒã€æ–°æœˆã®è¡å‹•ã‚’è‚¯å®šã—å®‰å¿ƒã«å¤‰ãˆã‚‹',
        example: 'æ–°æœˆãŒçªç„¶è½ã¡è¾¼ã‚“ã§ã‚‚ã€æº€æœˆãŒå…¨åŠ›ã§åŠ±ã¾ã—ã€ç¿Œæ—¥ã«ã¯ä¸€ç·’ã«ç¬‘ã£ã¦ã„ã‚‹',
        advice: 'äºŒäººã®æƒ…ç†±ãŒå…±é³´ã—ã€é–¢ä¿‚ãŒã‚ˆã‚Šæ·±ã¾ã‚Šã¾ã™'
      },
      'ä¸‰æ—¥æœˆ-ä¸Šå¼¦ã®æœˆ': {
        reason: 'ä¸Šå¼¦ã®è¡Œå‹•åŠ›ãŒä¸‰æ—¥æœˆã®æ…é‡ã•ã‚’è‰¯ã„æ–¹å‘ã«å¼•ãä¸Šã’ã‚‹',
        example: 'ä¸Šå¼¦ãŒè¨ˆç”»ã‚’ç«‹ã¦ã€ä¸‰æ—¥æœˆãŒã€Œãã‚Œãªã‚‰å®‰å¿ƒã€ã¨ä¹—ã‚‹ãƒ‡ãƒ¼ãƒˆ',
        advice: 'ä¸‰æ—¥æœˆã¯å®‰å¿ƒã—ã¦ä¸€æ­©è¸ã¿å‡ºã›ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™'
      },
      'åä¸‰å¤œ-æš': {
        reason: 'æšã®å†…çœã¨æ·±ã„å¯¾è©±ãŒã€åä¸‰å¤œã®å®‰å¿ƒåŸºç›¤ã«ã´ãŸã‚Š',
        example: 'é€±æœ«ã¯å„è‡ªã®è¶£å‘³â†’å¤œã«1æ™‚é–“ã®æ·±ã„ãŠã—ã‚ƒã¹ã‚Š',
        advice: 'é™ã‘ã•Ã—æ»‹é¤Šã§å¿ƒãŒæº€ã¡ã‚‹é–¢ä¿‚'
      },
      // ... ä»–ã®çµ„ã¿åˆã‚ã›ã‚‚è¿½åŠ 
    };
    
    return adviceMap[key] || {
      reason: 'ãŠäº’ã„ã®å€‹æ€§ãŒèª¿å’Œã™ã‚‹é–¢ä¿‚',
      example: 'ãã‚Œãã‚Œã®é­…åŠ›ã‚’æ´»ã‹ã—ãªãŒã‚‰æˆé•·ã§ãã¾ã™',
      advice: 'é•ã„ã‚’èªã‚åˆã†ã“ã¨ã§ã€ã‚ˆã‚Šæ·±ã„çµ†ãŒç”Ÿã¾ã‚Œã‚‹ã§ã—ã‚‡ã†'
    };
  }

  // ä»Šæœˆã®æ‹æ„›é‹ã‚’ç”Ÿæˆ
  generateMonthlyFortune(userType, currentDate = new Date()) {
    const currentMoonAge = this.calculateMoonAge(currentDate);
    const currentMoonType = this.getMoonTypeFromAge(currentMoonAge);
    
    // ç¾åœ¨ã®æœˆç›¸ã¨èª•ç”Ÿæœˆç›¸ã®é–¢ä¿‚ã‹ã‚‰é‹å‹¢ã‚’æ±ºå®š
    const compatibility = this.getCompatibilityScore(userType, currentMoonType.type);
    
    return {
      currentMoon: {
        type: currentMoonType.type,
        emoji: currentMoonType.emoji
      },
      compatibility,
      fortune: this.getMonthlyFortuneMessage(userType, currentMoonType.type, compatibility),
      luckyDays: this.calculateLuckyDays(userType, currentDate),
      actionAdvice: this.getMonthlyActionAdvice(userType, currentDate)
    };
  }

  // æœˆé–“é‹å‹¢ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  getMonthlyFortuneMessage(userType, currentType, compatibility) {
    const userDetails = this.moonTypeDetails[userType];
    const month = new Date().getMonth() + 1;
    
    if (compatibility >= 85) {
      return {
        level: 'çµ¶å¥½èª¿',
        message: `${month}æœˆã®${currentType}ã¯ã€${userType}ã‚¿ã‚¤ãƒ—ã®ã‚ãªãŸã«æœ€é«˜ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æ³¨ãã¾ã™ã€‚${userDetails.traits[0]}ã¨ã„ã†ç‰¹æ€§ãŒæœ€å¤§é™ã«ç™ºæ®ã•ã‚Œã‚‹æ™‚ã€‚`,
        advice: userDetails.actionAdvice[0]
      };
    } else if (compatibility >= 65) {
      return {
        level: 'å¥½èª¿',
        message: `${month}æœˆã¯å®‰å®šã—ãŸé‹æ°—ã€‚${userType}ã‚¿ã‚¤ãƒ—ã®æŒã¤${userDetails.traits[1]}ã‚’æ´»ã‹ã™ãƒãƒ£ãƒ³ã‚¹ãŒè¨ªã‚Œã¾ã™ã€‚`,
        advice: userDetails.actionAdvice[1]
      };
    } else {
      return {
        level: 'å……é›»æœŸ',
        message: `${month}æœˆã¯å†…é¢ã‚’è¦‹ã¤ã‚ã‚‹æ™‚æœŸã€‚${userType}ã‚¿ã‚¤ãƒ—ã®${userDetails.caution.substring(0, 30)}...ã«æ³¨æ„ã—ã¦éã”ã—ã¾ã—ã‚‡ã†ã€‚`,
        advice: userDetails.actionAdvice[2]
      };
    }
  }

  // ãƒ©ãƒƒã‚­ãƒ¼ãƒ‡ãƒ¼ã‚’è¨ˆç®—ï¼ˆã‚ˆã‚Šè©³ç´°ã«ï¼‰
  calculateLuckyDays(userType, currentDate) {
    const luckyDays = [];
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    
    for (let day = 1; day <= 31; day++) {
      const date = new Date(year, month, day);
      if (date.getMonth() !== month) break;
      
      const moonAge = this.calculateMoonAge(date);
      const dayType = this.getMoonTypeFromAge(moonAge);
      const compatibility = this.getCompatibilityScore(userType, dayType.type);
      
      if (compatibility >= 85) {
        luckyDays.push({
          date: day,
          moonType: dayType.type,
          emoji: dayType.emoji,
          advice: this.getLuckyDayAdvice(userType, dayType.type)
        });
      }
    }
    
    return luckyDays.slice(0, 3);
  }

  // ãƒ©ãƒƒã‚­ãƒ¼ãƒ‡ãƒ¼ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹
  getLuckyDayAdvice(userType, dayMoonType) {
    const compatibility = this.getCompatibilityScore(userType, dayMoonType);
    
    if (compatibility >= 95) {
      return 'æœ€é«˜ã®æ³¢å‹•ãŒè¨ªã‚Œã‚‹æ—¥ã€‚å¤§åˆ‡ãªå‘Šç™½ã‚„æ±ºæ–­ã«æœ€é©ã€‚';
    } else if (compatibility >= 85) {
      return 'è‰¯ã„æµã‚ŒãŒæœŸå¾…ã§ãã‚‹æ—¥ã€‚ç©æ¥µçš„ãªè¡Œå‹•ãŒå‰ã€‚';
    } else {
      return 'ç©ã‚„ã‹ã«éã”ã™ã®ãŒè‰¯ã„æ—¥ã€‚';
    }
  }

  // æœˆã”ã¨ã®è¡Œå‹•ã‚¢ãƒ‰ãƒã‚¤ã‚¹
  getMonthlyActionAdvice(userType, currentDate) {
    const month = currentDate.getMonth() + 1;
    const userDetails = this.moonTypeDetails[userType];
    
    // æœˆã¨æœˆã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸå…·ä½“çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹
    const seasonalAdvice = {
      1: 'æ–°å¹´ã®å§‹ã¾ã‚Šã€‚æ–°ã—ã„é–¢ä¿‚æ€§ã‚’ç¯‰ããƒãƒ£ãƒ³ã‚¹ã€‚',
      2: 'ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³æœˆã€‚ç´ ç›´ãªæ°—æŒã¡ã‚’ä¼ãˆã‚‹æ™‚æœŸã€‚',
      3: 'æ˜¥ã®è¨ªã‚Œã€‚å¤‰åŒ–ã‚’å—ã‘å…¥ã‚Œã‚‹æº–å‚™ã‚’ã€‚',
      4: 'æ–°ã—ã„å‡ºä¼šã„ã®å­£ç¯€ã€‚ç©æ¥µçš„ã«è¡Œå‹•ã‚’ã€‚',
      5: 'å®‰å®šæœŸã€‚é–¢ä¿‚ã‚’æ·±ã‚ã‚‹è‰¯ã„æ™‚æœŸã€‚',
      6: 'æ¢…é›¨ã®æ™‚æœŸã€‚å®¤å†…ãƒ‡ãƒ¼ãƒˆã§è¦ªå¯†åº¦UPã€‚',
      7: 'å¤ã®æƒ…ç†±ã€‚æ„Ÿæƒ…ã‚’ç´ ç›´ã«è¡¨ç¾ã—ã¦ã€‚',
      8: 'çœŸå¤ã®æ‹ã€‚æ€ã„å‡ºä½œã‚Šã«æœ€é©ã€‚',
      9: 'ç§‹ã®å§‹ã¾ã‚Šã€‚è½ã¡ç€ã„ãŸé–¢ä¿‚æ§‹ç¯‰ã‚’ã€‚',
      10: 'å®Ÿã‚Šã®ç§‹ã€‚é–¢ä¿‚ã®æˆæœãŒè¦‹ãˆã‚‹æ™‚ã€‚',
      11: 'æ·±ã¾ã‚‹ç§‹ã€‚å†…é¢çš„ãªç¹‹ãŒã‚Šã‚’å¤§åˆ‡ã«ã€‚',
      12: 'å¹´æœ«ã®æŒ¯ã‚Šè¿”ã‚Šã€‚æ¥å¹´ã¸ã®æº–å‚™æœŸé–“ã€‚'
    };
    
    return {
      seasonal: seasonalAdvice[month],
      personal: userDetails.actionAdvice.slice(0, 2)
    };
  }

  // ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚ŒãŸè¨ºæ–­çµæœã‚’ç”Ÿæˆ
  generateCompleteReading(userBirthdate, partnerBirthdate = null) {
    const userMoonType = this.getMoonTypeFromBirthdate(userBirthdate);
    const userDetails = this.moonTypeDetails[userMoonType.type];
    
    const result = {
      user: {
        moonType: userMoonType.type,
        emoji: userMoonType.emoji,
        story: {
          title: userDetails.title,
          introduction: userDetails.introduction,
          symbolism: userDetails.symbolism,
          traits: userDetails.traits,
          loveStyle: userDetails.loveStyle,
          examples: userDetails.loveExamples,
          caution: userDetails.caution,
          advice: userDetails.actionAdvice
        }
      },
      monthlyFortune: this.generateMonthlyFortune(userMoonType.type)
    };
    
    if (partnerBirthdate) {
      const partnerMoonType = this.getMoonTypeFromBirthdate(partnerBirthdate);
      const partnerDetails = this.moonTypeDetails[partnerMoonType.type];
      
      result.partner = {
        moonType: partnerMoonType.type,
        emoji: partnerMoonType.emoji,
        story: {
          title: partnerDetails.title,
          introduction: partnerDetails.introduction,
          traits: partnerDetails.traits.slice(0, 3),
          loveStyle: partnerDetails.loveStyle
        }
      };
      
      result.compatibility = this.getCompatibilityDetails(
        userMoonType.type,
        partnerMoonType.type
      );
    }
    
    return result;
  }
}

module.exports = MoonFortuneEngineV2;