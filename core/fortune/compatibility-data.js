/**
 * 月相タイプ別の相性データ
 * 01_aisyo_rank.mdから転記
 */

// 月のタイプ名のマッピング
const moonTypeMapping = {
  '新月': '新月',
  '新月タイプ': '新月',
  '三日月': '三日月',
  '三日月タイプ': '三日月',
  '上弦の月': '上弦の月',
  '上弦の月タイプ': '上弦の月',
  '十三夜': '十三夜',
  '十三夜タイプ': '十三夜',
  '満月': '満月',
  '満月タイプ': '満月',
  '十六夜': '十六夜',
  '十六夜タイプ': '十六夜',
  '下弦の月': '下弦の月',
  '下弦の月タイプ': '下弦の月',
  '暁': '暁',
  '暁タイプ': '暁',
  '逆三日月': '暁',
  '逆三日月タイプ': '暁',
  'newMoon': '新月',
  'waxingCrescent': '三日月',
  'firstQuarter': '上弦の月',
  'waxingGibbous': '十三夜',
  'fullMoon': '満月',
  'waningGibbous': '十六夜',
  'lastQuarter': '下弦の月',
  'waningCrescent': '暁'
};

const compatibilityRankings = {
  // 1位　新月 × 満月（100点）
  '新月-満月': {
    score: 100,
    rank: 1,
    reason: '直感で動く新月と、感情を豊かに表現する満月。行動と表現の役割が自然に分かれ、お互いを引き立てる。',
    relationship: '新月が思いついたことを行動に移し、満月がそれを広げて人を惹きつける。二人が組むと周囲を巻き込む力になる。',
    advice: {
      '新月': '満月の表現力を信じて、安心して行動に移すこと。',
      '満月': '新月の直感を尊重し、言葉で後押ししてあげること。'
    }
  },
  '満月-新月': {
    score: 100,
    rank: 1,
    reason: '直感で動く新月と、感情を豊かに表現する満月。行動と表現の役割が自然に分かれ、お互いを引き立てる。',
    relationship: '新月が思いついたことを行動に移し、満月がそれを広げて人を惹きつける。二人が組むと周囲を巻き込む力になる。',
    advice: {
      '満月': '新月の直感を尊重し、言葉で後押ししてあげること。',
      '新月': '満月の表現力を信じて、安心して行動に移すこと。'
    }
  },

  // 2位　上弦の月 × 下弦の月（100点）
  '上弦の月-下弦の月': {
    score: 100,
    rank: 2,
    reason: '前進力ある上弦と、冷静に整理する下弦。攻めと守りのバランスが絶妙。',
    relationship: '上弦が提案し、下弦が無駄を省いて形を整える。夢と現実の両立ができる。',
    advice: {
      '上弦の月': '下弦の慎重さを「制約」ではなく「支え」として受け止めること。',
      '下弦の月': '上弦の勢いを止めず、方向性を整える意識を持つこと。'
    }
  },
  '下弦の月-上弦の月': {
    score: 100,
    rank: 2,
    reason: '前進力ある上弦と、冷静に整理する下弦。攻めと守りのバランスが絶妙。',
    relationship: '上弦が提案し、下弦が無駄を省いて形を整える。夢と現実の両立ができる。',
    advice: {
      '下弦の月': '上弦の勢いを止めず、方向性を整える意識を持つこと。',
      '上弦の月': '下弦の慎重さを「制約」ではなく「支え」として受け止めること。'
    }
  },

  // 3位　十六夜 × 三日月（99点）
  '十六夜-三日月': {
    score: 99,
    rank: 3,
    reason: '余裕ある十六夜が、協調的な三日月を包み込む。安心と行動のバランスが良い。',
    relationship: '十六夜が三日月の遠慮を優しくほどき、気持ちを聴いてくれる。三日月は「この人なら大丈夫」と安心して本音を言える。',
    advice: {
      '十六夜': '三日月に対しては少し積極的に意見を示し、リード役になる意識を。',
      '三日月': '「必ず受け止めてもらえる」と信じて、遠慮せずに本音を伝えること。'
    }
  },
  '三日月-十六夜': {
    score: 99,
    rank: 3,
    reason: '余裕ある十六夜が、協調的な三日月を包み込む。安心と行動のバランスが良い。',
    relationship: '十六夜が三日月の遠慮を優しくほどき、気持ちを聴いてくれる。三日月は「この人なら大丈夫」と安心して本音を言える。',
    advice: {
      '三日月': '「必ず受け止めてもらえる」と信じて、遠慮せずに本音を伝えること。',
      '十六夜': '三日月に対しては少し積極的に意見を示し、リード役になる意識を。'
    }
  },

  // 4位　十三夜 × 暁（99点）
  '十三夜-暁': {
    score: 99,
    rank: 4,
    reason: '落ち着きある十三夜と内省的な暁。言葉少なくても分かり合える深い結びつき。',
    relationship: '沈黙でも安心感がある関係。互いに無理せず心を寄せ合える。',
    advice: {
      '十三夜': '暁の内面世界を尊重し、急かさず待つこと。',
      '暁': '十三夜に対して「受け止めてもらえる」と信じて、安心して心を開くこと。'
    }
  },
  '暁-十三夜': {
    score: 99,
    rank: 4,
    reason: '落ち着きある十三夜と内省的な暁。言葉少なくても分かり合える深い結びつき。',
    relationship: '沈黙でも安心感がある関係。互いに無理せず心を寄せ合える。',
    advice: {
      '暁': '十三夜に対して「受け止めてもらえる」と信じて、安心して心を開くこと。',
      '十三夜': '暁の内面世界を尊重し、急かさず待つこと。'
    }
  },

  // 5位　満月 × 十六夜（98点）
  '満月-十六夜': {
    score: 98,
    rank: 5,
    reason: '感情を全力で表す満月を、余裕ある十六夜が静かに受け止める。華やかさと落ち着きの黄金バランス。',
    relationship: '満月が場を盛り上げ、十六夜が安心感を与える。表舞台と陰の支えの関係。',
    advice: {
      '満月': '十六夜に感情を預け、「支えられること」を素直に受け入れること。',
      '十六夜': '満月の輝きを尊重しつつ、自分が陰で支える役目を意識すること。'
    }
  },
  '十六夜-満月': {
    score: 98,
    rank: 5,
    reason: '感情を全力で表す満月を、余裕ある十六夜が静かに受け止める。華やかさと落ち着きの黄金バランス。',
    relationship: '満月が場を盛り上げ、十六夜が安心感を与える。表舞台と陰の支えの関係。',
    advice: {
      '十六夜': '満月の輝きを尊重しつつ、自分が陰で支える役目を意識すること。',
      '満月': '十六夜に感情を預け、「支えられること」を素直に受け入れること。'
    }
  },

  // 6位　新月 × 十三夜（97点）
  '新月-十三夜': {
    score: 97,
    rank: 6,
    reason: '新月の勢いを、十三夜の包容力がやさしく受け止める。変化と安定のバランスが取れる組み合わせ。',
    relationship: '新月が挑戦を仕掛け、十三夜がその流れを無理なく整える。勢いと調和が自然にかみ合う関係。',
    advice: {
      '新月': '十三夜に頼っても大丈夫と信じ、焦らず行動すること。',
      '十三夜': '新月の勢いを抑え込まず、流れを活かす姿勢を持つこと。'
    }
  },
  '十三夜-新月': {
    score: 97,
    rank: 6,
    reason: '新月の勢いを、十三夜の包容力がやさしく受け止める。変化と安定のバランスが取れる組み合わせ。',
    relationship: '新月が挑戦を仕掛け、十三夜がその流れを無理なく整える。勢いと調和が自然にかみ合う関係。',
    advice: {
      '十三夜': '新月の勢いを抑え込まず、流れを活かす姿勢を持つこと。',
      '新月': '十三夜に頼っても大丈夫と信じ、焦らず行動すること。'
    }
  },

  // 7位　満月 × 下弦の月（96点）
  '満月-下弦の月': {
    score: 96,
    rank: 7,
    reason: '満月の感情の強さを、下弦の冷静さが整理し調和を生む。華やかさと落ち着きの絶妙な融合。',
    relationship: '満月が感情をストレートに出し、下弦が現実的に整理して形にしていく。熱と冷静さが交互に作用する関係。',
    advice: {
      '満月': '下弦の冷静さを「否定ではない」と理解すること。',
      '下弦の月': '満月の情熱を潰さず、方向づけて力に変えること。'
    }
  },
  '下弦の月-満月': {
    score: 96,
    rank: 7,
    reason: '満月の感情の強さを、下弦の冷静さが整理し調和を生む。華やかさと落ち着きの絶妙な融合。',
    relationship: '満月が感情をストレートに出し、下弦が現実的に整理して形にしていく。熱と冷静さが交互に作用する関係。',
    advice: {
      '下弦の月': '満月の情熱を潰さず、方向づけて力に変えること。',
      '満月': '下弦の冷静さを「否定ではない」と理解すること。'
    }
  },

  // 8位　暁 × 暁（95点）
  '暁-暁': {
    score: 95,
    rank: 8,
    reason: '内省的で思慮深い暁同士。静かながら深い信頼を築けるペア。',
    relationship: '多くを語らずとも心が通じ合い、秘密を分かち合える特別な存在。',
    advice: {
      '暁': '相手が同じ暁でも、心を閉じすぎず小さな感情を共有すること。'
    }
  },

  // 9位　三日月 × 三日月（94点）
  '三日月-三日月': {
    score: 94,
    rank: 9,
    reason: '協調性豊かな三日月同士。穏やかで安心できる関係を築ける。',
    relationship: '互いに譲り合いすぎることで、少し遠慮がちになるが、基本は平和で心地よい関係。',
    advice: {
      '三日月': '相手に気を遣いすぎず、自分の意見も伝えてよいと意識すること。'
    }
  },

  // 10位　十三夜 × 十三夜（93点）
  '十三夜-十三夜': {
    score: 93,
    rank: 10,
    reason: '落ち着きと包容力を持つ十三夜同士。安定した長続きの関係が築ける。',
    relationship: '穏やかな時間を一緒に過ごし、安心感を分かち合う関係。日常の小さな幸せを共有できる。',
    advice: {
      '十三夜': '刺激が少なく停滞しないよう、新しい体験を提案する意識を。'
    }
  },

  // 11位　新月 × 新月（92点）
  '新月-新月': {
    score: 92,
    rank: 11,
    reason: '直感と勢いが重なり、強烈なスタートダッシュが可能。共鳴力は抜群。',
    relationship: '二人とも「やりたい！」と思った瞬間に動くので盛り上がりやすい。短期的には最強タッグ。',
    advice: {
      '新月': '衝動だけで進まず、相手とゴールを確認しながら走ること。'
    }
  },

  // 12位　十六夜 × 十六夜（91点）
  '十六夜-十六夜': {
    score: 91,
    rank: 12,
    reason: '余裕と落ち着きを持つ十六夜同士。安心感にあふれた大人の関係。',
    relationship: '衝突は少なく、穏やかで心地よい関係を築ける。居心地のよさが長続きの秘訣。',
    advice: {
      '十六夜': '相手に委ねすぎず、自分の意見や感情も時には示すこと。'
    }
  },

  // 13位　下弦の月 × 暁（90点）
  '下弦の月-暁': {
    score: 90,
    rank: 13,
    reason: '冷静な下弦と内省的な暁。深い理解と静かな信頼を築ける。',
    relationship: '言葉が少なくても安心できる。互いに無理せず寄り添える静かな関係。',
    advice: {
      '下弦の月': '暁の世界を急かさず、静かに受け止めること。',
      '暁': '下弦の安定感に頼りつつ、少しずつ自分の気持ちを共有すること。'
    }
  },
  '暁-下弦の月': {
    score: 90,
    rank: 13,
    reason: '冷静な下弦と内省的な暁。深い理解と静かな信頼を築ける。',
    relationship: '言葉が少なくても安心できる。互いに無理せず寄り添える静かな関係。',
    advice: {
      '暁': '下弦の安定感に頼りつつ、少しずつ自分の気持ちを共有すること。',
      '下弦の月': '暁の世界を急かさず、静かに受け止めること。'
    }
  },

  // 14位　三日月 × 上弦の月（90点）
  '三日月-上弦の月': {
    score: 90,
    rank: 14,
    reason: '協調的な三日月が推進力ある上弦をサポート。行動と計画の好循環。',
    relationship: '上弦が前に進め、三日月が場を和ませる。挑戦を安心感で支える関係。',
    advice: {
      '三日月': '上弦に頼られたら、遠慮せず受け止めること。',
      '上弦の月': '三日月の細やかな気遣いに感謝を言葉で伝えること。'
    }
  },
  '上弦の月-三日月': {
    score: 90,
    rank: 14,
    reason: '協調的な三日月が推進力ある上弦をサポート。行動と計画の好循環。',
    relationship: '上弦が前に進め、三日月が場を和ませる。挑戦を安心感で支える関係。',
    advice: {
      '上弦の月': '三日月の細やかな気遣いに感謝を言葉で伝えること。',
      '三日月': '上弦に頼られたら、遠慮せず受け止めること。'
    }
  },

  // 15位　新月 × 上弦の月（89点）
  '新月-上弦の月': {
    score: 89,
    rank: 15,
    reason: '新月の直感力と上弦の計画性。スピードと現実性のバランスが良い。',
    relationship: '新月が動き出し、上弦が形に整える。夢を現実に変える力を持つペア。',
    advice: {
      '新月': '上弦の計画性を窮屈に感じず、信頼して任せること。',
      '上弦の月': '新月の発想を否定せず「どう実現するか」に視点を向けること。'
    }
  },
  '上弦の月-新月': {
    score: 89,
    rank: 15,
    reason: '新月の直感力と上弦の計画性。スピードと現実性のバランスが良い。',
    relationship: '新月が動き出し、上弦が形に整える。夢を現実に変える力を持つペア。',
    advice: {
      '上弦の月': '新月の発想を否定せず「どう実現するか」に視点を向けること。',
      '新月': '上弦の計画性を窮屈に感じず、信頼して任せること。'
    }
  },

  // 16位　上弦の月 × 十三夜（88点）
  '上弦の月-十三夜': {
    score: 88,
    rank: 16,
    reason: '理性的な上弦と包容力ある十三夜。意見交換がスムーズで摩擦が少ない。',
    relationship: '上弦が方向性を示し、十三夜がそれをやさしく整える。無理のない安定感のある関係。',
    advice: {
      '上弦の月': '十三夜の優しさを当然と思わず、言葉にして感謝を伝えること。',
      '十三夜': '上弦に寄り添うだけでなく、ときにはブレーキ役を担うこと。'
    }
  },
  '十三夜-上弦の月': {
    score: 88,
    rank: 16,
    reason: '理性的な上弦と包容力ある十三夜。意見交換がスムーズで摩擦が少ない。',
    relationship: '上弦が方向性を示し、十三夜がそれをやさしく整える。無理のない安定感のある関係。',
    advice: {
      '十三夜': '上弦に寄り添うだけでなく、ときにはブレーキ役を担うこと。',
      '上弦の月': '十三夜の優しさを当然と思わず、言葉にして感謝を伝えること。'
    }
  },

  // 17位　三日月 × 満月（87点）
  '三日月-満月': {
    score: 87,
    rank: 17,
    reason: '協調的な三日月が、表現力豊かな満月をやさしく支える。華やかで楽しい関係。',
    relationship: '満月が明るく場を盛り上げ、三日月が安心感を添える。にぎやかさと調和が同居する。',
    advice: {
      '三日月': '満月の勢いに合わせるだけでなく、自分の気持ちも伝えること。',
      '満月': '三日月のやさしさに感謝し、言葉で返すこと。'
    }
  },
  '満月-三日月': {
    score: 87,
    rank: 17,
    reason: '協調的な三日月が、表現力豊かな満月をやさしく支える。華やかで楽しい関係。',
    relationship: '満月が明るく場を盛り上げ、三日月が安心感を添える。にぎやかさと調和が同居する。',
    advice: {
      '満月': '三日月のやさしさに感謝し、言葉で返すこと。',
      '三日月': '満月の勢いに合わせるだけでなく、自分の気持ちも伝えること。'
    }
  },

  // 18位　十三夜 × 満月（86点）
  '十三夜-満月': {
    score: 86,
    rank: 18,
    reason: '落ち着いた十三夜が満月の感情を包み込む。冷静と情熱の調和。',
    relationship: '満月がストレートに気持ちを示し、十三夜がやさしく受け止める。お互いに安心感を得られる関係。',
    advice: {
      '十三夜': '満月の熱量を認め、支え役に徹すること。',
      '満月': '十三夜に頼れる安心感を大事にし、感謝を忘れないこと。'
    }
  },
  '満月-十三夜': {
    score: 86,
    rank: 18,
    reason: '落ち着いた十三夜が満月の感情を包み込む。冷静と情熱の調和。',
    relationship: '満月がストレートに気持ちを示し、十三夜がやさしく受け止める。お互いに安心感を得られる関係。',
    advice: {
      '満月': '十三夜に頼れる安心感を大事にし、感謝を忘れないこと。',
      '十三夜': '満月の熱量を認め、支え役に徹すること。'
    }
  },

  // 19位　三日月 × 十三夜（85点）
  '三日月-十三夜': {
    score: 85,
    rank: 19,
    reason: '素直な三日月を、穏やかな十三夜がやさしく包む。居心地のよさ抜群。',
    relationship: '三日月が遠慮しても、十三夜が「大丈夫」と受け止める。安定した安心の関係。',
    advice: {
      '三日月': '「この人は受け止めてくれる」と信じ、本音を素直に出すこと。',
      '十三夜': '相手の小さな不安にも気づいて声をかけること。'
    }
  },
  '十三夜-三日月': {
    score: 85,
    rank: 19,
    reason: '素直な三日月を、穏やかな十三夜がやさしく包む。居心地のよさ抜群。',
    relationship: '三日月が遠慮しても、十三夜が「大丈夫」と受け止める。安定した安心の関係。',
    advice: {
      '十三夜': '相手の小さな不安にも気づいて声をかけること。',
      '三日月': '「この人は受け止めてくれる」と信じ、本音を素直に出すこと。'
    }
  },

  // 20位　十六夜 × 暁（84点）
  '十六夜-暁': {
    score: 84,
    rank: 20,
    reason: '成熟した十六夜と内省的な暁。静かで深いつながりを持つ。',
    relationship: '十六夜が広い視点で導き、暁が心の奥を共有する。精神的に安心できる組み合わせ。',
    advice: {
      '十六夜': '暁を急かさず、ゆっくり心を開くのを待つこと。',
      '暁': '十六夜に信頼を置き、自分の気持ちを少しずつ言葉にすること。'
    }
  },
  '暁-十六夜': {
    score: 84,
    rank: 20,
    reason: '成熟した十六夜と内省的な暁。静かで深いつながりを持つ。',
    relationship: '十六夜が広い視点で導き、暁が心の奥を共有する。精神的に安心できる組み合わせ。',
    advice: {
      '暁': '十六夜に信頼を置き、自分の気持ちを少しずつ言葉にすること。',
      '十六夜': '暁を急かさず、ゆっくり心を開くのを待つこと。'
    }
  },

  // 21位　上弦の月 × 上弦の月（83点）
  '上弦の月-上弦の月': {
    score: 83,
    rank: 21,
    reason: '計画性と実行力を持つ上弦同士。切磋琢磨できるが、リーダーシップがぶつかり合いやすい。',
    relationship: '同じ方向を見ているときは強力なチームになるが、意見が食い違うと衝突が激しくなる。',
    advice: {
      '上弦の月': '相手に譲る場面を意識し、柔軟に歩調を合わせること。'
    }
  },

  // 22位　下弦の月 × 下弦の月（82点）
  '下弦の月-下弦の月': {
    score: 82,
    rank: 22,
    reason: '冷静沈着で落ち着き重視の下弦同士。安定感はあるが刺激は少なめ。',
    relationship: '穏やかに過ごせるが、新鮮さや冒険心には欠ける。安定を何より大事にするペア。',
    advice: {
      '下弦の月': '自分の世界に閉じこもらず、新しいことを一緒に試す意識を。'
    }
  },

  // 23位　新月 × 十六夜（81点）
  '新月-十六夜': {
    score: 81,
    rank: 23,
    reason: '勢いある新月を、落ち着いた十六夜が和らげる。若さと大人の余裕のコントラスト。',
    relationship: '新月が突き進み、十六夜が後ろでやさしく見守る。安心と挑戦が同居する関係。',
    advice: {
      '新月': '十六夜に頼る安心感を持ち、焦らずに行動すること。',
      '十六夜': '新月の直感を尊重し、必要なときにそっと支えること。'
    }
  },
  '十六夜-新月': {
    score: 81,
    rank: 23,
    reason: '勢いある新月を、落ち着いた十六夜が和らげる。若さと大人の余裕のコントラスト。',
    relationship: '新月が突き進み、十六夜が後ろでやさしく見守る。安心と挑戦が同居する関係。',
    advice: {
      '十六夜': '新月の直感を尊重し、必要なときにそっと支えること。',
      '新月': '十六夜に頼る安心感を持ち、焦らずに行動すること。'
    }
  },

  // 24位　三日月 × 下弦の月（80点）
  '三日月-下弦の月': {
    score: 80,
    rank: 24,
    reason: '協調性の三日月と冷静な下弦。ペースは違うが、補い合うことで安定する。',
    relationship: '三日月が周囲に寄り添い、下弦が余分を整理する。落ち着きのある協力関係。',
    advice: {
      '三日月': '下弦の静けさを理解し、過度に合わせすぎないこと。',
      '下弦の月': '三日月の思いやりを大切にし、安心を返す姿勢を持つこと。'
    }
  },
  '下弦の月-三日月': {
    score: 80,
    rank: 24,
    reason: '協調性の三日月と冷静な下弦。ペースは違うが、補い合うことで安定する。',
    relationship: '三日月が周囲に寄り添い、下弦が余分を整理する。落ち着きのある協力関係。',
    advice: {
      '下弦の月': '三日月の思いやりを大切にし、安心を返す姿勢を持つこと。',
      '三日月': '下弦の静けさを理解し、過度に合わせすぎないこと。'
    }
  },

  // 25位　上弦の月 × 暁（79点）
  '上弦の月-暁': {
    score: 79,
    rank: 25,
    reason: '理性的な上弦と神秘的な暁。理解に時間はかかるが、深い関係に育つ可能性がある。',
    relationship: '上弦が現実的に導き、暁が内面的な世界を広げる。互いに学び合える関係。',
    advice: {
      '上弦の月': '暁を急かさず、その内面を尊重すること。',
      '暁': '上弦の行動力に安心して、自分の世界を少しずつ共有すること。'
    }
  },
  '暁-上弦の月': {
    score: 79,
    rank: 25,
    reason: '理性的な上弦と神秘的な暁。理解に時間はかかるが、深い関係に育つ可能性がある。',
    relationship: '上弦が現実的に導き、暁が内面的な世界を広げる。互いに学び合える関係。',
    advice: {
      '暁': '上弦の行動力に安心して、自分の世界を少しずつ共有すること。',
      '上弦の月': '暁を急かさず、その内面を尊重すること。'
    }
  },

  // 26位　十六夜 × 下弦の月（78点）
  '十六夜-下弦の月': {
    score: 78,
    rank: 26,
    reason: '成熟した十六夜と冷静な下弦。安定感抜群だが、刺激は少なめ。',
    relationship: '落ち着いて協力し合えるが、変化に乏しくマンネリ化しやすい。穏やかさを好む二人。',
    advice: {
      '十六夜': '下弦に安心して頼りつつ、少し新しい体験を持ち込むこと。',
      '下弦の月': '十六夜の落ち着きを尊重しつつ、自分の考えを押し付けすぎないこと。'
    }
  },
  '下弦の月-十六夜': {
    score: 78,
    rank: 26,
    reason: '成熟した十六夜と冷静な下弦。安定感抜群だが、刺激は少なめ。',
    relationship: '落ち着いて協力し合えるが、変化に乏しくマンネリ化しやすい。穏やかさを好む二人。',
    advice: {
      '下弦の月': '十六夜の落ち着きを尊重しつつ、自分の考えを押し付けすぎないこと。',
      '十六夜': '下弦に安心して頼りつつ、少し新しい体験を持ち込むこと。'
    }
  },

  // 27位　十三夜 × 下弦の月（74点）
  '十三夜-下弦の月': {
    score: 74,
    rank: 27,
    reason: 'どちらも安定志向で落ち着き重視。安心感はあるが新鮮さに欠ける。',
    relationship: '落ち着いた時間を共有できるが、刺激不足で停滞することもある。',
    advice: {
      '十三夜': '下弦に安心感を委ねるだけでなく、新しい提案をしてみること。',
      '下弦の月': '十三夜の優しさに甘えすぎず、リードする姿勢を示すこと。'
    }
  },
  '下弦の月-十三夜': {
    score: 74,
    rank: 27,
    reason: 'どちらも安定志向で落ち着き重視。安心感はあるが新鮮さに欠ける。',
    relationship: '落ち着いた時間を共有できるが、刺激不足で停滞することもある。',
    advice: {
      '下弦の月': '十三夜の優しさに甘えすぎず、リードする姿勢を示すこと。',
      '十三夜': '下弦に安心感を委ねるだけでなく、新しい提案をしてみること。'
    }
  },

  // 28位　三日月 × 暁（72点）
  '三日月-暁': {
    score: 72,
    rank: 28,
    reason: '協調的な三日月と内省的な暁。歩幅が合わず誤解が生じやすい。',
    relationship: '三日月が気を遣いすぎる一方で、暁は心を閉ざすことがあり距離が出やすい。',
    advice: {
      '三日月': '暁の静けさを「冷たさ」と捉えず、寄り添い続ける意識を。',
      '暁': '三日月の優しさを信じて、自分の気持ちを少しずつ言葉にすること。'
    }
  },
  '暁-三日月': {
    score: 72,
    rank: 28,
    reason: '協調的な三日月と内省的な暁。歩幅が合わず誤解が生じやすい。',
    relationship: '三日月が気を遣いすぎる一方で、暁は心を閉ざすことがあり距離が出やすい。',
    advice: {
      '暁': '三日月の優しさを信じて、自分の気持ちを少しずつ言葉にすること。',
      '三日月': '暁の静けさを「冷たさ」と捉えず、寄り添い続ける意識を。'
    }
  },

  // 29位　新月 × 三日月（70点）
  '新月-三日月': {
    score: 70,
    rank: 29,
    reason: '直感型の新月と慎重な三日月。テンポがずれやすいが、理解し合えば補い合える。',
    relationship: '新月が走り出し、三日月がブレーキをかける。噛み合わなければ摩擦が生まれやすい。',
    advice: {
      '新月': '三日月の慎重さを尊重し、一緒に歩調を合わせる努力をすること。',
      '三日月': '新月の勢いを「危うさ」ではなく「魅力」と捉えて信じること。'
    }
  },
  '三日月-新月': {
    score: 70,
    rank: 29,
    reason: '直感型の新月と慎重な三日月。テンポがずれやすいが、理解し合えば補い合える。',
    relationship: '新月が走り出し、三日月がブレーキをかける。噛み合わなければ摩擦が生まれやすい。',
    advice: {
      '三日月': '新月の勢いを「危うさ」ではなく「魅力」と捉えて信じること。',
      '新月': '三日月の慎重さを尊重し、一緒に歩調を合わせる努力をすること。'
    }
  },

  // 30位　満月 × 暁（69点）
  '満月-暁': {
    score: 69,
    rank: 30,
    reason: '感情を全力で出す満月に、暁が押されすぎる傾向。温度差に注意が必要。',
    relationship: '満月が感情を爆発させ、暁が受け止めきれずに距離を置きたくなることがある。',
    advice: {
      '満月': '暁の静けさを理解し、感情を一方的に押し付けないこと。',
      '暁': '満月の明るさに圧倒されても、安心できる部分を見つけて信頼すること。'
    }
  },
  '暁-満月': {
    score: 69,
    rank: 30,
    reason: '感情を全力で出す満月に、暁が押されすぎる傾向。温度差に注意が必要。',
    relationship: '満月が感情を爆発させ、暁が受け止めきれずに距離を置きたくなることがある。',
    advice: {
      '暁': '満月の明るさに圧倒されても、安心できる部分を見つけて信頼すること。',
      '満月': '暁の静けさを理解し、感情を一方的に押し付けないこと。'
    }
  },

  // 31位　十三夜 × 十六夜（67点）
  '十三夜-十六夜': {
    score: 67,
    rank: 31,
    reason: 'どちらも落ち着きを大切にするため、安定はあるが刺激に欠ける。',
    relationship: '安心感は強いが、新しい展開が少なく停滞感が出やすい組み合わせ。',
    advice: {
      '十三夜': '十六夜に合わせるだけでなく、新しい話題や体験を持ち込むこと。',
      '十六夜': '十三夜に安心を与えつつ、関係に変化を生む工夫をすること。'
    }
  },
  '十六夜-十三夜': {
    score: 67,
    rank: 31,
    reason: 'どちらも落ち着きを大切にするため、安定はあるが刺激に欠ける。',
    relationship: '安心感は強いが、新しい展開が少なく停滞感が出やすい組み合わせ。',
    advice: {
      '十六夜': '十三夜に安心を与えつつ、関係に変化を生む工夫をすること。',
      '十三夜': '十六夜に合わせるだけでなく、新しい話題や体験を持ち込むこと。'
    }
  },

  // 32位　上弦の月 × 満月（65点）
  '上弦の月-満月': {
    score: 65,
    rank: 32,
    reason: 'どちらも前に出る力が強く、主導権争いになりやすい。譲り合いがカギ。',
    relationship: '意見が一致すれば強いが、どちらもリーダー気質なため衝突しがち。',
    advice: {
      '上弦の月': '満月の情熱を否定せず、方向性を整える意識を持つこと。',
      '満月': '上弦の計画性を尊重し、自分の主張を少し譲る柔軟さを。'
    }
  },
  '満月-上弦の月': {
    score: 65,
    rank: 32,
    reason: 'どちらも前に出る力が強く、主導権争いになりやすい。譲り合いがカギ。',
    relationship: '意見が一致すれば強いが、どちらもリーダー気質なため衝突しがち。',
    advice: {
      '満月': '上弦の計画性を尊重し、自分の主張を少し譲る柔軟さを。',
      '上弦の月': '満月の情熱を否定せず、方向性を整える意識を持つこと。'
    }
  },

  // 33位　新月 × 下弦の月（62点）
  '新月-下弦の月': {
    score: 62,
    rank: 33,
    reason: '行動派の新月と冷静な下弦。価値観が対照的で調整が必要。',
    relationship: '新月が突っ走り、下弦が止める場面が多い。衝突しやすいが補完関係でもある。',
    advice: {
      '新月': '下弦のブレーキを否定と捉えず、安全のための配慮だと理解すること。',
      '下弦の月': '新月の直感を尊重しつつ、柔らかく方向を示すこと。'
    }
  },
  '下弦の月-新月': {
    score: 62,
    rank: 33,
    reason: '行動派の新月と冷静な下弦。価値観が対照的で調整が必要。',
    relationship: '新月が突っ走り、下弦が止める場面が多い。衝突しやすいが補完関係でもある。',
    advice: {
      '下弦の月': '新月の直感を尊重しつつ、柔らかく方向を示すこと。',
      '新月': '下弦のブレーキを否定と捉えず、安全のための配慮だと理解すること。'
    }
  },

  // 34位　上弦の月 × 十六夜（59点）
  '上弦の月-十六夜': {
    score: 59,
    rank: 34,
    reason: '理性的な上弦と控えめな十六夜。歩幅が合わず理解に時間がかかる。',
    relationship: '上弦がリードしようとしても、十六夜が一歩引いてしまい距離ができやすい。',
    advice: {
      '上弦の月': '十六夜に対しては急がず、待つ姿勢を持つこと。',
      '十六夜': '上弦の意志に流されすぎず、自分の考えをしっかり示すこと。'
    }
  },
  '十六夜-上弦の月': {
    score: 59,
    rank: 34,
    reason: '理性的な上弦と控えめな十六夜。歩幅が合わず理解に時間がかかる。',
    relationship: '上弦がリードしようとしても、十六夜が一歩引いてしまい距離ができやすい。',
    advice: {
      '十六夜': '上弦の意志に流されすぎず、自分の考えをしっかり示すこと。',
      '上弦の月': '十六夜に対しては急がず、待つ姿勢を持つこと。'
    }
  },

  // 35位　新月 × 暁（58点）
  '新月-暁': {
    score: 58,
    rank: 35,
    reason: '勢いある新月と内省的な暁。片方が引っ張り、片方が立ち止まる関係に。',
    relationship: '新月が進みたいのに、暁がじっくり考えすぎてペースが合わないことが多い。',
    advice: {
      '新月': '暁の静けさを理解し、焦らず寄り添う気持ちを持つこと。',
      '暁': '新月の勢いに安心して、自分も少しずつ行動を合わせる努力を。'
    }
  },
  '暁-新月': {
    score: 58,
    rank: 35,
    reason: '勢いある新月と内省的な暁。片方が引っ張り、片方が立ち止まる関係に。',
    relationship: '新月が進みたいのに、暁がじっくり考えすぎてペースが合わないことが多い。',
    advice: {
      '暁': '新月の勢いに安心して、自分も少しずつ行動を合わせる努力を。',
      '新月': '暁の静けさを理解し、焦らず寄り添う気持ちを持つこと。'
    }
  },

  // 36位　満月 × 満月（55点）
  '満月-満月': {
    score: 55,
    rank: 36,
    reason: '感情豊かな満月同士。華やかだが、主張がぶつかりライバルのようになりやすい。',
    relationship: '明るく盛り上がるが、互いに「自分が主役」と思いがちで摩擦が生まれやすい。',
    advice: {
      '満月': '相手の表現力を奪わず、光を分け合う意識を持つこと。'
    }
  }
};

// デフォルト相性データ
const defaultCompatibility = {
  score: 70,
  rank: 20,
  reason: '異なる月のリズムを持つ二人。理解し合うことで素敵な関係を築けます。',
  relationship: 'お互いの違いを認め合い、新しい発見がある関係です。',
  advice: {
    default: '相手のペースを尊重しながら、自分らしさも大切にしてください。'
  }
};

/**
 * 月相タイプの組み合わせから相性データを取得
 * @param {string} userType - ユーザーの月相タイプ
 * @param {string} partnerType - 相手の月相タイプ
 * @returns {object} 相性データ
 */
function getCompatibilityData(userType, partnerType) {
  // タイプ名を正規化
  const normalizedUserType = moonTypeMapping[userType] || userType;
  const normalizedPartnerType = moonTypeMapping[partnerType] || partnerType;
  
  const key = `${normalizedUserType}-${normalizedPartnerType}`;
  const data = compatibilityRankings[key];
  
  if (data) {
    return {
      score: data.score,
      rank: data.rank,
      reason: data.reason,
      relationship: data.relationship,
      userAdvice: data.advice[normalizedUserType] || data.advice.default || defaultCompatibility.advice.default
    };
  }
  
  return {
    score: defaultCompatibility.score,
    rank: defaultCompatibility.rank,
    reason: defaultCompatibility.reason,
    relationship: defaultCompatibility.relationship,
    userAdvice: defaultCompatibility.advice.default
  };
}

/**
 * スコアから星の数を計算
 * @param {number} score - 相性スコア
 * @returns {number} 星の数（1-5）
 */
function getStarCount(score) {
  if (score >= 95) return 5;
  if (score >= 85) return 4;
  if (score >= 70) return 3;
  if (score >= 55) return 2;
  return 1;
}

module.exports = {
  compatibilityRankings,
  getCompatibilityData,
  getStarCount
};